"use strict";(self.webpackChunkapache_streampark_website=self.webpackChunkapache_streampark_website||[]).push([[8701],{3905:(n,e,t)=>{t.d(e,{Zo:()=>u,kt:()=>T});var l=t(7294);function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,l)}return t}function a(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function p(n,e){if(null==n)return{};var t,l,i=function(n,e){if(null==n)return{};var t,l,i={},r=Object.keys(n);for(l=0;l<r.length;l++)t=r[l],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(l=0;l<r.length;l++)t=r[l],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var o=l.createContext({}),d=function(n){var e=l.useContext(o),t=e;return n&&(t="function"==typeof n?n(e):a(a({},e),n)),t},u=function(n){var e=d(n.components);return l.createElement(o.Provider,{value:e},n.children)},E={inlineCode:"code",wrapper:function(n){var e=n.children;return l.createElement(l.Fragment,{},e)}},s=l.forwardRef((function(n,e){var t=n.components,i=n.mdxType,r=n.originalType,o=n.parentName,u=p(n,["components","mdxType","originalType","parentName"]),s=d(t),T=i,N=s["".concat(o,".").concat(T)]||s[T]||E[T]||r;return t?l.createElement(N,a(a({ref:e},u),{},{components:t})):l.createElement(N,a({ref:e},u))}));function T(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var r=t.length,a=new Array(r);a[0]=s;var p={};for(var o in e)hasOwnProperty.call(e,o)&&(p[o]=e[o]);p.originalType=n,p.mdxType="string"==typeof n?n:i,a[1]=p;for(var d=2;d<r;d++)a[d]=t[d];return l.createElement.apply(null,a)}return l.createElement.apply(null,t)}s.displayName="MDXCreateElement"},8003:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>E,frontMatter:()=>r,metadata:()=>p,toc:()=>d});var l=t(7462),i=(t(7294),t(3905));const r={id:"7-select",title:"select",sidebar_position:7},a=void 0,p={unversionedId:"flinksql/syntax/7-select",id:"flinksql/syntax/7-select",title:"select",description:"\u4ecb\u7ecd",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/flinksql/syntax/7-select.md",sourceDirName:"flinksql/syntax",slug:"/flinksql/syntax/7-select",permalink:"/zh-CN/docs/flinksql/syntax/7-select",draft:!1,editUrl:"https://github.com/apache/incubator-streampark-website/edit/dev/i18n/zh-CN/docusaurus-plugin-content-docs/current/flinksql/syntax/7-select.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{id:"7-select",title:"select",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"use",permalink:"/zh-CN/docs/flinksql/syntax/6-use"},next:{title:"describe",permalink:"/zh-CN/docs/flinksql/syntax/8-describe"}},o={},d=[{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:2},{value:"\u65e0\u8868\u67e5\u8be2\u793a\u4f8b",id:"\u65e0\u8868\u67e5\u8be2\u793a\u4f8b",level:2},{value:"SQL\u63d0\u793a",id:"sql\u63d0\u793a",level:2},{value:"\u52a8\u6001\u8868\u64cd\u4f5c",id:"\u52a8\u6001\u8868\u64cd\u4f5c",level:3},{value:"\u8bed\u6cd5",id:"\u8bed\u6cd5",level:4},{value:"\u6848\u4f8b",id:"\u6848\u4f8b",level:4},{value:"WITH\u5b50\u53e5",id:"with\u5b50\u53e5",level:2},{value:"SELECT\u548cWHERE",id:"select\u548cwhere",level:2},{value:"SELECT DISTINCT",id:"select-distinct",level:2},{value:"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF",id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf",level:2},{value:"\u7a97\u53e3\u51fd\u6570",id:"\u7a97\u53e3\u51fd\u6570",level:3},{value:"TUMBLE",id:"tumble",level:4},{value:"HOP",id:"hop",level:4},{value:"CUMULATE",id:"cumulate",level:4},{value:"Window Offset",id:"window-offset",level:3},{value:"\u7a97\u53e3\u805a\u5408",id:"\u7a97\u53e3\u805a\u5408",level:2},{value:"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF\u805a\u5408",id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf\u805a\u5408",level:3},{value:"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF",id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf-1",level:4},{value:"GROUPING SETS",id:"grouping-sets",level:4},{value:"ROLLUP",id:"rollup",level:5},{value:"CUBE",id:"cube",level:5},{value:"select\u5206\u7ec4\u7a97\u53e3\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4",id:"select\u5206\u7ec4\u7a97\u53e3\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4",level:4},{value:"\u5c42\u53e0\u7a97\u53e3\u805a\u5408",id:"\u5c42\u53e0\u7a97\u53e3\u805a\u5408",level:4},{value:"\u5206\u7ec4\u805a\u5408",id:"\u5206\u7ec4\u805a\u5408",level:2},{value:"DISTINCT\u805a\u5408",id:"distinct\u805a\u5408",level:3},{value:"GROUPING SETS",id:"grouping-sets-1",level:3},{value:"ROLLUP",id:"rollup-1",level:4},{value:"CUBE",id:"cube-1",level:4},{value:"HAVING",id:"having",level:3},{value:"OVER\u805a\u5408",id:"over\u805a\u5408",level:2},{value:"ORDER BY",id:"order-by",level:3},{value:"PARTITION BY",id:"partition-by",level:3},{value:"Range\u5b9a\u4e49",id:"range\u5b9a\u4e49",level:3},{value:"WINDOW\u5b50\u53e5",id:"window\u5b50\u53e5",level:3},{value:"Join",id:"join",level:2},{value:"\u5e38\u89c4Join",id:"\u5e38\u89c4join",level:3},{value:"INNER\u7b49\u503c\u8fde\u63a5",id:"inner\u7b49\u503c\u8fde\u63a5",level:4},{value:"OUTER\u7b49\u503c\u8fde\u63a5",id:"outer\u7b49\u503c\u8fde\u63a5",level:4},{value:"Interval Join",id:"interval-join",level:3},{value:"Temporal Join",id:"temporal-join",level:3},{value:"Event Time Temporal Join",id:"event-time-temporal-join",level:4},{value:"Processing Time Temporal Join",id:"processing-time-temporal-join",level:4},{value:"Lookup Join",id:"lookup-join",level:3},{value:"Array\u5c55\u5f00",id:"array\u5c55\u5f00",level:3},{value:"\u8868\u51fd\u6570",id:"\u8868\u51fd\u6570",level:3},{value:"INNER JOIN",id:"inner-join",level:4},{value:"LEFT OUTER JOIN",id:"left-outer-join",level:4},{value:"window join",id:"window-join",level:2},{value:"INNER/LEFT/RIGHT/FULL OUTER",id:"innerleftrightfull-outer",level:3},{value:"SEMI",id:"semi",level:3},{value:"ANTI",id:"anti",level:3},{value:"\u9650\u5236",id:"\u9650\u5236",level:3},{value:"join\u6761\u4ef6\u7684\u9650\u5236",id:"join\u6761\u4ef6\u7684\u9650\u5236",level:4},{value:"\u5728\u8f93\u5165\u8868\u4e0a\u4f7f\u7528\u7a97\u53e3TVF\u7684\u9650\u5236",id:"\u5728\u8f93\u5165\u8868\u4e0a\u4f7f\u7528\u7a97\u53e3tvf\u7684\u9650\u5236",level:4},{value:"\u76f4\u63a5\u5728\u7a97\u53e3TVF\u540e\u4f7f\u7528window join\u7684\u9650\u5236",id:"\u76f4\u63a5\u5728\u7a97\u53e3tvf\u540e\u4f7f\u7528window-join\u7684\u9650\u5236",level:4},{value:"\u96c6\u5408\u64cd\u4f5c",id:"\u96c6\u5408\u64cd\u4f5c",level:2},{value:"UNION",id:"union",level:3},{value:"INTERSECT",id:"intersect",level:3},{value:"EXCEPT",id:"except",level:3},{value:"IN",id:"in",level:3},{value:"EXISTS",id:"exists",level:3},{value:"ORDER BY\u5b50\u53e5",id:"order-by\u5b50\u53e5",level:2},{value:"LIMIT\u5b50\u53e5",id:"limit\u5b50\u53e5",level:3},{value:"Top-N",id:"top-n",level:2},{value:"Window Top-N",id:"window-top-n",level:2},{value:"\u5728\u7a97\u53e3\u805a\u5408\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-N",id:"\u5728\u7a97\u53e3\u805a\u5408\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-n",level:3},{value:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-N",id:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-n",level:3},{value:"\u9650\u5236",id:"\u9650\u5236-1",level:3},{value:"\u53bb\u91cd",id:"\u53bb\u91cd",level:2},{value:"\u7a97\u53e3\u53bb\u91cd",id:"\u7a97\u53e3\u53bb\u91cd",level:2},{value:"\u6848\u4f8b",id:"\u6848\u4f8b-1",level:3},{value:"\u9650\u5236",id:"\u9650\u5236-2",level:3},{value:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u53bb\u91cd\u7684\u9650\u5236",id:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u53bb\u91cd\u7684\u9650\u5236",level:4},{value:"\u65f6\u95f4\u5b57\u6bb5\u6392\u5e8f\u952e\u9650\u5236",id:"\u65f6\u95f4\u5b57\u6bb5\u6392\u5e8f\u952e\u9650\u5236",level:4},{value:"Pattern Recognition\uff08\u6a21\u5f0f\u8bc6\u522b\uff09",id:"pattern-recognition\u6a21\u5f0f\u8bc6\u522b",level:2}],u={toc:d};function E(n){let{components:e,...r}=n;return(0,i.kt)("wrapper",(0,l.Z)({},u,r,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"select\u8bed\u53e5"),"\u4e3b\u8981\u662f\u4ece\u8868\u4e2d\u67e5\u8be2\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u63d2\u5165\u5230\u5176\u4ed6\u8868\u4e2d\u3002\u76f4\u63a5\u5728\u9875\u9762\u4e2d\u67e5\u770b",(0,i.kt)("inlineCode",{parentName:"p"},"select"),"\u7684\u7ed3\u679c\uff0c\u76ee\u524d\u5e73\u53f0\u8fd8\u4e0d\u652f\u6301\u3002"),(0,i.kt)("p",null,"\u5355\u4e2a\u53cd\u659c\u6760",(0,i.kt)("inlineCode",{parentName:"p"},"\\"),"\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u8f6c\u4e49\u5b57\u7b26\u4f7f\u7528\uff0c\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"select"),"\u67e5\u8be2\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002"),(0,i.kt)("h2",{id:"\u65e0\u8868\u67e5\u8be2\u793a\u4f8b"},"\u65e0\u8868\u67e5\u8be2\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT supplier_id, rating, COUNT(*) AS total\nFROM\n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    ) AS Products(supplier_id, product_id, rating)\nGROUP BY supplier_id, rating\n;\n")),(0,i.kt)("p",null,"\u53ef\u4ee5\u5c06\u8be5\u67e5\u8be2\u7ed3\u679c\u4f5c\u4e3a\u4e34\u65f6\u89c6\u56fe\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5b50\u8868\u4f7f\u7528\uff0c\u5728\u6d4b\u8bd5\u81ea\u5b9a\u4e49\u51fd\u6570\u4e2d\u4f1a\u975e\u5e38\u6709\u7528\u3002"),(0,i.kt)("p",null,"\u6bd4\u5982\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u76f4\u63a5\u63d2\u5165\u8868\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"insert into mysql_table\nSELECT supplier_id, rating, COUNT(*) AS total\nFROM\n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    ) AS Products(supplier_id, product_id, rating)\nGROUP BY supplier_id, rating\n;\n")),(0,i.kt)("h2",{id:"sql\u63d0\u793a"},"SQL\u63d0\u793a"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u5904\u7406\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SQL\u63d0\u793a"),"\u53ef\u4ee5\u4e0e",(0,i.kt)("inlineCode",{parentName:"p"},"select"),"\u8bed\u53e5\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u6539\u53d8\u8fd0\u884c\u65f6\u7684\u914d\u7f6e\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u5728\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"strong"},"sql\u63d0\u793a"),"\u4e4b\u524d\uff0c\u9700\u8981\u901a\u8fc7",(0,i.kt)("inlineCode",{parentName:"strong"},"SET"),"\u8bed\u53e5\u542f\u7528\u52a8\u6001\u8868\u9009\u9879\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e",(0,i.kt)("inlineCode",{parentName:"strong"},"table.dynamic-table-options.enabled"),"\u4e3a",(0,i.kt)("inlineCode",{parentName:"strong"},"true"),"\u3002")),(0,i.kt)("p",null,"\u6ce8\uff1a\u57281.13.x\u4e2d\uff0c\u8be5\u914d\u7f6e\u9ed8\u8ba4\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"false"),"\uff0c\u4ece",(0,i.kt)("inlineCode",{parentName:"p"},"1.14.x"),"\u5f00\u59cb\uff0c\u8be5\u914d\u7f6e\u9ed8\u8ba4\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),"\u3002"),(0,i.kt)("h3",{id:"\u52a8\u6001\u8868\u64cd\u4f5c"},"\u52a8\u6001\u8868\u64cd\u4f5c"),(0,i.kt)("p",null,"\u52a8\u6001\u8868\uff08\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4efb\u4f55\u8868\uff0c\u865a\u62df\u8868\u6216\u8005\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"hive"),"\u4e2d\u7684\u8868\u90fd\u53ef\u4ee5\uff09\u5141\u8bb8\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"SQL\u63d0\u793a"),"\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"select"),"\u67e5\u8be2\u4e2d\u52a8\u6001\u6307\u5b9a\u6216\u8986\u76d6\u8868\u7684\u9009\u9879\u914d\u7f6e\uff0c\u5e76\u4e14\u8fd9\u79cd\u6307\u5b9a\u53ea\u4f1a\u5728\u5f53\u524d\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"select"),"\u8bed\u53e5\u4e2d\u8d77\u4f5c\u7528\u3002"),(0,i.kt)("h4",{id:"\u8bed\u6cd5"},"\u8bed\u6cd5"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"flink sql"),"\u91c7\u7528\u4e86oracle\u98ce\u683c\u7684sql\u63d0\u793a\u8bed\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"table_path /*+ OPTIONS(key=val [, key=val]*) */\nkey:\n    stringLiteralval:\n    stringLiteral\n")),(0,i.kt)("h4",{id:"\u6848\u4f8b"},"\u6848\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE kafka_table1 (id BIGINT, name STRING, age INT) WITH (...);\nCREATE TABLE kafka_table2 (id BIGINT, name STRING, age INT) WITH (...);\n-- \u5728\u67e5\u8be2\u4e2d\u8986\u76d6\u8868\u9009\u9879\nselect id, name from kafka_table1 /*+ OPTIONS('scan.startup.mode'='earliest-offset') */;\n-- \u5728join\u65f6\u8986\u76d6\u8868\u9009\u9879\nselect * from\n    kafka_table1 /*+ OPTIONS('scan.startup.mode'='earliest-offset') */ t1\n    join\n    kafka_table2 /*+ OPTIONS('scan.startup.mode'='earliest-offset') */ t2\n    on t1.id = t2.id;\n-- \u8986\u76d6insert\u7684\u76ee\u6807\u8868\u9009\u9879\ninsert into kafka_table1 /*+ OPTIONS('sink.partitioner'='round-robin') */ \nselect * from kafka_table2;\n-- \u901a\u8fc7 sql \u63d0\u793a\u6307\u5b9a\u7684\u9009\u9879\uff0c\u5982\u679c\u548c\u5efa\u8868\u65f6\u901a\u8fc7 with \u6307\u5b9a\u7684\u9009\u9879\u91cd\u590d\u7684\uff0csql \u63d0\u793a\u6307\u5b9a\u7684\u9009\u9879\u4f1a\u5c06\u5176\u8986\u76d6\n")),(0,i.kt)("h2",{id:"with\u5b50\u53e5"},"WITH\u5b50\u53e5"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u5904\u7406\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"WITH\u63d0\u4f9b\u4e86\u4e00\u79cd\u7f16\u5199\u8f85\u52a9\u8bed\u53e5\u7684\u65b9\u6cd5\uff0c\u4ee5\u4fbf\u5728\u66f4\u5927\u7684\u67e5\u8be2\u4e2d\u4f7f\u7528\u3002\u8fd9\u4e9b\u8bed\u53e5\u901a\u5e38\u79f0\u4e3a\u516c\u5171\u8868\u8868\u8fbe\u5f0f(Common Table Expression, CTE)\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u4eec\u5b9a\u4e49\u4e86\u4ec5\u7528\u4e8e\u4e00\u4e2a\u67e5\u8be2\u7684\u4e34\u65f6\u89c6\u56fe\u3002"),(0,i.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"WITH <with_item_definition> [ , ... ]\nSELECT ... FROM ...;\n\n<with_item_defintion>:\n    with_item_name (column_name[, ...n]) AS ( <select_query> )\n")),(0,i.kt)("p",null,"\u4f7f\u7528\u6848\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"WITH orders_with_total AS (\n    SELECT order_id, price + tax AS total\n    FROM Orders\n)\nSELECT order_id, SUM(total)\nFROM orders_with_total\nGROUP BY order_id;\n")),(0,i.kt)("p",null,"\u4e0a\u9762\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"with"),"\u5b50\u53e5\u5b9a\u4e49\u4e86",(0,i.kt)("inlineCode",{parentName:"p"},"orders_with_total"),"\uff0c\u5e76\u4e14\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"group by"),"\u5b50\u53e5\u4e2d\u4f7f\u7528\u4e86\u5b83\u3002"),(0,i.kt)("h2",{id:"select\u548cwhere"},"SELECT\u548cWHERE"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u6a21\u5f0f\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"SELECT\u8bed\u53e5\u7684\u4e00\u822c\u8bed\u6cd5\u4e3a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT select_list FROM table_expression [ WHERE boolean_expression ];\n")),(0,i.kt)("p",null,"table_expression\u53ef\u4ee5\u5f15\u7528\u4efb\u4f55\u6570\u636e\u6e90\u3002\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a\u73b0\u6709\u8868\u3001\u89c6\u56fe\u6216VALUES\u5b50\u53e5\u3001\u591a\u4e2a\u73b0\u6709\u8868\u7684\u8fde\u63a5\u7ed3\u679c\u6216\u4e00\u4e2a\u5b50\u67e5\u8be2\u3002\u5047\u8bbe\u8be5\u8868\u5728catalog\u4e2d\u53ef\u7528\uff0c\u4e0b\u9762\u7684\u8bed\u53e5\u5c06\u4eceOrders\u4e2d\u8bfb\u53d6\u6240\u6709\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM Orders;\n")),(0,i.kt)("p",null,"select_list\u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"*"),"\u53f7\u8868\u793a\u67e5\u8be2\u5c06\u4f1a\u89e3\u6790\u6240\u6709\u5217\u3002\u4f46\u662f\uff0c\u5728\u751f\u4ea7\u4e2d\u4e0d\u9f13\u52b1\u4f7f\u7528\u3002\u76f8\u53cd\uff0cselect_list\u53ef\u4ee5\u6307\u5b9a\u624b\u52a8\u53ef\u7528\u5217\uff0c\u6216\u8005\u4f7f\u7528\u53ef\u7528\u5217\u8fdb\u884c\u8ba1\u7b97\u3002\u5165Orders\u8868\u6709\u540d\u4e3aorder_id\u3001price\u548ctax\u7684\u5217\uff0c\u5219\u53ef\u4ee5\u7f16\u5199\u4ee5\u4e0b\u67e5\u8be2:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, price + tax FROM Orders\n")),(0,i.kt)("p",null,"\u67e5\u8be2\u4e5f\u53ef\u4ee5\u901a\u8fc7VALUES\u5b50\u53e5\u4f7f\u7528\u5185\u8054\u6570\u636e\u3002\u6bcf\u4e2a\u5143\u7ec4\u5bf9\u5e94\u4e00\u884c\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u522b\u540d\u6765\u4e3a\u6bcf\u4e2a\u5217\u5206\u914d\u540d\u79f0\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, price FROM (VALUES (1, 2.0), (2, 3.1))  AS t (order_id, price);\n")),(0,i.kt)("p",null,"\u53ef\u4ee5\u6839\u636eWHERE\u5b50\u53e5\u7b5b\u9009\u6570\u636e\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT price + tax FROM Orders WHERE id = 10;\n")),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u53ef\u4ee5\u5728\u5355\u884c\u7684\u5217\u4e0a\u8c03\u7528\u5185\u7f6e\u548c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6807\u91cf\u51fd\u6570\u3002\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u5728\u76ee\u5f55\u4e2d\u6ce8\u518c\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT PRETTY_PRINT(order_id) FROM Orders;\n")),(0,i.kt)("h2",{id:"select-distinct"},"SELECT DISTINCT"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u6a21\u5f0f\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u6307\u5b9a\u4e86SELECT DISTINCT\uff0c\u5219\u4f1a\u4ece\u7ed3\u679c\u96c6\u4e2d\u5220\u9664\u6240\u6709\u91cd\u590d\u7684\u884c(\u6bcf\u7ec4\u91cd\u590d\u7684\u884c\u4fdd\u7559\u4e00\u884c)\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT DISTINCT id FROM Orders;\n")),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\u3002\u72b6\u6001\u5927\u5c0f\u53d6\u51b3\u4e8e\u4e0d\u540c\u7684\u6570\u636e\u884c\u6570\u91cf\u3002\u53ef\u4ee5\u63d0\u4f9b\u5177\u6709\u9002\u5f53\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\u7684",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5b58\u50a8\u8fc7\u5927\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("h2",{id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf"},"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF"),(0,i.kt)("p",null,"\u53ea\u652f\u6301\u6d41\u5f0f\u4efb\u52a1\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Windows"),"\u662f\u5904\u7406\u65e0\u9650\u6d41\u7684\u6838\u5fc3\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"Windows"),"\u5c06\u6d41\u5206\u6210\u6709\u9650\u5927\u5c0f\u7684\u6876\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6876\u4e0a\u9762\u8fdb\u884c\u8ba1\u7b97\u3002"),(0,i.kt)("p",null,"Apache Flink\u63d0\u4f9b\u4e86\u51e0\u4e2a\u7a97\u53e3\u8868\u503c\u51fd\u6570(TVF)\u6765\u5c06\u8868\u4e2d\u7684\u5143\u7d20\u5212\u5206\u4e3a\u5230\u7a97\u53e3\u4e2d\u4ee5\u4f9b\u7528\u6237\u8fdb\u884c\u5904\u7406\uff0c\u5305\u62ec:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Tumble windows \uff08\u6eda\u52a8\u7a97\u53e3\uff09"),(0,i.kt)("li",{parentName:"ul"},"Hop windows \uff08\u6ed1\u52a8\u7a97\u53e3\uff09"),(0,i.kt)("li",{parentName:"ul"},"Cumulate windows \uff08\u7d2f\u8ba1\u7a97\u53e3\uff09"),(0,i.kt)("li",{parentName:"ul"},"Session windows\uff08\u4f1a\u8bdd\u7a97\u53e3\uff09(\u5373\u5c06\u652f\u6301\uff0c\u76ee\u524d1.13\u30011.14\u30011.15\u5747\u672a\u652f\u6301)")),(0,i.kt)("h3",{id:"\u7a97\u53e3\u51fd\u6570"},"\u7a97\u53e3\u51fd\u6570"),(0,i.kt)("p",null,"Apache Flink\u63d0\u4f9b\u4e863\u4e2a\u5185\u7f6e\u7684\u7a97\u53e3TVFs\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"TUMBLE"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"HOP"),"\u548c",(0,i.kt)("inlineCode",{parentName:"p"},"CUMULATE"),"\u3002\u7a97\u53e3TVF\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684\u5173\u7cfb\uff0c\u5b83\u5305\u62ec\u539f\u6765\u5173\u7cfb\u7684\u6240\u6709\u5217\uff0c\u4ee5\u53ca\u53e6\u59163\u5217\uff0c \u540d\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"window_start"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"window_end"),"\n\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"window_time"),"\u6765\u8868\u793a\u5206\u914d\u7684\u7a97\u53e3\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"window_time"),"\u5b57\u6bb5\u662f\u7a97\u53e3TVF\u6267\u884c\u4e4b\u540e\u7684\u4e00\u4e2a\u65f6\u95f4\u5c5e\u6027\uff0c\u53ef\u4ee5\u5728\u540e\u7eed\u57fa\u4e8e\u65f6\u95f4\u7684\u64cd\u4f5c\u4e2d\u4f7f\u7528\u3002window_time\u7684\u503c\u603b\u662f\u7b49\u4e8ewindow_end - 1ms\u3002"),(0,i.kt)("h4",{id:"tumble"},"TUMBLE"),(0,i.kt)("p",null,"\u6eda\u52a8\u7a97\u53e3\u51fd\u6570\u5c06\u6bcf\u4e2a\u5143\u7d20\u5206\u914d\u7ed9\u6307\u5b9a\u5927\u5c0f\u7684\u7a97\u53e3,\u6eda\u52a8\u7a97\u53e3\u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\uff0c\u5e76\u4e14\u4e0d\u4f1a\u91cd\u53e0\u3002\u5047\u8bbe\u6307\u5b9a\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a5\u5206\u949f\u7684\u6eda\u52a8\u7a97\u53e3\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cFlink\u5c06\u8ba1\u7b97\u5f53\u524d\u7a97\u53e3\uff0c\u5e76\u6bcf5\u5206\u949f\u542f\u52a8\u4e00\u4e2a\u65b0\u7a97\u53e3\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img.png",src:t(9602).Z,width:"383",height:"236"})),(0,i.kt)("p",null,"TUMBLE\u51fd\u6570\u6839\u636e\u65f6\u95f4\u5c5e\u6027\u5217\u4e3a\u8868\u7684\u6bcf\u4e00\u884c\u5206\u914d\u4e00\u4e2a\u7a97\u53e3\u3002TUMBLE\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684\u5173\u7cfb\uff0c\u5b83\u5305\u62ec\u539f\u6765\u8868\u7684\u6240\u6709\u5217\u4ee5\u53ca\u53e6\u59163\u5217\u201cwindow_start\u201d\uff0c\u201cwindow_end\u201d\uff0c\u201cwindow_time\u201d\u6765\u8868\u793a\u5206\u914d\u7684\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u539f\u8868\u4e2d\u7684\u539f\u59cb\u65f6\u95f4\u5b57\u6bb5\u5c06\u662f\u7a97\u53e3TVF\u51fd\u6570\u4e4b\u540e\u7684\u5e38\u89c4\u65f6\u95f4\u5217\u3002TUMBLE\u51fd\u6570\u9700\u8981\u4e09\u4e2a\u53c2\u6570:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- 1.13.x\nTUMBLE(TABLE data, DESCRIPTOR(timecol), size)\n-- \u4ece1.14.x\u5f00\u59cb\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a\u53ef\u9009\u7684\u53c2\u6570\nTUMBLE(TABLE data, DESCRIPTOR(timecol), size [, offset ])\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"data\uff1a\u8868\u540d\uff0c\u8be5\u8868\u5fc5\u987b\u6709\u4e00\u5217\u7c7b\u578b\u4e3a\u65f6\u95f4\u6233\uff0c\u4e5f\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"TIMESTAMP"),"\u7c7b\u578b\u3002"),(0,i.kt)("li",{parentName:"ul"},"timecol\uff1a\u5217\u540d\uff0c\u8868\u793a\u8be5\u5217\u6570\u636e\u6620\u5c04\u5230\u6eda\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"size\uff1a\u6307\u5b9a\u6eda\u52a8\u7a97\u53e3\u7684\u7a97\u53e3\u5927\u5c0f\u3002"),(0,i.kt)("li",{parentName:"ul"},"offset\uff1a\u4ece1.14.x\u5f00\u59cb\u652f\u6301\uff0c\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7a97\u53e3\u5f00\u59cb\u79fb\u52a8\u7684offset\uff0c\u4e5f\u5c31\u662f\u6307\u5b9a\u4ea7\u751f\u7a97\u53e3\u7684\u65f6\u95f4\u70b9\u3002\n\u6bd4\u5982\u7a97\u53e3\u65f6\u95f4\u4e3a5\u5206\u949f\uff0c\u6307\u5b9a\u5f00\u59cb\u79fb\u52a8\u7684 offset \u4e3a1\u5206\u949f\uff0c\u5219\u89e6\u53d1\u7684\u7a97\u53e3\u5982\u4e0b\uff1a[1\u5206\u949f, 6\u5206\u949f)\u3001[6\u5206\u949f, 11\u5206\u949f)\u3001...\u3002")),(0,i.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u5bf9Bid\u8868\u7684\u8c03\u7528\u793a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8868\u5fc5\u987b\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u6bd4\u5982\u4e0b\u8868\u4e2d\u7684 `bidtime` \u5b57\u6bb5\u3002\nFlink SQL> desc Bid;\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|        name |                   type | null | key | extras |                       watermark |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|     bidtime | TIMESTAMP(3) *ROWTIME* | true |     |        | `bidtime` - INTERVAL '1' SECOND |\n|       price |         DECIMAL(10, 2) | true |     |        |                                 |\n|        item |                 STRING | true |     |        |                                 |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n\nFlink SQL> SELECT * FROM Bid;\n+------------------+-------+------+\n|          bidtime | price | item |\n+------------------+-------+------+\n| 2020-04-15 08:05 |  4.00 | C    |\n| 2020-04-15 08:07 |  2.00 | A    |\n| 2020-04-15 08:09 |  5.00 | D    |\n| 2020-04-15 08:11 |  3.00 | B    |\n| 2020-04-15 08:13 |  1.00 | E    |\n| 2020-04-15 08:17 |  6.00 | F    |\n+------------------+-------+------+\n\n-- \u6ce8\u610f\uff1a\u76ee\u524dflink\u4e0d\u652f\u6301\u5355\u72ec\u4f7f\u7528\u8868\u503c\u7a97\u53e3\u51fd\u6570\uff0c\u8868\u503c\u7a97\u53e3\u51fd\u6570\u5e94\u8be5\u548c\u805a\u5408\u64cd\u4f5c\u4e00\u8d77\u4f7f\u7528\uff0c\u8fd9\u4e2a\u793a\u4f8b\u53ea\u662f\u5c55\u793a\u8bed\u6cd5\u4ee5\u53ca\u901a\u8fc7\u8868\u503c\u51fd\u6570\u4ea7\u751f\u6570\u636e\nSELECT * \nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    );\n-- \u6216\u8005\u662f\u548c\u53c2\u6570\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\u3002\u6ce8\u610f\uff1aDATA\u53c2\u6570\u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a\nSELECT * \nFROM \n    TABLE(\n        TUMBLE(\n            DATA => TABLE Bid,\n            TIMECOL => DESCRIPTOR(bidtime),\n            SIZE => INTERVAL '10' MINUTES\n        )\n    );\n+------------------+-------+------+------------------+------------------+-------------------------+\n|          bidtime | price | item |     window_start |       window_end |            window_time  |\n+------------------+-------+------+------------------+------------------+-------------------------+\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n+------------------+-------+------+------------------+------------------+-------------------------+\n")),(0,i.kt)("p",null,"\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u539f\u59cb\u8868\u76846\u884c\u6570\u636e\u88ab\u5206\u914d\u52303\u4e2a\u7a97\u53e3\u4e2d\uff0c\u6bcf\u4e2a\u6eda\u52a8\u7a97\u53e3\u662f\u65f6\u95f4\u95f4\u9694\u4e3a10\u5206\u949f\uff0c\u7a97\u53e3\u65f6\u95f4window_time\u4e3a\u5bf9\u5e94\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4-1ms\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5728\u6eda\u52a8\u7a97\u53e3\u8868\u4e0a\u6267\u884c\u805a\u5408\u51fd\u6570\nSELECT window_start, window_end, SUM(price)\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n+------------------+------------------+-------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f:\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5316\u4e86\u65f6\u95f4\u6233\u503c\u7684\u663e\u793a\uff0c\u4e0d\u663e\u793a\u79d2\u540e\u9762\u7684\u96f6\u3002\n\u5982\u679c\u65f6\u95f4\u7c7b\u578b\u662ftimestamp(3)\uff0c\u5728Flink SQL Client\u4e2d\uff0c2020-04-15 08:05\u5e94\u8be5\u663e\u793a\u4e3a2020-04-15 08:05:00.000\u3002"),(0,i.kt)("h4",{id:"hop"},"HOP"),(0,i.kt)("p",null,"HOP\u51fd\u6570\u5c06\u5143\u7d20\u5206\u914d\u7ed9\u56fa\u5b9a\u957f\u5ea6\u7684\u7a97\u53e3\u3002\u548c",(0,i.kt)("inlineCode",{parentName:"p"},"TUMBLE"),"\u7a97\u53e3\u529f\u80fd\u4e00\u6837\uff0c\u7a97\u53e3\u7684\u5927\u5c0f\u7531\u7a97\u53e3\u5927\u5c0f\u53c2\u6570\u6765\u914d\u7f6e\uff0c\u53e6\u4e00\u4e2a\u7a97\u53e3\u6ed1\u52a8\u53c2\u6570\u63a7\u5236\u8df3\u8dc3\u7a97\u53e3\u542f\u52a8\u7684\u9891\u7387\uff0c\u7c7b\u4f3c\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"stream api")," \u4e2d\u7684\u6ed1\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64\uff0c\u5982\u679c\u6ed1\u52a8\u5c0f\u4e8e\u7a97\u53e3\u5927\u5c0f\uff0c\u8df3\u8dc3\u7a97\u53e3\u5c31\u4f1a\u91cd\u53e0\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u5143\u7d20\u88ab\u5206\u914d\u7ed9\u591a\u4e2a\u7a97\u53e3\u3002\u8df3\u8dc3\u7a97\u53e3\u4e5f\u88ab\u79f0\u4e3a\u201c\u6ed1\u52a8\u7a97\u53e3\u201d\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c10\u5206\u949f\u5927\u5c0f\u7684\u7a97\u53e3\uff0c\u6ed1\u52a85\u5206\u949f\u3002\u8fd9\u6837\uff0c\u6bcf5\u5206\u949f\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u7a97\u53e3\uff0c\u7a97\u53e3\u5305\u542b\u5728\u6700\u8fd110\u5206\u949f\u5185\u5230\u8fbe\u7684\u4e8b\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img.png",src:t(899).Z,width:"558",height:"344"})),(0,i.kt)("p",null,"HOP\u51fd\u6570\u7a97\u53e3\u4f1a\u8986\u76d6\u6307\u5b9a\u5927\u5c0f\u533a\u95f4\u5185\u7684\u6570\u636e\u884c\uff0c\u5e76\u6839\u636e\u65f6\u95f4\u5c5e\u6027\u5217\u79fb\u52a8\u3002"),(0,i.kt)("p",null,"HOP\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684\u5173\u7cfb\uff0c\u5b83\u5305\u62ec\u539f\u6765\u5173\u7cfb\u7684\u6240\u6709\u5217\uff0c\u4ee5\u53ca\u201cwindow_start\u201d\u3001\u201cwindow_end\u201d\u3001\u201cwindow_time\u201d\u6765\u8868\u793a\u6307\u5b9a\u7684\u7a97\u53e3\u3002\u539f\u8868\u7684\u539f\u59cb\u7684\u65f6\u95f4\u5c5e\u6027\u5217\u201ctimecol\u201d\u5c06\u662f\u6267\u884cTVF\u540e\u7684\u5e38\u89c4\u65f6\u95f4\u6233\u5217\u3002"),(0,i.kt)("p",null,"HOP\u63a5\u53d7\u56db\u4e2a\u5fc5\u9700\u7684\u53c2\u6570\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- 1.13.x\nHOP(TABLE data, DESCRIPTOR(timecol), slide, size)\n-- \u4ece1.14.x\u5f00\u59cb\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a\u53ef\u9009\u7684\u53c2\u6570\nHOP(TABLE data, DESCRIPTOR(timecol), slide, size [, offset ])\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"data\uff1a\u8868\u540d\uff0c\u8be5\u8868\u5fc5\u987b\u6709\u4e00\u5217\u7c7b\u578b\u4e3a\u65f6\u95f4\u6233\uff0c\u4e5f\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"TIMESTAMP"),"\u7c7b\u578b\u3002"),(0,i.kt)("li",{parentName:"ul"},"timecol\uff1a\u5217\u540d\uff0c\u8868\u793a\u8be5\u5217\u6570\u636e\u6620\u5c04\u5230\u6ed1\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"slide\uff1a\u6ed1\u52a8\u65f6\u95f4\uff0c\u6307\u5b9a\u8fde\u7eed\u6ed1\u52a8\u7a97\u53e3\u4e4b\u95f4\u7684\u95f4\u9694\u65f6\u95f4\u3002"),(0,i.kt)("li",{parentName:"ul"},"size\uff1a\u6307\u5b9a\u6ed1\u52a8\u7a97\u53e3\u7684\u7a97\u53e3\u5927\u5c0f\u3002"),(0,i.kt)("li",{parentName:"ul"},"offset\uff1a\u4ece1.14.x\u5f00\u59cb\u652f\u6301\uff0c\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7a97\u53e3\u5f00\u59cb\u79fb\u52a8\u7684offset\uff0c\u4e5f\u5c31\u662f\u6307\u5b9a\u4ea7\u751f\u7a97\u53e3\u7684\u65f6\u95f4\u70b9\u3002\n\u6bd4\u5982\u7a97\u53e3\u65f6\u95f4\u4e3a5\u5206\u949f\uff0c\u6307\u5b9a\u5f00\u59cb\u79fb\u52a8\u7684 offset \u4e3a1\u5206\u949f\uff0c\u5219\u89e6\u53d1\u7684\u7a97\u53e3\u5982\u4e0b\uff1a[1\u5206\u949f, 6\u5206\u949f)\u3001[6\u5206\u949f, 11\u5206\u949f)\u3001...\u3002")),(0,i.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u5bf9Bid\u8868\u7684\u8c03\u7528\u793a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6ce8\u610f\uff1a\u76ee\u524dflink\u4e0d\u652f\u6301\u5355\u72ec\u4f7f\u7528\u8868\u503c\u7a97\u53e3\u51fd\u6570\uff0c\u8868\u503c\u7a97\u53e3\u51fd\u6570\u5e94\u8be5\u548c\u805a\u5408\u64cd\u4f5c\u4e00\u8d77\u4f7f\u7528\uff0c\u8fd9\u4e2a\u793a\u4f8b\u53ea\u662f\u5c55\u793a\u8bed\u6cd5\u4ee5\u53ca\u901a\u8fc7\u8868\u503c\u51fd\u6570\u4ea7\u751f\u6570\u636e\nSELECT * \n    FROM TABLE(\n        HOP(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '5' MINUTES, INTERVAL '10' MINUTES)\n    );\n-- \u6216\u8005\u662f\u548c\u53c2\u6570\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\u3002\u6ce8\u610f\uff1aDATA\u53c2\u6570\u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a\nSELECT * \nFROM TABLE(\n    HOP(\n        DATA => TABLE Bid,\n        TIMECOL => DESCRIPTOR(bidtime),\n        SLIDE => INTERVAL '5' MINUTES,\n        SIZE => INTERVAL '10' MINUTES\n    )\n);\n+------------------+-------+------+------------------+------------------+-------------------------+\n|          bidtime | price | item |     window_start |       window_end |           window_time   |\n+------------------+-------+------+------------------+------------------+-------------------------+\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:05 | 2020-04-15 08:15 | 2020-04-15 08:14:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:05 | 2020-04-15 08:15 | 2020-04-15 08:14:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:05 | 2020-04-15 08:15 | 2020-04-15 08:14:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:05 | 2020-04-15 08:15 | 2020-04-15 08:14:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:05 | 2020-04-15 08:15 | 2020-04-15 08:14:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:15 | 2020-04-15 08:25 | 2020-04-15 08:24:59.999 |\n+------------------+-------+------+------------------+------------------+-------------------------+\n")),(0,i.kt)("p",null,"\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u7531\u4e8e\u7a97\u53e3\u6709\u91cd\u53e0\uff0c\u6240\u6709\u5f88\u591a\u6570\u636e\u90fd\u5c5e\u4e8e\u4e24\u4e2a\u7a97\u53e3\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5728\u6ed1\u52a8\u7a97\u53e3\u8868\u4e0a\u8fd0\u884c\u805a\u5408\u51fd\u6570\nSELECT window_start, window_end, SUM(price)\nFROM \n    TABLE(\n        HOP(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '5' MINUTES, INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:05 | 2020-04-15 08:15 | 15.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n| 2020-04-15 08:15 | 2020-04-15 08:25 |  6.00 |\n+------------------+------------------+-------+\n")),(0,i.kt)("h4",{id:"cumulate"},"CUMULATE"),(0,i.kt)("p",null,"\u7d2f\u79ef\u7a97\u53e3\uff0c\u6216\u8005\u53eb\u505a\u6e10\u8fdb\u5f0f\u7a97\u53e3\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u662f\u975e\u5e38\u6709\u7528\u7684\uff0c\u4f8b\u5982\u5728\u56fa\u5b9a\u7684\u7a97\u53e3\u95f4\u9694\u5185\u65e9\u671f\u89e6\u53d1\u6eda\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u4eea\u8868\u677f\u663e\u793a\u5f53\u5929\u7684\u5b9e\u65f6\u603bUV\u6570\uff0c\u9700\u8981\u4ece\u6bcf\u5929\u768400:00\u5f00\u59cb\u5230\u7d2f\u8ba1\u6bcf\u5206\u949f\u7684UV\u503c\uff0c10:00\u7684UV\u503c\u8868\u793a00:00\u523010:00\u7684UV\u603b\u6570\uff0c\u8fd9\u5c31\u53ef\u4ee5\u901a\u8fc7\u7d2f\u79ef\u7a97\u53e3\u8f7b\u677e\u6709\u6548\u5730\u5b9e\u73b0\u3002"),(0,i.kt)("p",null,"CUMULATE\u51fd\u6570\u5c06\u5143\u7d20\u5206\u914d\u7ed9\u7a97\u53e3\uff0c\u8fd9\u4e9b\u7a97\u53e3\u5728\u521d\u59cb\u6b65\u957f\u95f4\u9694\u5185\u8986\u76d6\u884c\u6570\u636e\uff0c\u5e76\u4e14\u6bcf\u4e00\u6b65\u90fd\u4f1a\u6269\u5c55\u5230\u4e00\u4e2a\u66f4\u591a\u7684\u6b65\u957f(\u4fdd\u6301\u7a97\u53e3\u5f00\u59cb\u65f6\u95f4\u4e3a\u56fa\u5b9a\u503c)\uff0c\u76f4\u5230\u6700\u5927\u7a97\u53e3\u5927\u5c0f\u3002"),(0,i.kt)("p",null,"\u53ef\u4ee5\u628aCUMULATE\u51fd\u6570\u770b\u4f5c\u662f\u5148\u5e94\u7528\u5177\u6709\u6700\u5927\u7a97\u53e3\u5927\u5c0f\u7684TUMBLE\u7a97\u53e3\uff0c\u7136\u540e\u628a\u6bcf\u4e2a\u6eda\u52a8\u7a97\u53e3\u5206\u6210\u51e0\u4e2a\u7a97\u53e3\uff0c\u6bcf\u4e2a\u7a97\u53e3\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u90fd\u6709\u76f8\u540c\u7684\u6b65\u957f\u5dee\u3002\u6240\u4ee5\u7d2f\u79ef\u7a97\u53e3\u6709\u91cd\u53e0\uff0c\u800c\u4e14\u6ca1\u6709\u56fa\u5b9a\u7684\u5927\u5c0f\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\u6709\u4e00\u4e2a\u7d2f\u79ef\u7a97\u53e3\uff0c1\u5c0f\u65f6\u7684\u6b65\u957f\u548c1\u5929\u7684\u6700\u5927\u5927\u5c0f\uff0c\u5c06\u83b7\u5f97\u7a97\u53e3:[00:00,01:00)\uff0c[00:00,02:00)\uff0c[00:00,03:00)\uff0c\u2026\uff0c[00:00,24:00)\uff0c\u6bcf\u5929\u90fd\u5982\u6b64\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img.png",src:t(1292).Z,width:"513",height:"324"})),(0,i.kt)("p",null,"\u7d2f\u79ef\u7a97\u53e3\u57fa\u4e8e\u65f6\u95f4\u5c5e\u6027\u5217\u5206\u914d\u7a97\u53e3\u3002CUMULATE\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684\u5173\u7cfb\uff0c\u5b83\u5305\u62ec\u539f\u6765\u5173\u7cfb\u7684\u6240\u6709\u5217\uff0c\u53e6\u5916\u8fd8\u67093\u5217\uff0c\u5206\u522b\u662f\u201cwindow_start\u201d\u3001\u201cwindow_end\u201d\u3001\u201cwindow_time\u201d\uff0c\u8868\u793a\u6307\u5b9a\u7684\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u539f\u59cb\u7684\u65f6\u95f4\u5c5e\u6027\u201ctimecol\u201d\u5c06\u662f\u7a97\u53e3TVF\u4e4b\u540e\u7684\u5e38\u89c4\u65f6\u95f4\u6233\u5217\u3002"),(0,i.kt)("p",null,"CUMULATE\u63a5\u53d7\u56db\u4e2a\u5fc5\u9700\u7684\u53c2\u6570\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- 1.13.x\nCUMULATE(TABLE data, DESCRIPTOR(timecol), step, size)\n-- \u4ece1.14.x\u5f00\u59cb\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a\u53ef\u9009\u7684\u53c2\u6570\nCUMULATE(TABLE data, DESCRIPTOR(timecol), step, size [, offset ])\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"data\uff1a\u8868\u540d\uff0c\u8be5\u8868\u5fc5\u987b\u6709\u4e00\u5217\u7c7b\u578b\u4e3a\u65f6\u95f4\u6233\uff0c\u4e5f\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"TIMESTAMP"),"\u7c7b\u578b\u3002"),(0,i.kt)("li",{parentName:"ul"},"timecol\uff1a\u5217\u540d\uff0c\u8868\u793a\u8be5\u5217\u6570\u636e\u6620\u5c04\u5230\u7d2f\u8ba1\u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"step\uff1a\u6b65\u957f\uff0c\u6307\u5b9a\u8fde\u7eed\u7d2f\u79ef\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u4e4b\u95f4\u589e\u52a0\u7684\u7a97\u53e3\u5927\u5c0f\u7684\u65f6\u95f4\u95f4\u9694\u3002"),(0,i.kt)("li",{parentName:"ul"},"size\uff1a\u6307\u5b9a\u7d2f\u79ef\u7a97\u53e3\u7684\u7a97\u53e3\u5927\u5c0f\u3002\u5927\u5c0f\u5fc5\u987b\u662f\u6b65\u957f\u7684\u6574\u6570\u500d\u3002"),(0,i.kt)("li",{parentName:"ul"},"offset\uff1a\u4ece1.14.x\u5f00\u59cb\u652f\u6301\uff0c\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7a97\u53e3\u5f00\u59cb\u79fb\u52a8\u7684offset\uff0c\u4e5f\u5c31\u662f\u6307\u5b9a\u4ea7\u751f\u7a97\u53e3\u7684\u65f6\u95f4\u70b9\u3002\n\u6bd4\u5982\u7a97\u53e3\u65f6\u95f4\u4e3a5\u5206\u949f\uff0c\u6307\u5b9a\u5f00\u59cb\u79fb\u52a8\u7684 offset \u4e3a1\u5206\u949f\uff0c\u5219\u89e6\u53d1\u7684\u7a97\u53e3\u5982\u4e0b\uff1a[1\u5206\u949f, 6\u5206\u949f)\u3001[6\u5206\u949f, 11\u5206\u949f)\u3001...\u3002")),(0,i.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u5bf9Bid\u8868\u7684\u8c03\u7528\u793a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6ce8\u610f\uff1a\u76ee\u524dflink\u4e0d\u652f\u6301\u5355\u72ec\u4f7f\u7528\u8868\u503c\u7a97\u53e3\u51fd\u6570\uff0c\u8868\u503c\u7a97\u53e3\u51fd\u6570\u5e94\u8be5\u548c\u805a\u5408\u64cd\u4f5c\u4e00\u8d77\u4f7f\u7528\uff0c\u8fd9\u4e2a\u793a\u4f8b\u53ea\u662f\u5c55\u793a\u8bed\u6cd5\u4ee5\u53ca\u901a\u8fc7\u8868\u503c\u51fd\u6570\u4ea7\u751f\u6570\u636e\nSELECT * \nFROM \n    TABLE(\n        CUMULATE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '2' MINUTES, INTERVAL '10' MINUTES)\n    );\n-- \u6216\u8005\u662f\u548c\u53c2\u6570\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\u3002\u6ce8\u610f\uff1aDATA\u53c2\u6570\u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a\nSELECT * \nFROM \n    TABLE(\n        CUMULATE(\n            DATA => TABLE Bid,\n            TIMECOL => DESCRIPTOR(bidtime),\n            STEP => INTERVAL '2' MINUTES,\n            SIZE => INTERVAL '10' MINUTES\n        )\n    );\n+------------------+-------+------+------------------+------------------+-------------------------+\n|          bidtime | price | item |     window_start |       window_end |            window_time  |\n+------------------+-------+------+------------------+------------------+-------------------------+\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:06 | 2020-04-15 08:05:59.999 |\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:08 | 2020-04-15 08:07:59.999 |\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:08 | 2020-04-15 08:07:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:00 | 2020-04-15 08:10 | 2020-04-15 08:09:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:12 | 2020-04-15 08:11:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:14 | 2020-04-15 08:13:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:16 | 2020-04-15 08:15:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:14 | 2020-04-15 08:13:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:16 | 2020-04-15 08:15:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:18 | 2020-04-15 08:17:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:10 | 2020-04-15 08:20 | 2020-04-15 08:19:59.999 |\n+------------------+-------+------+------------------+------------------+-------------------------+\n\n-- \u5728\u7a97\u53e3\u8868\u4e0a\u8fd0\u884c\u805a\u5408\u51fd\u6570\nSELECT window_start, window_end, SUM(price)\nFROM\n    TABLE(\n        CUMULATE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '2' MINUTES, INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:06 |  4.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:08 |  6.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:12 |  3.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:14 |  4.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:16 |  4.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:18 | 10.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n+------------------+------------------+-------+\n")),(0,i.kt)("h3",{id:"window-offset"},"Window Offset"),(0,i.kt)("p",null,"\u4ece1.14.x\u5f00\u59cb\u652f\u6301\u3002"),(0,i.kt)("p",null,"offset \u662f\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u88ab\u7528\u4e8e\u66f4\u6539\u7a97\u53e3\u7684\u5206\u914d\uff0c\u8be5\u53c2\u6570\u7684\u503c\u5e94\u8be5\u662f\u4e00\u4e2a\u6b63\u6570\u6216\u8005\u662f\u8d1f\u6570\u3002"),(0,i.kt)("p",null,"\u9ed8\u8ba4\u7684 window offset \u4e3a0\u3002\u5982\u679c\u8bbe\u7f6e\u4e0d\u540c\u7684 offset \u503c\uff0c\u5219\u540c\u4e00\u6761\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u5206\u914d\u5230\u4e0d\u540c\u7684\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u5217\u51fa\u7684\u662f\u65f6\u95f4\u6233\u4e3a 2021-06-30 00:00:04 \u7684\u6570\u636e\u5c06\u88ab\u5206\u914d\u5230\u54ea\u4e2a\u4ee510\u5206\u949f\u4e3a\u7a97\u53e3\u5927\u5c0f\u7684\u7a97\u53e3\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"-16 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:54:00, 2021-06-30 00:04:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"-6 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:54:00, 2021-06-30 00:04:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"-4 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:56:00, 2021-06-30 00:06:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"0"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-30 00:00:00, 2021-06-30 00:10:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"4 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:54:00, 2021-06-30 00:04:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"6 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:56:00, 2021-06-30 00:06:00) \u7a97\u53e3\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c offset \u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"16 MINUTE"),"\uff0c\u6570\u636e\u5c06\u4f1a\u88ab\u5206\u914d\u7ed9 [2021-06-29 23:56:00, 2021-06-30 00:06:00) \u7a97\u53e3\u3002")),(0,i.kt)("p",null,"\u901a\u8fc7\u4e0a\u8ff0\u6848\u4f8b\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u4e9b\u7a97\u53e3 offset \u53c2\u6570\u503c\u53ef\u80fd\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u7a97\u53e3\u5206\u914d\u3002"),(0,i.kt)("p",null,"\u6bd4\u5982\uff1a -16 MINUTE, -6 MINUTE \u548c4 MINUTE \uff0c\u5bf9\u4e8e 10 MINUTE \u5927\u5c0f\u7684\u7a97\u53e3\uff0c\u4f1a\u5f97\u5230\u76f8\u540c\u6eda\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u7a97\u53e3\u7684 offset \u53ea\u7528\u4e8e\u6539\u53d8\u7a97\u53e3\u7684\u5206\u914d\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u6c34\u5370\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u5728\u6eda\u52a8\u7a97\u53e3\u4e2d\u4f7f\u7528 offset \u7684 sql \u6848\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6ce8\u610f\uff1a\u76ee\u524d flink \u4e0d\u652f\u6301\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u8868\u503c\u51fd\u6570\u3002\n-- \u7a97\u53e3\u8868\u503c\u51fd\u6570\u5e94\u8be5\u88ab\u7528\u4e8e\u805a\u5408\u64cd\u4f5c\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u53ea\u662f\u7528\u4e8e\u5c55\u793a\u8bed\u6cd5\u4ee5\u53ca\u8868\u503c\u51fd\u6570\u4ea7\u751f\u7684\u6570\u636e\u3002\nFlink SQL> SELECT *\nFROM\n    TABLE(\n    TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES, INTERVAL '1' MINUTES)\n    );\n-- \u6216\u8005\u6307\u5b9a\u53c2\u6570\u540d\u79f0\n-- \u6ce8\u610f\uff1aDATA \u53c2\u6570\u5fc5\u987b\u653e\u5728\u6700\u5f00\u59cb\nFlink SQL> SELECT *\nFROM \n    TABLE(\n        TUMBLE(\n            DATA => TABLE Bid,\n            TIMECOL => DESCRIPTOR(bidtime),\n            SIZE => INTERVAL '10' MINUTES,\n            OFFSET => INTERVAL '1' MINUTES\n        )\n    );\n+------------------+-------+------+------------------+------------------+-------------------------+\n|          bidtime | price | item |     window_start |       window_end |            window_time  |\n+------------------+-------+------+------------------+------------------+-------------------------+\n| 2020-04-15 08:05 |  4.00 | C    | 2020-04-15 08:01 | 2020-04-15 08:11 | 2020-04-15 08:10:59.999 |\n| 2020-04-15 08:07 |  2.00 | A    | 2020-04-15 08:01 | 2020-04-15 08:11 | 2020-04-15 08:10:59.999 |\n| 2020-04-15 08:09 |  5.00 | D    | 2020-04-15 08:01 | 2020-04-15 08:11 | 2020-04-15 08:10:59.999 |\n| 2020-04-15 08:11 |  3.00 | B    | 2020-04-15 08:11 | 2020-04-15 08:21 | 2020-04-15 08:20:59.999 |\n| 2020-04-15 08:13 |  1.00 | E    | 2020-04-15 08:11 | 2020-04-15 08:21 | 2020-04-15 08:20:59.999 |\n| 2020-04-15 08:17 |  6.00 | F    | 2020-04-15 08:11 | 2020-04-15 08:21 | 2020-04-15 08:20:59.999 |\n+------------------+-------+------+------------------+------------------+-------------------------+\n\n-- \u5728\u6eda\u52a8\u7a97\u53e3\u7ed3\u679c\u8868\u4e0a\u4f7f\u7528\u805a\u5408\u51fd\u6570\nFlink SQL> SELECT window_start, window_end, SUM(price)\nFROM\n    TABLE(\n            TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES, INTERVAL '1' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:01 | 2020-04-15 08:11 | 11.00 |\n| 2020-04-15 08:11 | 2020-04-15 08:21 | 10.00 |\n+------------------+------------------+-------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5355\u7684\u5c55\u793a\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"timestamp")," \u7c7b\u578b\u7684\u503c\uff0c\u5e76\u6ca1\u6709\u5c55\u793a\u540e\u9762\u76840\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u6bd4\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"2020-04-15 08:05")," \uff0c\u5982\u679c\u7c7b\u578b\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"TIMESTAMP(3)"),"\uff0c \u51c6\u786e\u6765\u8bf4\uff0c\u5728 sql client \u4e2d\u5e94\u8be5\u88ab\u5c55\u793a\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"2020-04-15 08:05:00.000"),"\u3002"),(0,i.kt)("h2",{id:"\u7a97\u53e3\u805a\u5408"},"\u7a97\u53e3\u805a\u5408"),(0,i.kt)("h3",{id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf\u805a\u5408"},"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF\u805a\u5408"),(0,i.kt)("p",null,"\u53ea\u652f\u6301\u6d41\u5f0f\u4efb\u52a1\u3002"),(0,i.kt)("p",null,"\u5728group by\u5b50\u53e5\u4e2d\u5b9a\u4e49\u7684\u7a97\u53e3\u805a\u5408\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528\u901a\u8fc7\u7a97\u53e3\u8868\u503c\u805a\u5408\u51fd\u6570\u7684\u7ed3\u679c\u8868\u4e2d\u7684\u201cwindow_start\u201d\u548c\u201cwindow_end\u201d\u5217\u3002\n\u5c31\u50cf\u4f7f\u7528\u5e38\u89c4GROUP BY\u5b50\u53e5\u7684\u67e5\u8be2\u4e00\u6837\uff0c\u4f7f\u7528GROUP BY\u7a97\u53e3\u805a\u5408\u7684\u67e5\u8be2\u4f1a\u7ed9\u6bcf\u4e2a\u7ec4\u8ba1\u7b97\u51fa\u5355\u4e2a\u7ed3\u679c\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT ...\nFROM <windowed_table> -- \u63a5\u53d7\u901a\u8fc7\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF\u751f\u6210\u7684\u8868\nGROUP BY window_start, window_end, ...\n")),(0,i.kt)("p",null,"\u4e0e\u8fde\u7eed\u6d41\u8868\u4e0a\u7684\u5176\u4ed6\u805a\u5408\u4e0d\u540c\uff0c\u7a97\u53e3\u805a\u5408\u4e0d\u53d1\u51fa\u4e2d\u95f4\u7ed3\u679c\uff0c\u800c\u53ea\u53d1\u51fa\u6700\u7ec8\u7ed3\u679c\uff0c\u5373\u7a97\u53e3\u7ed3\u675f\u4e4b\u540e\u7684\u603b\u805a\u5408\u3002\u6b64\u5916\uff0c\u5f53\u4e0d\u518d\u9700\u8981\u65f6\uff0c\u7a97\u53e3\u805a\u5408\u4f1a\u6e05\u9664\u6240\u6709\u4e2d\u95f4\u72b6\u6001\u3002"),(0,i.kt)("h4",{id:"\u7a97\u53e3\u8868\u503c\u51fd\u6570tvf-1"},"\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF"),(0,i.kt)("p",null,"Flink\u652f\u6301TUMBLE\u3001HOP\u548cCUMULATE\u7c7b\u578b\u7684\u7a97\u53e3\u805a\u5408\uff0c\u5b83\u4eec\u53ef\u4ee5\u5b9a\u4e49\u5728\u4e8b\u4ef6\u65f6\u95f4\u6216\u5904\u7406\u65f6\u95f4\u5c5e\u6027\u4e0a\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e9bTUMBLE\u3001HOP\u548cCUMULATE\u7a97\u53e3\u805a\u5408\u7684\u4f8b\u5b50\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8868\u5fc5\u987b\u6709\u65f6\u95f4\u5c5e\u6027\u5217\uff0c\u6bd4\u5982\u4e0b\u9762\u8868\u4e2d\u7684`bidtime`\u5217\u3002\nFlink SQL> desc Bid;\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|        name |                   type | null | key | extras |                       watermark |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|     bidtime | TIMESTAMP(3) *ROWTIME* | true |     |        | `bidtime` - INTERVAL '1' SECOND |\n|       price |         DECIMAL(10, 2) | true |     |        |                                 |\n|        item |                 STRING | true |     |        |                                 |\n| supplier_id |                 STRING | true |     |        |                                 |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n\nFlink SQL> SELECT * FROM Bid;\n+------------------+-------+------+-------------+\n|          bidtime | price | item | supplier_id |\n+------------------+-------+------+-------------+\n| 2020-04-15 08:05 | 4.00  | C    | supplier1   |\n| 2020-04-15 08:07 | 2.00  | A    | supplier1   |\n| 2020-04-15 08:09 | 5.00  | D    | supplier2   |\n| 2020-04-15 08:11 | 3.00  | B    | supplier2   |\n| 2020-04-15 08:13 | 1.00  | E    | supplier1   |\n| 2020-04-15 08:17 | 6.00  | F    | supplier2   |\n+------------------+-------+------+-------------+\n\n-- \u6eda\u52a8\u7a97\u53e3\u805a\u5408\nSELECT window_start, window_end, SUM(price)\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n+------------------+------------------+-------+\n\n-- \u6ed1\u52a8\u7a97\u53e3\u805a\u5408\nSELECT window_start, window_end, SUM(price)\nFROM \n    TABLE(\n        HOP(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '5' MINUTES, INTERVAL '10' MINUTES))\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:05 | 2020-04-15 08:15 | 15.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n| 2020-04-15 08:15 | 2020-04-15 08:25 | 6.00  |\n+------------------+------------------+-------+\n\n-- \u7d2f\u8ba1\u7a97\u53e3\u805a\u5408\nSELECT window_start, window_end, SUM(price)\nFROM \n    TABLE(\n        CUMULATE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '2' MINUTES, INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n+------------------+------------------+-------+\n|     window_start |       window_end | price |\n+------------------+------------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:06 | 4.00  |\n| 2020-04-15 08:00 | 2020-04-15 08:08 | 6.00  |\n| 2020-04-15 08:00 | 2020-04-15 08:10 | 11.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:12 | 3.00  |\n| 2020-04-15 08:10 | 2020-04-15 08:14 | 4.00  |\n| 2020-04-15 08:10 | 2020-04-15 08:16 | 4.00  |\n| 2020-04-15 08:10 | 2020-04-15 08:18 | 10.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | 10.00 |\n+------------------+------------------+-------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f:\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5316\u4e86\u65f6\u95f4\u6233\u503c\u7684\u663e\u793a\uff0c\u4ee5\u4e0d\u663e\u793a\u79d2\u5c0f\u6570\u70b9\u540e\u9762\u7684\u96f6\uff0c\n\u4f8b\u5982\uff0c\u5982\u679c\u7c7b\u578b\u662ftimestamp(3)\uff0c\u5728Flink SQL Client\u4e2d\uff0c2020-04-15 08:05\u5e94\u8be5\u663e\u793a\u4e3a2020-04-15 08:05:00.000\u3002"),(0,i.kt)("h4",{id:"grouping-sets"},"GROUPING SETS"),(0,i.kt)("p",null,"\u7a97\u53e3\u805a\u5408\u4e5f\u652f\u6301GROUPING SETS\u8bed\u6cd5\u3002GROUPING SETS\u5141\u8bb8\u8fdb\u884c\u6bd4\u6807\u51c6GROUP BY\u66f4\u590d\u6742\u7684\u5206\u7ec4\u64cd\u4f5c\u3002\u884c\u6309\u6bcf\u4e2a\u6307\u5b9a\u7684\u5206\u7ec4\u96c6\u5355\u72ec\u5206\u7ec4\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5206\u7ec4\u8ba1\u7b97\u805a\u5408\uff0c\u5c31\u50cf\u7b80\u5355\u7684group by\u5b50\u53e5\u4e00\u6837\u3002"),(0,i.kt)("p",null,"\u5e26\u6709GROUPING SETS\u7684\u7a97\u53e3\u805a\u5408\u8981\u6c42window_start\u548cwindow_end\u5217\u5fc5\u987b\u5728GROUP BY\u5b50\u53e5\u4e2d\uff0c\u4f46\u4e0d\u80fd\u5728GROUPING SETS\u5b50\u53e5\u4e2d\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT window_start, window_end, supplier_id, SUM(price) as price\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end, GROUPING SETS ((supplier_id), ());\n+------------------+------------------+-------------+-------+\n|     window_start |       window_end | supplier_id | price |\n+------------------+------------------+-------------+-------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 |      (NULL) | 11.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 |   supplier2 |  5.00 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 |   supplier1 |  6.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 |      (NULL) | 10.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 |   supplier2 |  9.00 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 |   supplier1 |  1.00 |\n+------------------+------------------+-------------+-------+\n")),(0,i.kt)("p",null,"GROUPING SETS\u7684\u6bcf\u4e2a\u5b50\u5217\u8868\u53ef\u4ee5\u6307\u5b9a\u96f6\u4e2a\u6216\u591a\u4e2a\u5217\u6216\u8868\u8fbe\u5f0f\uff0c\u5e76\u4e14\u89e3\u91ca\u65b9\u5f0f\u4e0e\u76f4\u63a5\u5199\u5728GROUP BY\u5b50\u53e5\u76f8\u540c\u3002\u7a7a\u5206\u7ec4\u96c6\u610f\u5473\u7740\u5c06\u6240\u6709\u884c\u805a\u5408\u4e3a\u5355\u4e2a\u7ec4\uff0c\u5373\u4f7f\u6ca1\u6709\u8f93\u5165\u884c\uff0c\u8be5\u7ec4\u4e5f\u4f1a\u8f93\u51fa\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8eGROUPING SETS\u4e2d\u7684\u5b50\u96c6\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u4efb\u4f55\u6570\u636e\u5217\u6216\u8868\u8fbe\u5f0f\uff0c\u5c06\u4f1a\u4f7f\u7528NULL\u503c\u6765\u4ee3\u66ff\uff0c\u8868\u793a\u5bf9\u7a97\u53e3\u65f6\u95f4\u5185\u7684\u5168\u91cf\u6570\u636e\u8fdb\u884c\u805a\u5408\u3002"),(0,i.kt)("h5",{id:"rollup"},"ROLLUP"),(0,i.kt)("p",null,"ROLLUP\u662f\u4e00\u79cd\u7528\u4e8e\u6307\u5b9a\u901a\u7528\u5206\u7ec4\u96c6\u7c7b\u578b\u7684\u7b80\u5199\u7b26\u53f7\u3002\u5b83\u8868\u793a\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\u5217\u8868\uff0c\u524d\u7f00\u5217\u8868\u548c\u7a7a\u5217\u8868\u3002"),(0,i.kt)("p",null,"\u524d\u7f00\u5217\u8868\uff1a\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b50\u5217\u8868\u662f\u6307\u5b9a\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u7136\u540e\u6bcf\u6b21\u53bb\u6389\u6700\u540e\u9762\u4e00\u4e2a\u5b57\u6bb5\u800c\u751f\u6210\u7684\u8868\u8fbe\u5f0f\u5217\u8868\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"rollup(s1, s2, s3)\ns1, s2, s3\ns1, s2, null\ns1, null, null\nnull, null, null\n")),(0,i.kt)("p",null,"\u5e26\u6709ROLLUP\u7684\u7a97\u53e3\u805a\u5408\u8981\u6c42window_start\u548cwindow_end\u5217\u5fc5\u987b\u5728GROUP BY\u5b50\u53e5\u4e2d\uff0c\u800c\u4e0d\u662f\u5728ROLLUP\u5b50\u53e5\u4e2d\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u67e5\u8be2\u4e0e\u4e0a\u9762\u7684\u67e5\u8be2\u7b49\u4ef7\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT window_start, window_end, supplier_id, SUM(price) as price\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end, ROLLUP (supplier_id);\n")),(0,i.kt)("h5",{id:"cube"},"CUBE"),(0,i.kt)("p",null,"CUBE\u662f\u4e00\u79cd\u7528\u4e8e\u6307\u5b9a\u516c\u5171\u5206\u7ec4\u96c6\u7c7b\u578b\u7684\u7b80\u5199\u7b26\u53f7\u3002\u5b83\u8868\u793a\u7ed9\u5b9a\u7684\u5217\u8868\u53ca\u5176\u6240\u6709\u53ef\u80fd\u7684\u5b50\u96c6\uff0c\u5305\u62ec\u7a7a\u5217\u8868\u3002"),(0,i.kt)("p",null,"\u4f7f\u7528CUBE\u7684\u7a97\u53e3\u805a\u5408\u8981\u6c42window_start\u548cwindow_end\u5217\u5fc5\u987b\u5728GROUP BY\u5b50\u53e5\u4e2d\uff0c\u800c\u4e0d\u662f\u5728CUBE\u5b50\u53e5\u4e2d\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u4e0b\u9762\u4e24\u4e2a\u67e5\u8be2\u662f\u7b49\u4ef7\u7684\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT window_start, window_end, item, supplier_id, SUM(price) as price\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end, CUBE (supplier_id, item);\n------------------------------------------------------------------------------\nSELECT window_start, window_end, item, supplier_id, SUM(price) as price\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end,\nGROUPING SETS (\n    (supplier_id, item),\n    (supplier_id      ),\n    (             item),\n    (                 )\n)\n")),(0,i.kt)("h4",{id:"select\u5206\u7ec4\u7a97\u53e3\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4"},"select\u5206\u7ec4\u7a97\u53e3\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4"),(0,i.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528\u5206\u7ec4\u7684window_start\u548cwindow_end\u5217\u6765\u4f5c\u4e3a\u7ec4\u7a97\u53e3\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4\u6233\u3002"),(0,i.kt)("h4",{id:"\u5c42\u53e0\u7a97\u53e3\u805a\u5408"},"\u5c42\u53e0\u7a97\u53e3\u805a\u5408"),(0,i.kt)("p",null,"window_start\u548cwindow_end\u5217\u662f\u5e38\u89c4\u7684\u65f6\u95f4\u6233\u5217\uff0c\u800c\u4e0d\u662f\u65f6\u95f4\u5c5e\u6027\u3002\u56e0\u6b64\uff0c\u5b83\u4eec\u4e0d\u80fd\u5728\u968f\u540e\u7684\u57fa\u4e8e\u65f6\u95f4\u7684\u64cd\u4f5c\u4e2d\u7528\u4f5c\u65f6\u95f4\u5c5e\u6027\u3002\u4e3a\u4e86\u4f20\u64ad\u65f6\u95f4\u5c5e\u6027\uff0c\u9700\u8981\u5728GROUP BY\u5b50\u53e5\u4e2d\u6dfb\u52a0window_time\u5217\u3002"),(0,i.kt)("p",null,"window_time\u662f\u7a97\u53e3\u8868\u503c\u51fd\u6570TVF\u4ea7\u751f\u7684\u7b2c\u4e09\u5217\uff0c\u5b83\u662f\u6307\u5b9a\u7a97\u53e3\u7684\u65f6\u95f4\u5c5e\u6027\uff0c\u6bd4\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u65e91\u6beb\u79d2\u3002\u5c06window_time\u6dfb\u52a0\u5230GROUP BY\u5b50\u53e5\u4e2d\uff0c\u4f7f\u5f97window_time\u4e5f\u6210\u4e3a\u53ef\u4ee5\u9009\u62e9\u7684\u65f6\u95f4\u5217\u3002"),(0,i.kt)("p",null,"\u7136\u540e\uff0c\u67e5\u8be2\u5c31\u53ef\u4ee5\u5c06\u6b64\u5217\u7528\u4e8e\u540e\u7eed\u57fa\u4e8e\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u5c42\u53e0\u7a97\u53e3\u805a\u5408\u548c\u7a97\u53e3TopN\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u4ee3\u7801\u663e\u793a\u4e86\u5c42\u53e0\u7a97\u53e3\u805a\u5408\u7528\u6cd5\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u7a97\u53e3\u805a\u5408\u51fd\u6570\u4f20\u64ad\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u805a\u5408\u7684\u65f6\u95f4\u5c5e\u6027\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5bf9\u6bcf\u4e2asupplier_id\u8fdb\u884c5\u5206\u949f\u7684\u6eda\u52a8\u7a97\u53e3\u8ba1\u7b97\nCREATE VIEW window1 AS\nSELECT window_start, window_end, window_time as rowtime, SUM(price) as partial_price\nFROM \n    TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '5' MINUTES)\n    )\nGROUP BY supplier_id, window_start, window_end, window_time;\n\n-- \u5728\u4e0a\u9762\u7684\u7a97\u53e3\u7ed3\u679c\u57fa\u7840\u4e0a\u8fdb\u884c10\u5206\u949f\u7684\u7a97\u53e3\u6eda\u52a8\u8ba1\u7b97\nSELECT window_start, window_end, SUM(partial_price) as total_price\nFROM \n    TABLE(\n        TUMBLE(TABLE window1, DESCRIPTOR(rowtime), INTERVAL '10' MINUTES)\n    )\nGROUP BY window_start, window_end;\n")),(0,i.kt)("h2",{id:"\u5206\u7ec4\u805a\u5408"},"\u5206\u7ec4\u805a\u5408"),(0,i.kt)("p",null,"\u53ef\u7528\u4e8e\u6d41\u6279\u4efb\u52a1\u3002"),(0,i.kt)("p",null,"\u50cf\u5927\u591a\u6570\u6570\u636e\u7cfb\u7edf\u4e00\u6837\uff0cApache Flink\u652f\u6301\u805a\u5408\u51fd\u6570\uff1a\u5185\u7f6e\u7684\u548c\u7528\u6237\u5b9a\u4e49\u7684\u3002\u7528\u6237\u5b9a\u4e49\u51fd\u6570\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u5728catalog\u4e2d\u6ce8\u518c\u3002"),(0,i.kt)("p",null,"\u805a\u5408\u51fd\u6570\u901a\u8fc7\u591a\u4e2a\u8f93\u5165\u884c\u8ba1\u7b97\u5355\u4e2a\u7ed3\u679c\u3002\u4f8b\u5982\uff0c\u5728\u4e00\u7ec4\u884c\u6570\u636e\u4e0a\u8ba1\u7b97COUNT\u3001SUM\u3001AVG(\u5e73\u5747)\u3001MAX(\u6700\u5927)\u548cMIN(\u6700\u5c0f)\u7684\u805a\u5408\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT COUNT(*) FROM Orders;\n")),(0,i.kt)("p",null,"flink\u7684\u6d41\u67e5\u8be2\u662f\u6c38\u8fdc\u4e0d\u4f1a\u7ec8\u6b62\u7684\u8fde\u7eed\u67e5\u8be2\u3002\u8be5\u67e5\u8be2\u4f1a\u6839\u636e\u8f93\u5165\u8868\u7684\u65b0\u6570\u636e\u6765\u66f4\u65b0\u7ed3\u679c\u8868\u3002\u5bf9\u4e8e\u4e0a\u9762\u7684\u67e5\u8be2\uff0c\u6bcf\u6b21\u5728Orders\u8868\u4e2d\u63d2\u5165\u65b0\u884c\u65f6\uff0cFlink\u90fd\u4f1a\u8f93\u51fa\u4e00\u4e2a\u66f4\u65b0\u7684\u8ba1\u6570\u3002"),(0,i.kt)("p",null,"Apache Flink\u652f\u6301\u7528\u4e8e\u805a\u5408\u6570\u636e\u7684\u6807\u51c6GROUP BY\u5b50\u53e5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT COUNT(*)\nFROM Orders\nGROUP BY order_id;\n")),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\u3002\u72b6\u6001\u5927\u5c0f\u53d6\u51b3\u4e8e\u7ec4\u7684\u6570\u91cf\u4ee5\u53ca\u805a\u5408\u51fd\u6570\u7684\u6570\u91cf\u548c\u7c7b\u578b\u3002\u53ef\u4ee5\u914d\u7f6e\u67e5\u8be2\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002\u4f46\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("p",null,"Apache Flink\u4e3aGroup Aggregation\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u6027\u80fd\u8c03\u4f18\u65b9\u6cd5\uff0c\u8bf7\u53c2\u9605\u66f4\u591a\u7684",(0,i.kt)("a",{parentName:"p",href:"../2-2-performance-tuning"},"\u6027\u80fd\u8c03\u4f18"),"\u3002"),(0,i.kt)("h3",{id:"distinct\u805a\u5408"},"DISTINCT\u805a\u5408"),(0,i.kt)("p",null,"\u6709\u4e9b\u805a\u5408\u9700\u8981\u5728\u8c03\u7528\u805a\u5408\u51fd\u6570\u4e4b\u524d\u5220\u9664\u91cd\u590d\u503c\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u8ba1\u7b97Orders\u8868\u4e2d\u4e0d\u540corder_ids\u7684\u6570\u91cf\uff0c\u800c\u4e0d\u662f\u603b\u884c\u6570\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT COUNT(DISTINCT order_id) FROM Orders;\n")),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u65e0\u9650\u589e\u957f\u3002\u72b6\u6001\u5927\u5c0f\u4e3b\u8981\u53d6\u51b3\u4e8e\u4e0d\u540c\u7684\u884c\u6570\u548c\u7ec4\u7ef4\u62a4\u7684\u65f6\u95f4\uff0c\u77ed\u65f6\u95f4\u7684\u7a97\u53e3\u7ec4\u805a\u5408\u4e0d\u662f\u95ee\u9898\u3002\u53ef\u4ee5\u914d\u7f6e\u67e5\u8be2\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("h3",{id:"grouping-sets-1"},"GROUPING SETS"),(0,i.kt)("p",null,"grouping sets\u53ef\u4ee5\u6267\u884c\u6bd4\u6807\u51c6GROUP BY\u66f4\u590d\u6742\u7684\u5206\u7ec4\u64cd\u4f5c\u3002\u884c\u6570\u636e\u6309\u6bcf\u4e2a\u5206\u7ec4\u96c6\u5355\u72ec\u5206\u7ec4\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5206\u7ec4\u8ba1\u7b97\u805a\u5408\u51fd\u6570\uff0c\u5c31\u50cf\u7b80\u5355\u7684group by\u5b50\u53e5\u4e00\u6837\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT supplier_id, rating, COUNT(*) AS total\nFROM \n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    )\nAS Products(supplier_id, product_id, rating)\nGROUP BY GROUPING SETS ((supplier_id, rating), (supplier_id), ());\n+-------------+--------+-------+\n| supplier_id | rating | total |\n+-------------+--------+-------+\n|   supplier1 |      4 |     1 |\n|   supplier1 | (NULL) |     2 |\n|      (NULL) | (NULL) |     4 |\n|   supplier1 |      3 |     1 |\n|   supplier2 |      3 |     1 |\n|   supplier2 | (NULL) |     2 |\n|   supplier2 |      4 |     1 |\n+-------------+--------+-------+\n")),(0,i.kt)("p",null,"GROUPING SETS\u7684\u6bcf\u4e2a\u5b50\u5217\u8868\u53ef\u4ee5\u6307\u5b9a\u96f6\u4e2a\u6216\u591a\u4e2a\u5217\u6216\u8868\u8fbe\u5f0f\uff0c\u5e76\u4e14\u5176\u89e3\u91ca\u65b9\u5f0f\u4e0e\u76f4\u63a5\u5728GROUP BY\u5b50\u53e5\u4e2d\u4f7f\u7528\u76f8\u540c\u3002\u7a7a\u5206\u7ec4\u96c6\u610f\u5473\u7740\u5c06\u6240\u6709\u884c\u805a\u5408\u4e3a\u5355\u4e2a\u7ec4\uff0c\u5373\u4f7f\u6ca1\u6709\u8f93\u5165\u884c\uff0c\u8be5\u7ec4\u4e5f\u4f1a\u8f93\u51fa\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u5206\u7ec4\u4e2d\u96c6\u4e2d\u672a\u51fa\u73b0\u7684\u5217\u6216\u8868\u8fbe\u5f0f\uff0c\u4f1a\u4f7f\u7528NULL\u8fdb\u884c\u66ff\u6362\uff0c\u5982\u4e0a\u56fe\u6240\u793a\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u65e0\u9650\u589e\u957f\u3002\u72b6\u6001\u5927\u5c0f\u53d6\u51b3\u4e8e\u7ec4\u96c6\u7684\u6570\u91cf\u548c\u805a\u5408\u51fd\u6570\u7684\u7c7b\u578b\u3002\u53ef\u4ee5\u914d\u7f6e\u67e5\u8be2\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("h4",{id:"rollup-1"},"ROLLUP"),(0,i.kt)("p",null,"ROLLUP\u662f\u4e00\u79cd\u7528\u4e8e\u6307\u5b9a\u901a\u7528\u5206\u7ec4\u96c6\u7c7b\u578b\u7684\u7b80\u5355\u7528\u6cd5\u3002\u5b83\u8868\u793a\u7ed9\u5b9a\u7684\u8868\u8fbe\u5f0f\u5217\u8868\u3001\u524d\u7f00\u5217\u8868\u3001\u7a7a\u5217\u8868\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u67e5\u8be2\u4e0e\u4e0a\u9762\u7684\u67e5\u8be2\u7b49\u4ef7\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT supplier_id, rating, COUNT(*)\nFROM \n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    )\nAS Products(supplier_id, product_id, rating)\nGROUP BY ROLLUP (supplier_id, rating);\n")),(0,i.kt)("h4",{id:"cube-1"},"CUBE"),(0,i.kt)("p",null,"CUBE\u662f\u4e00\u79cd\u7528\u4e8e\u6307\u5b9a\u516c\u5171\u5206\u7ec4\u96c6\u7c7b\u578b\u7684\u7b80\u5355\u7528\u6cd5\u3002\u5b83\u8868\u793a\u7ed9\u5b9a\u7684\u5217\u8868\u53ca\u5176\u6240\u6709\u53ef\u80fd\u7684\u5b50\u96c6\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u4e24\u4e2a\u67e5\u8be2\u662f\u7b49\u4ef7\u7684\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT supplier_id, rating, product_id, COUNT(*)\nFROM \n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    )\nAS Products(supplier_id, product_id, rating)\nGROUP BY CUBE (supplier_id, rating, product_id);\n--------------------------------------------------------------------------\nSELECT supplier_id, rating, product_id, COUNT(*)\nFROM \n    (VALUES\n        ('supplier1', 'product1', 4),\n        ('supplier1', 'product2', 3),\n        ('supplier2', 'product3', 3),\n        ('supplier2', 'product4', 4)\n    )\nAS Products(supplier_id, product_id, rating)\nGROUP BY GROUPING SET (\n        ( supplier_id, product_id, rating ),\n        ( supplier_id, product_id         ),\n        ( supplier_id,             rating ),\n        ( supplier_id                     ),\n        (              product_id, rating ),\n        (              product_id         ),\n        (                          rating ),\n        (                                 )\n    );\n")),(0,i.kt)("h3",{id:"having"},"HAVING"),(0,i.kt)("p",null,"HAVING\u6d88\u9664\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u7ec4\u884c\u3002HAVING\u4e0d\u540c\u4e8eWHERE:WHERE\u5728GROUP BY\u4e4b\u524d\u8fc7\u6ee4\u5355\u72ec\u7684\u884c\uff0c\u800cHAVING\u8fc7\u6ee4GROUP BY\u521b\u5efa\u7684\u7ec4\u884c\u3002HAVING\u6761\u4ef6\u5f15\u7528\u7684\u6bcf\u4e2a\u5217\u5fc5\u987b\u662f\u5206\u7ec4\u5217\u4e2d\u7684\u5217\uff0c\u4ee5\u53ca\u805a\u5408\u51fd\u6570\u7ed3\u679c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT SUM(amount)\nFROM Orders\nGROUP BY users\nHAVING SUM(amount) > 50;\n")),(0,i.kt)("p",null,"HAVING\u7684\u5b58\u5728\u4f1a\u5c06\u67e5\u8be2\u8f6c\u6362\u4e3a\u5206\u7ec4\u67e5\u8be2\uff0c\u5373\u4f7f\u6ca1\u6709GROUP BY\u5b50\u53e5\u3002\u8fd9\u4e0e\u67e5\u8be2\u5305\u542b\u805a\u5408\u51fd\u6570\u4f46\u6ca1\u6709GROUP BY\u5b50\u53e5\u65f6\u53d1\u751f\u7684\u60c5\u51b5\u76f8\u540c\u3002"),(0,i.kt)("p",null,"\u67e5\u8be2\u4f1a\u5c06\u6240\u6709\u9009\u5b9a\u7684\u884c\u7ec4\u6210\u4e00\u4e2a\u7ec4\uff0cSELECT\u5217\u8868\u548cHAVING\u5b50\u53e5\u53ea\u80fd\u4ece\u805a\u5408\u51fd\u6570\u4e2d\u5f15\u7528\u5217\u3002\u5982\u679cHAVING\u6761\u4ef6\u4e3a\u771f\uff0c\u8fd9\u6837\u7684\u67e5\u8be2\u5c06\u4ea7\u751f\u4e00\u884c\u7ed3\u679c\uff0c\u5982\u679c\u4e0d\u4e3a\u771f\uff0c\u5219\u4ea7\u751f\u96f6\u884c\u7ed3\u679c\u3002"),(0,i.kt)("h2",{id:"over\u805a\u5408"},"OVER\u805a\u5408"),(0,i.kt)("p",null,"\u6d41\u6279\u5904\u7406\u4efb\u52a1\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"OVER\u805a\u5408\u4f1a\u5bf9\u8f93\u5165\u7684\u6bcf\u4e00\u884c\u6709\u5e8f\u6570\u636e\u8ba1\u7b97\u805a\u5408\u503c\u3002\u4e0eGROUP BY\u805a\u5408\u76f8\u6bd4\uff0cOVER\u805a\u5408\u4e0d\u4f1a\u5c06\u6bcf\u4e2a\u7ec4\u7684\u7ed3\u679c\u884c\u6570\u51cf\u5c11\u5230\u4e00\u884c\u3002\u76f8\u53cd\uff0cOVER\u805a\u5408\u4e3a\u6bcf\u4e2a\u8f93\u5165\u884c\u751f\u6210\u4e00\u4e2a\u805a\u5408\u503c\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u67e5\u8be2\u4f1a\u4e3a\u6bcf\u4e2a\u8ba2\u5355\u8ba1\u7b97\u5728\u5f53\u524d\u8ba2\u5355\u4e4b\u524d\u4e00\u5c0f\u65f6\u5185\u6536\u5230\u7684\u76f8\u540c\u4ea7\u54c1\u7684\u6240\u6709\u8ba2\u5355\u7684\u603b\u548c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, order_time, amount, \n    SUM(amount) OVER (\n        PARTITION BY product\n        ORDER BY order_time\n        RANGE BETWEEN INTERVAL '1' HOUR PRECEDING AND CURRENT ROW\n    ) AS one_hour_prod_amount_sum\nFROM Orders\n;\n")),(0,i.kt)("p",null,"OVER\u7a97\u53e3\u7684\u8bed\u6cd5\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    agg_func(agg_col) OVER (\n        [PARTITION BY col1[, col2, ...]]\n        ORDER BY time_col\n        range_definition\n    ),\n    ...\nFROM ...\n")),(0,i.kt)("p",null,"\u53ef\u4ee5\u5728SELECT\u5b50\u53e5\u4e2d\u5b9a\u4e49\u591a\u4e2aOVER\u7a97\u53e3\u805a\u5408\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u7531\u4e8e\u5f53\u524d\u7684\u9650\u5236\uff0c\u6240\u6709\u805a\u5408\u7684OVER\u7a97\u53e3\u5fc5\u987b\u662f\u76f8\u540c\u7684\u3002"),(0,i.kt)("h3",{id:"order-by"},"ORDER BY"),(0,i.kt)("p",null,"OVER\u7a97\u53e3\u5b9a\u4e49\u5728\u4e00\u4e2a\u6709\u5e8f\u7684\u884c\u5e8f\u5217\u4e0a\u3002\u7531\u4e8e\u8868\u6570\u636e\u6ca1\u6709\u56fa\u5b9a\u7684\u987a\u5e8f\uff0c\u56e0\u6b64order by\u5b50\u53e5\u662f\u5f3a\u5236\u7684\u3002\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0cFlink\u76ee\u524d\u53ea\u652f\u6301\u4ee5\u5347\u5e8f\u65f6\u95f4\u5c5e\u6027\u5217\u987a\u5e8f\u5b9a\u4e49\u7684\u7a97\u53e3\u3002"),(0,i.kt)("h3",{id:"partition-by"},"PARTITION BY"),(0,i.kt)("p",null,"\u53ef\u4ee5\u5728\u5206\u533a\u8868\u4e0a\u5b9a\u4e49OVER\u7a97\u53e3\u3002\u5982\u679c\u5b58\u5728PARTITION BY\u5b50\u53e5\uff0c\u5219\u53ea\u5728\u6bcf\u4e2a\u8f93\u5165\u884c\u6240\u5728\u5206\u533a\u7684\u884c\u4e0a\u8ba1\u7b97\u805a\u5408\u3002"),(0,i.kt)("h3",{id:"range\u5b9a\u4e49"},"Range\u5b9a\u4e49"),(0,i.kt)("p",null,"\u8303\u56f4\u5b9a\u4e49\u6307\u5b9a\u805a\u5408\u4e2d\u5305\u542b\u591a\u5c11\u884c\u3002\u8fd9\u4e2a\u8303\u56f4\u662f\u7528BETWEEN\u5b50\u53e5\u5b9a\u4e49\u7684\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e0b\u8fb9\u754c\u548c\u4e0a\u8fb9\u754c\u3002\u8fb9\u754c\u4e4b\u95f4\u7684\u6240\u6709\u884c\u90fd\u4f1a\u5305\u542b\u5728\u805a\u5408\u4e2d\u3002Flink\u53ea\u652f\u6301CURRENT ROW\u4f5c\u4e3a\u4e0a\u8fb9\u754c\u3002"),(0,i.kt)("p",null,"\u6709\u4e24\u4e2a\u9009\u9879\u53ef\u4ee5\u5b9a\u4e49\u8303\u56f4\uff0cROWS\u95f4\u9694\u548crange\u95f4\u9694\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"RANGE intervals")),(0,i.kt)("p",null,"RANGE\u95f4\u9694\u662f\u5728ORDER BY\u5217\u7684\u503c\u4e0a\u5b9a\u4e49\u7684\uff0c\u5728Flink\u4e2d\uff0c\u9700\u8981\u8be5\u5217\u7c7b\u578b\u4e3a\u65f6\u95f4\u5c5e\u6027\u3002\u4e0b\u9762\u7684RANGE\u95f4\u9694\u5b9a\u4e49\u51fd\u6570\uff1a\u805a\u5408\u4e2d\u5305\u542b\u65f6\u95f4\u4e3a\u5f53\u524d\u884c30\u5206\u949f\u7684\u6240\u6709\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"RANGE BETWEEN INTERVAL '30' MINUTE PRECEDING AND CURRENT ROW\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"ROW intervals")),(0,i.kt)("p",null,"ROWS\u95f4\u9694\u662f\u4e00\u4e2a\u57fa\u4e8e\u8ba1\u6570\u7684\u95f4\u9694\u3002\u5b83\u786e\u5207\u5730\u5b9a\u4e49\u4e86\u805a\u5408\u4e2d\u5305\u542b\u7684\u6570\u636e\u884c\u6570\u3002\u4e0b\u9762\u7684ROWS\u95f4\u9694\u5b9a\u4e49\u51fd\u6570\uff1a\u5f53\u524d\u884c\u548c\u5f53\u524d\u884c\u4e4b\u524d\u768410\u884c(\u603b\u517111\u884c)\u5305\u542b\u5728\u805a\u5408\u4e2d\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ROWS BETWEEN 10 PRECEDING AND CURRENT ROW\n")),(0,i.kt)("h3",{id:"window\u5b50\u53e5"},"WINDOW\u5b50\u53e5"),(0,i.kt)("p",null,"WINDOW\u5b50\u53e5\u53ef\u7528\u4e8e\u5728SELECT\u5b50\u53e5\u4e4b\u5916\u5b9a\u4e49OVER\u7a97\u53e3\u3002\u5b83\u53ef\u4ee5\u4f7f\u67e5\u8be2\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u4e5f\u5141\u8bb8\u6211\u4eec\u7684\u591a\u4e2a\u805a\u5408\u91cd\u7528\u540c\u4e00\u4e2a\u7a97\u53e3\u5b9a\u4e49\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, order_time, amount,\n    SUM(amount) OVER w AS sum_amount,\n    AVG(amount) OVER w AS avg_amount\nFROM Orders\n    WINDOW w AS (\n        PARTITION BY product\n        ORDER BY order_time\n        RANGE BETWEEN INTERVAL '1' HOUR PRECEDING AND CURRENT ROW\n    )\n")),(0,i.kt)("h2",{id:"join"},"Join"),(0,i.kt)("p",null,"\u53ef\u540c\u65f6\u7528\u4e8e\u6d41\u6279\u5904\u7406\u4efb\u52a1\u3002Flink SQL\u652f\u6301\u5bf9\u52a8\u6001\u8868\u6267\u884c\u590d\u6742\u800c\u7075\u6d3b\u7684\u8fde\u63a5\u64cd\u4f5c\u3002\u6709\u51e0\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u8fde\u63a5\u6765\u652f\u6301\u9700\u8981\u7684\u5404\u79cd\u67e5\u8be2\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8868\u7684\u8fde\u63a5\u987a\u5e8f\u5e76\u4e0d\u4f1a\u4f18\u5316\u67e5\u8be2\u6548\u7387\u3002\u8868\u662f\u6309\u7167\u5728FROM\u5b50\u53e5\u4e2d\u6307\u5b9a\u7684\u987a\u5e8f\u8fde\u63a5\u7684\u3002\u901a\u8fc7\u5148\u5217\u51fa\u66f4\u65b0\u9891\u7387\u6700\u4f4e\u7684\u8868\uff0c\u7136\u540e\u5217\u51fa\u66f4\u65b0\u9891\u7387\u6700\u9ad8\u7684\u8868\uff0c\u53ef\u4ee5\u8c03\u6574\u8fde\u63a5\u67e5\u8be2\u7684\u6027\u80fd\u3002")),(0,i.kt)("p",null,"\u786e\u4fdd\u4ee5\u4e0d\u4f1a\u4ea7\u751f\u4ea4\u53c9\u8fde\u63a5(\u7b1b\u5361\u5c14\u79ef)\u7684\u987a\u5e8f\u6307\u5b9a\u8868\u5373\u53ef\uff0c\u4ea4\u53c9\u8fde\u63a5\u4e0d\u53d7\u652f\u6301\uff0c\u800c\u4e14\u4f1a\u5bfc\u81f4\u67e5\u8be2\u5931\u8d25\u3002"),(0,i.kt)("h3",{id:"\u5e38\u89c4join"},"\u5e38\u89c4Join"),(0,i.kt)("p",null,"\u5e38\u89c4\u8fde\u63a5\u662f\u6700\u901a\u7528\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u5176\u4e2d\u4efb\u4f55\u65b0\u8bb0\u5f55\u6216\u5bf9\u8fde\u63a5\u4efb\u610f\u4e00\u4fa7\u7684\u66f4\u6539\u90fd\u4f1a\u5f71\u54cd\u6574\u4e2a\u8fde\u63a5\u7ed3\u679c\u3002\u4f8b\u5982\uff0c\u5de6\u8868\u4ea7\u751f\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u5f53\u4ea7\u54c1id\u5728\u53f3\u8868\u53ef\u4ee5\u627e\u5230\u65f6\uff0c\u5b83\u5c06\u4e0e\u53f3\u8868\u6240\u6709\u4ee5\u524d\u548c\u5c06\u6765\u7684\u8bb0\u5f55\u8fdb\u884c\u8fde\u63a5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM Orders\nINNER JOIN Product\nON Orders.productId = Product.id;\n")),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u5e38\u89c4\u8fde\u63a5\u7684\u8bed\u6cd5\u662f\u6700\u7075\u6d3b\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u7c7b\u578b\u7684\u66f4\u65b0(\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664)\u8f93\u5165\u8868\u3002\u7136\u800c\uff0c\u8be5\u64cd\u4f5c\u5177\u6709\u91cd\u8981\u7684\u542b\u4e49\uff1a\u5b83\u8981\u6c42\u8fde\u63a5\u8f93\u5165\u7684\u4e24\u5f20\u8868\u6c38\u8fdc\u5728Flink\u4e2d\u4fdd\u6301state\u72b6\u6001\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u8fd9\u53d6\u51b3\u4e8e\u6240\u6709\u8f93\u5165\u8868\u548c\u4e2d\u95f4\u8fde\u63a5\u7ed3\u679c\u7684\u4e0d\u540c\u8f93\u5165\u884c\u6570\u3002\u53ef\u4ee5\u9002\u5f53\u914d\u7f6e\u67e5\u8be2\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u8fd9\u53d6\u51b3\u4e8e\u805a\u5408\u7684\u7c7b\u578b\u548c\u4e0d\u540c\u5206\u7ec4\u952e\u7684\u6570\u91cf\u3002\u8bf7\u63d0\u4f9b\u5177\u6709\u6709\u6548\u4fdd\u7559\u95f4\u9694\u7684",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002"),(0,i.kt)("h4",{id:"inner\u7b49\u503c\u8fde\u63a5"},"INNER\u7b49\u503c\u8fde\u63a5"),(0,i.kt)("p",null,"\u8fd4\u56de\u53d7\u8fde\u63a5\u6761\u4ef6\u9650\u5236\u7684\u7b80\u5355\u7b1b\u5361\u5c14\u79ef\u3002\u76ee\u524d\u53ea\u652f\u6301\u7b49\u503c\u8fde\u63a5\uff0c\u5373\u81f3\u5c11\u5177\u6709\u4e00\u4e2a\u5177\u6709\u76f8\u7b49\u8c13\u8bcd\u7684\u8fde\u63a5\u6761\u4ef6\u7684\u8fde\u63a5\u3002\u4e0d\u652f\u6301\u4efb\u610f\u4ea4\u53c9\u6216theta\u8fde\u63a5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM Orders\nINNER JOIN Product\nON Orders.product_id = Product.id;\n")),(0,i.kt)("h4",{id:"outer\u7b49\u503c\u8fde\u63a5"},"OUTER\u7b49\u503c\u8fde\u63a5"),(0,i.kt)("p",null,"\u8fd4\u56de\u9650\u5b9a\u7684\u7b1b\u5361\u5c14\u79ef\u4e2d\u7684\u6240\u6709\u884c(\u5373\uff0c\u4f20\u9012\u5176\u8fde\u63a5\u6761\u4ef6\u7684\u6240\u6709\u5408\u5e76\u884c)\uff0c\u52a0\u4e0a\u8fde\u63a5\u6761\u4ef6\u4e0e\u53e6\u4e00\u4e2a\u8868\u7684\u4efb\u4f55\u884c\u4e0d\u5339\u914d\u7684\u5916\u8868\u4e2d\u6bcf\u4e00\u884c\u7684\u4e00\u4e2a\u526f\u672c\u3002"),(0,i.kt)("p",null,"Flink\u652f\u6301\u5de6\u3001\u53f3\u548c\u5168\u5916\u8fde\u63a5\u3002\u76ee\u524d\uff0c\u53ea\u652f\u6301\u7b49\u503c\u8fde\u63a5\uff0c\u5373\u81f3\u5c11\u5177\u6709\u4e00\u4e2a\u5177\u6709\u76f8\u7b49\u8c13\u8bcd\u7684\u8fde\u63a5\u6761\u4ef6\u7684\u8fde\u63a5\u3002\u4e0d\u652f\u6301\u4efb\u610f\u4ea4\u53c9\u6216theta\u8fde\u63a5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM Orders\nLEFT JOIN Product\nON Orders.product_id = Product.id;\n--------------------------------------------------------------\nSELECT *\nFROM Orders\nRIGHT JOIN Product\nON Orders.product_id = Product.id;\n--------------------------------------------------------------\nSELECT *\nFROM Orders\nFULL OUTER JOIN Product\nON Orders.product_id = Product.id;\n")),(0,i.kt)("h3",{id:"interval-join"},"Interval Join"),(0,i.kt)("p",null,"\u8fd4\u56de\u53d7\u8fde\u63a5\u6761\u4ef6\u548c\u65f6\u95f4\u7ea6\u675f\u9650\u5236\u7684\u7b80\u5355\u7b1b\u5361\u5c14\u79ef\u3002Interval Join\u9700\u8981\u81f3\u5c11\u4e00\u4e2a\u7b49\u8fde\u63a5\u8c13\u8bcd\u548c\u4e00\u4e2a\u8fde\u63a5\u6761\u4ef6\u6765\u9650\u5236\u53cc\u65b9\u7684\u65f6\u95f4\u3002"),(0,i.kt)("p",null,"\u4e24\u4e2a\u9002\u5f53\u7684\u8303\u56f4\u8c13\u8bcd\u5c31\u53ef\u4ee5\u5b9a\u4e49\u8fd9\u6837\u7684\u6761\u4ef6\uff0c\u6bd4\u5982\uff1a<\u3001<=\u3001>=\u3001>\u3001BETWEEN\u6216\u5355\u4e2a\u76f8\u7b49\u8c13\u8bcd\uff0c\u90fd\u53ef\u4ee5\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u8f93\u5165\u8868\u7684\u76f8\u540c\u7c7b\u578b\u7684\u65f6\u95f4\u5c5e\u6027(\u5904\u7406\u65f6\u95f4\u6216\u4e8b\u4ef6\u65f6\u95f4)\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u5982\u679c\u5728\u6536\u5230\u8ba2\u53554\u5c0f\u65f6\u540e\u53d1\u8d27\uff0c\u5219\u6b64\u67e5\u8be2\u5c06\u4f1a\u628a\u6240\u6709\u8ba2\u5355\u4e0e\u5176\u76f8\u5e94\u7684\u53d1\u8d27\u5173\u8054\u8d77\u6765\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM Orders o, Shipments s\nWHERE o.id = s.order_id\n    AND o.order_time BETWEEN s.ship_time - INTERVAL '4' HOUR AND s.ship_time;\n")),(0,i.kt)("p",null,"\u4ee5\u4e0b\u8c13\u8bcd\u662f\u6709\u6548\u7684Interval Join\u6761\u4ef6\u7684\u793a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ltime = rtime\nltime >= rtime AND ltime < rtime + INTERVAL '10' MINUTE\nltime BETWEEN rtime - INTERVAL '10' SECOND AND rtime + INTERVAL '5' SECOND\n")),(0,i.kt)("p",null,"\u6d41\u5f0f\u8fde\u63a5\u67e5\u8be2\u4e0e\u5e38\u89c4\u8fde\u63a5\u76f8\u6bd4\uff0cInterval Join\u53ea\u652f\u6301\u5e26\u6709\u65f6\u95f4\u5c5e\u6027\u7684\u4ec5\u8ffd\u52a0\u8868\u3002\u7531\u4e8e\u65f6\u95f4\u5c5e\u6027\u662f\u51c6\u5355\u8c03\u9012\u589e\u7684\uff0cFlink\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u7ed3\u679c\u6b63\u786e\u6027\u7684\u60c5\u51b5\u4e0b\u5c06\u65e7\u503c\u4ece\u5176\u72b6\u6001\u4e2d\u79fb\u9664\u3002"),(0,i.kt)("h3",{id:"temporal-join"},"Temporal Join"),(0,i.kt)("p",null,"\u65f6\u6001\u8868\u662f\u968f\u7740\u65f6\u95f4\u53d8\u5316\u7684\u8868\uff0c\u5728 flink \u4e2d\u4e5f\u6210\u4e3a\u4e86\u52a8\u6001\u8868\u3002\u65f6\u6001\u8868\u4e2d\u7684\u884c\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u65f6\u95f4\u5468\u671f\u5185\u5b58\u5728\uff0c\u6240\u6709Flink\u8868\u90fd\u662f\u65f6\u6001\u7684(\u52a8\u6001\u7684)\u3002"),(0,i.kt)("p",null,"\u65f6\u6001\u8868\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u7248\u672c\u8868\u7684\u5feb\u7167\uff0c\u662f\u4e00\u4e2a\u53ef\u4ee5\u8ffd\u8e2a\u53d8\u66f4\u5386\u53f2\u8868\uff08\u6bd4\u5982\uff1a\u6570\u636e\u5e93\u53d8\u66f4\u5386\u53f2\uff0c\u5305\u542b\u6240\u6709\u7684\u5feb\u7167\uff09\uff0c\u6216\u8005\u662f\u53d8\u5316\u7684\u7ef4\u8868\uff08\u6bd4\u5982\uff1a\u5305\u542b\u6700\u65b0\u5feb\u7167\u7684\u6570\u636e\u5e93\u8868\uff09\u3002"),(0,i.kt)("h4",{id:"event-time-temporal-join"},"Event Time Temporal Join"),(0,i.kt)("p",null,"\u65f6\u6001\u8fde\u63a5\u5141\u8bb8\u5bf9\u7248\u672c\u5316\u8868\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u5143\u6570\u636e\u6765\u4e30\u5bcc\u8868\u4fe1\u606f\uff0c\u5e76\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u68c0\u7d22\u5b83\u7684\u503c\u3002"),(0,i.kt)("p",null,"\u65f6\u6001\u8fde\u63a5\u53d6\u4efb\u610f\u8868(\u5de6\u8f93\u5165/\u63a2\u67e5\u4fa7)\uff0c\u5e76\u5c06\u6bcf\u4e00\u884c\u4e0e\u7248\u672c\u63a7\u5236\u8868(\u53f3\u8f93\u5165/\u6784\u5efa\u4fa7)\u4e2d\u76f8\u5e94\u884c\u7684\u76f8\u5173\u7248\u672c\u5173\u8054\u8d77\u6765\u3002Flink\u4f7f\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"FOR SYSTEM_TIME AS of"),"\u7684SQL\u8bed\u6cd5\u6839\u636eSQL:2011\u6807\u51c6\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\u3002\u65f6\u6001\u8fde\u63a5\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [column_list]\nFROM table1 [AS <alias1>]\n[LEFT] JOIN table2 FOR SYSTEM_TIME AS OF table1.{ proctime | rowtime } [AS <alias2>]\nON table1.column-name1 = table2.column-name1;\n")),(0,i.kt)("p",null,"\u4f7f\u7528\u4e8b\u4ef6\u65f6\u95f4\u5c5e\u6027(\u5373rowtime\u5c5e\u6027)\uff0c\u53ef\u4ee5\u68c0\u7d22\u952e\u5728\u8fc7\u53bb\u67d0\u4e2a\u65f6\u523b\u7684\u503c\u3002\u8fd9\u5141\u8bb8\u5728\u4e00\u4e2a\u5171\u540c\u7684\u65f6\u95f4\u70b9\u6765\u8fde\u63a5\u4e24\u5f20\u8868\u3002\u7248\u672c\u5316\u8868\u5c06\u5b58\u50a8\u81ea\u6700\u540e\u4e00\u4e2a\u6c34\u5370\u4ee5\u6765\u6240\u6709\u7248\u672c\u7684\u6570\u636e(\u6309\u65f6\u95f4\u6807\u8bc6)\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u8ba2\u5355\u8868\uff0c\u6bcf\u4e2a\u8ba2\u5355\u7684\u4ef7\u683c\u4ee5\u4e0d\u540c\u7684\u8d27\u5e01\u8868\u793a\u3002\u8981\u5c06\u6b64\u8868\u9002\u5f53\u5730\u89c4\u8303\u5316\u4e3a\u5355\u4e00\u8d27\u5e01(\u5982\u7f8e\u5143)\uff0c\u6bcf\u4e2a\u8ba2\u5355\u90fd\u9700\u8981\u4e0e\u4e0b\u5355\u65f6\u7684\u9002\u5f53\u8d27\u5e01\u8f6c\u6362\u6c47\u7387\u8fde\u63a5\u8d77\u6765\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efa\u4e00\u4e2a\u8ba2\u5355\u8868\uff0c\u8fd9\u662f\u4e2a\u6807\u51c6\u7684\u4ec5\u8ffd\u52a0\u8868\u3002\nCREATE TABLE orders (\n    order_id STRING,\n    price DECIMAL(32,2),\n    currency STRING,\n    order_time TIMESTAMP(3),\n    WATERMARK FOR order_time AS order_time\n) WITH (/* ... */);\n\n-- \u5b9a\u4e49\u4e00\u4e2a\u7248\u672c\u5316\u8868\u6765\u5b58\u50a8\u8d27\u5e01\u8f6c\u5316\u7387\u3002\u8fd9\u4e2a\u8868\u53ef\u4ee5\u901a\u8fc7CDC\u5b9a\u4e49\uff0c\u6bd4\u5982Debezium\u3001\u538b\u7f29\u7684kafka\u4e3b\u9898\uff0c\u6216\u8005\u662f\u4efb\u4f55\u5176\u4ed6\u7684\u65b9\u5f0f\u5b9a\u4e49\u7248\u672c\u5316\u8868\u3002\nCREATE TABLE currency_rates (\n    currency STRING,\n    conversion_rate DECIMAL(32, 2),\n    update_time TIMESTAMP(3) METADATA FROM `values.source.timestamp` VIRTUAL\n    WATERMARK FOR update_time AS update_time\n) WITH (\n    'connector' = 'upsert-kafka',\n/* ... */\n);\n\nSELECT\n    order_id,\n    price,\n    currency,\n    conversion_rate,\n    order_time,\nFROM orders\nLEFT JOIN currency_rates FOR SYSTEM_TIME AS OF orders.order_time\nON orders.currency = currency_rates.currency;\norder_id  price  currency  conversion_rate  order_time\n========  =====  ========  ===============  =========\no_001     11.11  EUR       1.14             12:00:00\no_002     12.51  EUR       1.10             12:06:00\n\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e8b\u4ef6\u65f6\u95f4\u65f6\u6001\u8fde\u63a5\u662f\u7531\u5de6\u53f3\u4e24\u8fb9\u7684\u6c34\u5370\u89e6\u53d1\u7684\uff0c\u8fde\u63a5\u7684\u4e24\u5f20\u8868\u90fd\u5fc5\u987b\u6b63\u786e\u5730\u8bbe\u7f6e\u6c34\u5370\u3002"),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e8b\u4ef6\u65f6\u95f4\u65f6\u6001\u8fde\u63a5\u9700\u8981\u6709\u5305\u542b\u4e3b\u952e\u7684\u7b49\u503c\u8fde\u63a5\u6761\u4ef6\uff0c\u4f8b\u5982\uff0cproduct_changelog\u8868\u7684\u4e3b\u952eP.product_id\u88ab\u7ea6\u675f\u5728\u6761\u4ef6O.product_id = P.product_id\u4e2d\u3002"),(0,i.kt)("p",null,"\u4e0e\u5e38\u89c4\u8fde\u63a5\u76f8\u6bd4\uff0c\u5c3d\u7ba1\u6784\u5efa\u7aef\uff08\u53f3\u8868\uff09\u53d1\u751f\u4e86\u66f4\u6539\uff0c\u4f46\u524d\u9762\u7684\u65f6\u6001\u8868\u7ed3\u679c\u5e76\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u4e0e\u95f4\u9694\u8fde\u63a5\uff08Interval Join\uff09\u76f8\u6bd4\uff0c\u65f6\u6001\u8868\u8fde\u63a5\u6ca1\u6709\u5b9a\u4e49\u8fde\u63a5\u8bb0\u5f55\u7684\u65f6\u95f4\u7a97\u53e3\u3002"),(0,i.kt)("p",null,"\u95f4\u9694\u8fde\u63a5\u5305\u542b\u65f6\u95f4\u7a97\u53e3\uff0c\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u5de6\u53f3\u8868\u6570\u636e\u90fd\u4f1a\u8fdb\u884c\u8fde\u63a5\u3002\u63a2\u6d4b\u7aef\uff08\u5de6\u8868\uff09\u8bb0\u5f55\u603b\u662f\u5728time\u5c5e\u6027\u6307\u5b9a\u7684\u65f6\u95f4\u4e0e\u6784\u5efa\u7aef\u5bf9\u5e94\u65f6\u95f4\u7684\u6570\u636e\u8fdb\u884c\u8fde\u63a5\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64\uff0c\u6784\u5efa\u7aef\u7684\u884c\u53ef\u80fd\u662f\u4efb\u610f\u65e7\u7684\u3002\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u4e0d\u518d\u9700\u8981\u7684\u8bb0\u5f55\u7248\u672c(\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u4e3b\u952e)\u5c06\u4ece\u72b6\u6001\u4e2d\u5220\u9664\u3002"),(0,i.kt)("h4",{id:"processing-time-temporal-join"},"Processing Time Temporal Join"),(0,i.kt)("p",null,"\u5904\u7406\u65f6\u95f4\u65f6\u6001\u8868\u8fde\u63a5\u4f7f\u7528\u5904\u7406\u65f6\u95f4\u5c5e\u6027\u5c06\u884c\u4e0e\u5916\u90e8\u7248\u672c\u8868\u4e2d\u952e\u5bf9\u5e94\u7684\u6700\u65b0\u7248\u672c\u6570\u636e\u8fdb\u884c\u5173\u8054\u3002"),(0,i.kt)("p",null,"\u6839\u636e\u5b9a\u4e49\uff0c\u4f7f\u7528\u5904\u7406\u65f6\u95f4\u5c5e\u6027\uff0c\u8fde\u63a5\u5c06\u59cb\u7ec8\u8fd4\u56de\u7ed9\u5b9a\u952e\u7684\u6700\u65b0\u503c\u3002\u53ef\u4ee5\u5c06\u67e5\u8be2\u8868\u770b\u4f5c\u7b80\u5355\u7684HashMap<K, V>\n\uff0c\u5b83\u5b58\u50a8\u4e86\u6765\u81ea\u6784\u5efa\u7aef\u7684\u6240\u6709\u8bb0\u5f55\u3002\u8fd9\u79cd\u8fde\u63a5\u7684\u5f3a\u5927\u4e4b\u5904\u662f\uff0c\u5f53\u4e0d\u80fd\u5728Flink\u4e2d\u5c06\u8868\u5177\u4f53\u5316\u4e3a\u52a8\u6001\u8868\u65f6\uff0c\u5b83\u5141\u8bb8Flink\u76f4\u63a5\u9488\u5bf9\u5916\u90e8\u7cfb\u7edf\u5de5\u4f5c\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u5904\u7406\u65f6\u95f4\u65f6\u6001\u8868\u8fde\u63a5\u793a\u4f8b\u663e\u793a\u4e86\u4e00\u4e2a\u53ea\u8ffd\u52a0\u7684\u8868\u8ba2\u5355\uff0c\u5b83\u4e0eLatestRates\u8868\u8fde\u63a5\u3002LatestRates\u662f\u4e00\u4e2a\u7ef4\u8868(\u4f8b\u5982HBase\u8868)\uff0c\u5b58\u50a8\u6700\u65b0\u7684\u6bd4\u4f8b\u3002"),(0,i.kt)("p",null,"\u572810:15,10:30,10:52,LatestRates\u7684\u5185\u5bb9\u5982\u4e0b:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"10:15> SELECT * FROM LatestRates;\n\ncurrency   rate\n======== ======\nUS Dollar   102\nEuro        114\nYen           1\n\n10:30> SELECT * FROM LatestRates;\n\ncurrency   rate\n======== ======\nUS Dollar   102\nEuro        114\nYen           1\n\n10:52> SELECT * FROM LatestRates;\n\ncurrency   rate\n======== ======\nUS Dollar   102\nEuro        116     <==== changed from 114 to 116\nYen           1\n")),(0,i.kt)("p",null,"10:15\u548c10:30\u7684LatestRates\u7684\u5185\u5bb9\u662f\u76f8\u7b49\u7684\u3002\u6b27\u5143\u6c47\u7387\u572810:52\u4ece114\u53d8\u5230\u4e86116\u3002"),(0,i.kt)("p",null,"\u8ba2\u5355\u662f\u4e00\u4e2a\u4ec5\u8ffd\u52a0\u8868\uff0c\u8868\u793a\u7ed9\u5b9a\u91d1\u989d\u548c\u7ed9\u5b9a\u8d27\u5e01\u7684\u652f\u4ed8\u6570\u636e\u3002\u4f8b\u5982\uff0c\u572810:15\u6709\u4e00\u4e2a2\u6b27\u5143\u7684\u8ba2\u5355\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM Orders;\n\namount currency\n====== =========\n     2 Euro             <== arrived at time 10:15\n     1 US Dollar        <== arrived at time 10:30\n     2 Euro             <== arrived at time 10:52\n")),(0,i.kt)("p",null,"\u6839\u636e\u8fd9\u4e9b\u8868\uff0c\u6765\u5c06\u6240\u6709\u8ba2\u5355\u8f6c\u6362\u4e3a\u76f8\u540c\u7684\u8d27\u5e01\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"amount currency     rate   amount*rate\n====== ========= ======= ============\n     2 Euro          114          228    <== arrived at time 10:15\n     1 US Dollar     102          102    <== arrived at time 10:30\n     2 Euro          116          232    <== arrived at time 10:52\n")),(0,i.kt)("p",null,"\u5728\u65f6\u6001\u8868\u8fde\u63a5\u7684\u5e2e\u52a9\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728SQL\u4e2d\u8fdb\u884c\u8fd9\u6837\u4e00\u4e2a\u67e5\u8be2\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\no.amount, o.currency, r.rate, o.amount * r.rate\nFROM Orders AS o\nJOIN LatestRates FOR SYSTEM_TIME AS OF o.proctime AS r\nON r.currency = o.currency;\n")),(0,i.kt)("p",null,"\u63a2\u6d4b\u7aef\uff08\u5de6\u8868\uff09\u4e2d\u7684\u6bcf\u6761\u8bb0\u5f55\u90fd\u5c06\u4e0e\u6784\u5efa\u7aef\u8868\uff08\u53f3\u8868\uff09\u7684\u5f53\u524d\u7248\u672c\u8bb0\u5f55\u8fdb\u884c\u8fde\u63a5\u3002\u5728\u4e0a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u4e86\u5904\u7406\u65f6\u95f4\u6982\u5ff5\uff0c\u56e0\u6b64\u5728\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u65b0\u6dfb\u52a0\u7684\u8bb0\u5f55\u603b\u662f\u4e0e\u6700\u65b0\u7248\u672c\u7684LatestRates\u8868\u6570\u636e\u8fde\u63a5\u3002"),(0,i.kt)("p",null,"\u5904\u7406\u65f6\u95f4\u7684\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u7684\u3002\u5904\u7406\u65f6\u95f4\u65f6\u6001\u8fde\u63a5\u6700\u5e38\u4f7f\u7528\u5916\u90e8\u8868(\u5373\u7ef4\u5ea6\u8868)\u4f5c\u4e3a\u6784\u5efa\u7aef\uff08\u53f3\u8868\uff09\u3002"),(0,i.kt)("p",null,"\u4e0e\u5e38\u89c4\u8fde\u63a5\u76f8\u6bd4\uff0c\u5c3d\u7ba1\u6784\u5efa\u7aef\uff08\u53f3\u8868\uff09\u53d1\u751f\u4e86\u66f4\u6539\uff0c\u524d\u9762\u7684\u65f6\u6001\u8868\u7ed3\u679c\u4e5f\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u4e0e\u95f4\u9694\u8fde\u63a5\u76f8\u6bd4\uff0c\u65f6\u6001\u8868\u8fde\u63a5\u6ca1\u6709\u5b9a\u4e49\u8bb0\u5f55\u8fde\u63a5\u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u65e7\u884c\u4e0d\u4f1a\u8fdb\u884c\u72b6\u6001\u5b58\u50a8\u3002"),(0,i.kt)("h3",{id:"lookup-join"},"Lookup Join"),(0,i.kt)("p",null,"Lookup Join\u901a\u5e38\u4f7f\u7528\u4ece\u5916\u90e8\u7cfb\u7edf\u67e5\u8be2\u7684\u6570\u636e\u6765\u4e30\u5bcc\u8868\u3002\u8fde\u63a5\u8981\u6c42\u4e00\u4e2a\u8868\u5177\u6709\u5904\u7406\u65f6\u95f4\u5c5e\u6027\uff0c\u53e6\u4e00\u4e2a\u8868\u7531lookup source\u8fde\u63a5\u5668\u652f\u6301\u3002"),(0,i.kt)("p",null,"\u67e5\u627e\u8fde\u63a5\u4f7f\u7528\u4e0a\u9762\u7684Processing Time Temporal join\u8bed\u6cd5\uff0c\u5e76\u4f7f\u7528\u67e5\u627e\u6e90\u8fde\u63a5\u5668\u652f\u6301\u8868\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u793a\u4f8b\u663e\u793a\u4e86\u6307\u5b9aLookup Join\u7684\u8bed\u6cd5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- Customers\u901a\u8fc7JDBC\u8fde\u63a5\u5668\u521b\u5efa\uff0c\u5e76\u4e14\u53ef\u4ee5\u88ab\u7528\u4e8elookup joins\nCREATE TEMPORARY TABLE Customers (\n    id INT,\n    name STRING,\n    country STRING,\n    zip STRING\n) WITH (\n    'connector' = 'jdbc',\n    'url' = 'jdbc:mysql://mysqlhost:3306/customerdb',\n    'table-name' = 'customers'\n);\n\n-- \u901a\u8fc7customer\u6765\u4e30\u5bcc\u8ba2\u5355\u4fe1\u606f\nSELECT o.order_id, o.total, c.country, c.zip\nFROM Orders AS o\nJOIN Customers FOR SYSTEM_TIME AS OF o.proc_time AS c\nON o.customer_id = c.id;\n")),(0,i.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cOrders\u8868\u4f7f\u7528\u6765\u81eaMySQL\u6570\u636e\u5e93\u4e2d\u7684Customers\u8868\u7684\u6570\u636e\u8fdb\u884c\u6570\u636e\u4fe1\u606f\u6269\u5c55\u3002\u901a\u8fc7\u540e\u9762\u5904\u7406\u65f6\u95f4\u5c5e\u6027\u7684FOR SYSTEM_TIME AS OF\u5b50\u53e5\u786e\u4fdd\u5728\u8fde\u63a5\u64cd\u4f5c\u5904\u7406Orders\u884c\u65f6\uff0c\nOrders\u8868\u7684\u6bcf\u4e00\u884c\u90fd\u4e0e\u90a3\u4e9b\u5339\u914d\u8fde\u63a5\u8c13\u8bcd\u7684Customers\u884c\u8fde\u63a5\u3002\u5b83\u8fd8\u9632\u6b62\u5728\u5c06\u6765\u66f4\u65b0\u5df2\u8fde\u63a5\u7684Customer\u884c\u65f6\u66f4\u65b0\u8fde\u63a5\u7ed3\u679c\u3002"),(0,i.kt)("p",null,"Lookup Join\u8fd8\u9700\u8981\u4e00\u4e2a\u5f3a\u5236\u76f8\u7b49\u8054\u63a5\u8c13\u8bcd\uff0c\u5982\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684o.customer_id = c.id\u3002"),(0,i.kt)("h3",{id:"array\u5c55\u5f00"},"Array\u5c55\u5f00"),(0,i.kt)("p",null,"\u4e3a\u7ed9\u5b9a\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8fd4\u56de\u65b0\u884c\u3002\u76ee\u524d\u8fd8\u4e0d\u652f\u6301WITH ORDINALITY\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, t.tag\nFROM Orders\nCROSS JOIN UNNEST(tags) AS t (tag);\n")),(0,i.kt)("h3",{id:"\u8868\u51fd\u6570"},"\u8868\u51fd\u6570"),(0,i.kt)("p",null,"\u5c06\u8868\u4e0e\u8868\u51fd\u6570\u7684\u7ed3\u679c\u8fdb\u884c\u8fde\u63a5\u3002\u5de6\u8868(\u5916\u90e8\u8868)\u7684\u6bcf\u4e00\u884c\u90fd\u4e0e\u5bf9\u5e94\u7684table\u51fd\u6570\u8c03\u7528\u4ea7\u751f\u7684\u6240\u6709\u884c\u8fde\u63a5\u3002\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u8868\u51fd\u6570\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u6ce8\u518c\u3002"),(0,i.kt)("h4",{id:"inner-join"},"INNER JOIN"),(0,i.kt)("p",null,"\u5982\u679c\u5de6\u8868(\u5916\u90e8)\u7684\u8868\u51fd\u6570\u8c03\u7528\u8fd4\u56de\u7a7a\u7ed3\u679c\uff0c\u5219\u5220\u9664\u8be5\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, res\nFROM Orders, LATERAL TABLE(table_func(order_id)) t(res);\n")),(0,i.kt)("h4",{id:"left-outer-join"},"LEFT OUTER JOIN"),(0,i.kt)("p",null,"\u5982\u679c\u8868\u51fd\u6570\u8c03\u7528\u8fd4\u56de\u7a7a\u7ed3\u679c\uff0c\u5219\u4fdd\u7559\u76f8\u5e94\u7684\u5de6\u8868\u6570\u636e\u884c\uff0c\u5e76\u5728\u7ed3\u679c\u4e2d\u586b\u5145\u7a7a\u503c\u3002\u76ee\u524d\uff0c\u9488\u5bf9\u8868\u7684\u5de6\u5916\u8fde\u63a5\u9700\u8981\u5728ON\u5b50\u53e5\u4e2d\u4f7f\u7528TRUE\u5b57\u9762\u503c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT order_id, res\nFROM Orders\nLEFT OUTER JOIN LATERAL TABLE(table_func(order_id)) t(res)\nON TRUE;\n")),(0,i.kt)("h2",{id:"window-join"},"window join"),(0,i.kt)("p",null,"\u4ece fink-1.14.x \u5f00\u59cb\u652f\u6301\u3002"),(0,i.kt)("p",null,"\u53ea\u80fd\u5728\u6d41\u5f0f\u5904\u7406\u4e2d\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"window join \u4f1a\u5c06\u65f6\u95f4\u5c3a\u5ea6\u6dfb\u52a0\u5230\u4ed6\u4eec\u7684 join \u6807\u51c6\u4e2d\u3002\u5982\u6b64\u4e00\u6765\uff0c window join \u5c31\u4f1a\u5c06\u4e24\u4e2a\u6d41\u4e2d\u540c\u4e00\u4e2a\u7a97\u53e3\u5185\u62e5\u6709\u4e24\u4e2a\u76f8\u540c key \u7684\u5143\u7d20 join \u8d77\u6765\u3002\nwindow join \u7684\u8bed\u4e49\u548c DataStream window join \u7684\u8bed\u4e49\u76f8\u540c\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e streaming \u67e5\u8be2\uff0c\u548c\u5176\u4ed6\u7684\u6d41\u8868 join \u4e0d\u540c\uff0c window join \u4e0d\u4f1a\u9a6c\u4e0a\u53d1\u5c04\u7ed3\u679c\u6570\u636e\uff0c\u800c\u662f\u5728\u7a97\u53e3\u7ed3\u675f\u4e4b\u540e\u53d1\u5c04\u6700\u7ec8\u7684\u7ed3\u679c\u3002\u6b64\u5916\uff0c\u5728\u4e0d\u9700\u8981\u4fdd\u5b58\u6570\u636e\u65f6\uff0c window join \u4f1a\u6e05\u9664\u6240\u6709\u7684\u4e2d\u95f4\u72b6\u6001\u6570\u636e\u3002"),(0,i.kt)("p",null,"\u901a\u5e38\u6765\u8bf4\uff0cwindow join \u4f1a\u548c\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\u3002\u56e0\u6b64\uff0c\u57fa\u4e8e\u7a97\u53e3\u8868\u503c\u51fd\u6570\uff0cwindow join \u540e\u9762\u53ef\u4ee5\u63a5\u53d7\u5176\u4ed6\u51fd\u6570\u64cd\u4f5c\uff0c\u6bd4\u5982\u7a97\u53e3\u805a\u5408\u3001\u7a97\u53e3 TopN\u3001window join\u3002"),(0,i.kt)("p",null,"\u76ee\u524d\uff0cwindow join \u8981\u6c42 join \u7684\u8f93\u5165\u8868\u6709\u76f8\u540c\u7684\u7a97\u53e3\u5f00\u59cb\u548c\u76f8\u540c\u7684\u7a97\u53e3\u7ed3\u675f\u3002"),(0,i.kt)("p",null,"window join \u652f\u6301 INNER\u3001LEFT\u3001RIGHT\u3001FULL OUTER\u3001ANTI\u3001SEMI JOIN\u3002"),(0,i.kt)("h3",{id:"innerleftrightfull-outer"},"INNER/LEFT/RIGHT/FULL OUTER"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u5728 window join \u8bed\u53e5\u4e2d\u4f7f\u7528 INNER/LEFT/RIGHT/FULL OUTER \u7684\u8bed\u6cd5\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT ...\nFROM L\n[LEFT|RIGHT|FULL OUTER] JOIN R -- L \u548c R \u8868\u53ef\u4ee5\u662f\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4ea7\u751f\u7684\u8868\nON L.window_start = R.window_start AND L.window_end = R.window_end AND ...\n")),(0,i.kt)("p",null,"INNER/LEFT/RIGHT/FULL OUTER WINDOW JOIN \u7684\u8bed\u6cd5\u5f7c\u6b64\u662f\u975e\u5e38\u76f8\u4f3c\u7684\uff0c\u4e0b\u9762\u6211\u4eec\u53ea\u7ed9\u51fa\u4e86 FULL OUTER JOIN \u7684\u4f8b\u5b50\u3002"),(0,i.kt)("p",null,"\u5f53\u4f7f\u7528 window join \u65f6\uff0c\u5728\u4e00\u4e2a\u6eda\u52a8\u7a97\u53e3\u4e2d\uff0c\u62e5\u6709\u76f8\u540c key \u7684\u6240\u6709\u5143\u7d20\u5c06\u4f1a join \u5230\u4e00\u8d77\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u5728 window join \u7684\u6eda\u52a8\u7a97\u53e3\u4e0a\u4f7f\u7528\u4e86\u4e00\u4e2a\u6eda\u52a8\u7a97\u53e3\u8868\u503c\u51fd\u6570\u3002"),(0,i.kt)("p",null,"\u901a\u8fc7\u5c06 join \u7684\u7a97\u53e3\u9650\u5236\u5728\u4e94\u5206\u949f\u95f4\u9694\uff0c\u6211\u4eec\u5c06\u4f1a\u622a\u65ad\u6570\u636e\u96c6\u4e3a\u4e24\u4e2a\u4e0d\u540c\u7684\u7a97\u53e3\uff1a[12:00, 12:05) \u548c [12:05, 12:10)\u3002L2 \u548c R2 \u884c\u4e0d\u4f1a join \u5230\u4e00\u8d77\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5904\u4e8e\u4e0d\u540c\u7684\u7a97\u53e3\u4e2d\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"desc LeftTable;\n+----------+------------------------+------+-----+--------+----------------------------------+\n|     name |                   type | null | key | extras |                        watermark |\n+----------+------------------------+------+-----+--------+----------------------------------+\n| row_time | TIMESTAMP(3) *ROWTIME* | true |     |        | `row_time` - INTERVAL '1' SECOND |\n|      num |                    INT | true |     |        |                                  |\n|       id |                 STRING | true |     |        |                                  |\n+----------+------------------------+------+-----+--------+----------------------------------+\n\nSELECT * FROM LeftTable;\n+------------------+-----+----+\n|         row_time | num | id |\n+------------------+-----+----+\n| 2020-04-15 12:02 |   1 | L1 |\n| 2020-04-15 12:06 |   2 | L2 |\n| 2020-04-15 12:03 |   3 | L3 |\n+------------------+-----+----+\n\ndesc RightTable;\n+----------+------------------------+------+-----+--------+----------------------------------+\n|     name |                   type | null | key | extras |                        watermark |\n+----------+------------------------+------+-----+--------+----------------------------------+\n| row_time | TIMESTAMP(3) *ROWTIME* | true |     |        | `row_time` - INTERVAL '1' SECOND |\n|      num |                    INT | true |     |        |                                  |\n|       id |                 STRING | true |     |        |                                  |\n+----------+------------------------+------+-----+--------+----------------------------------+\n\nSELECT * FROM RightTable;\n+------------------+-----+----+\n|         row_time | num | id |\n+------------------+-----+----+\n| 2020-04-15 12:01 |   2 | R2 |\n| 2020-04-15 12:04 |   3 | R3 |\n| 2020-04-15 12:05 |   4 | R4 |\n+------------------+-----+----+\nSELECT L.num as L_Num, L.id as L_Id, R.num as R_Num, R.id as R_Id, L.window_start, L.window_end\nFROM\n  (\n  SELECT * FROM TABLE(TUMBLE(TABLE LeftTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n  ) L\nFULL JOIN\n  (\n  SELECT * FROM TABLE(TUMBLE(TABLE RightTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n  ) R\nON L.num = R.num AND L.window_start = R.window_start AND L.window_end = R.window_end;\n+-------+------+-------+------+------------------+------------------+\n| L_Num | L_Id | R_Num | R_Id |     window_start |       window_end |\n+-------+------+-------+------+------------------+------------------+\n|     1 |   L1 |  null | null | 2020-04-15 12:00 | 2020-04-15 12:05 |\n|  null | null |     2 |   R2 | 2020-04-15 12:00 | 2020-04-15 12:05 |\n|     3 |   L3 |     3 |   R3 | 2020-04-15 12:00 | 2020-04-15 12:05 |\n|     2 |   L2 |  null | null | 2020-04-15 12:05 | 2020-04-15 12:10 |\n|  null | null |     4 |   R4 | 2020-04-15 12:05 | 2020-04-15 12:10 |\n+-------+------+-------+------+------------------+------------------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\u7a97\u53e3 join \u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5355\u5c55\u793a\u4e86\u65f6\u95f4\u6233\u503c\uff0c\u5e76\u6ca1\u6709\u5c55\u793a\u540e\u9762\u76840\u3002\n\u6bd4\u5982\uff0cTIMESTAMP(3) \u7c7b\u578b\u7684\u6570\u636e\uff0c\u5728 FLINK CLI \u4e2d\uff0c2020-04-15 08:05 \u5e94\u8be5\u88ab\u5c55\u793a\u4e3a 2020-04-15 08:05:00.000 \u3002"),(0,i.kt)("h3",{id:"semi"},"SEMI"),(0,i.kt)("p",null,"\u5728\u540c\u4e00\u4e2a\u7a97\u53e3\u4e2d\uff0c\u5982\u679c\u5de6\u8868\u548c\u53f3\u8868\u81f3\u5c11\u6709\u4e00\u884c\u5339\u914d\uff0c\u5219 semi window join \u4f1a\u8fd4\u56de\u5de6\u8868\u7684\u4e00\u884c\u8bb0\u5f55\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"\nSELECT *\nFROM\n    (\n    SELECT * FROM TABLE(TUMBLE(TABLE LeftTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n    ) L\nWHERE L.num IN\n    (\n    SELECT num\n    FROM\n        (   \n        SELECT * FROM TABLE(TUMBLE(TABLE RightTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n        ) R\n    WHERE L.window_start = R.window_start AND L.window_end = R.window_end\n    );\n+------------------+-----+----+------------------+------------------+-------------------------+\n|         row_time | num | id |     window_start |       window_end |            window_time  |\n+------------------+-----+----+------------------+------------------+-------------------------+\n| 2020-04-15 12:03 |   3 | L3 | 2020-04-15 12:00 | 2020-04-15 12:05 | 2020-04-15 12:04:59.999 |\n+------------------+-----+----+------------------+------------------+-------------------------+\n\nSELECT *\nFROM\n    (\n    SELECT * FROM TABLE(TUMBLE(TABLE LeftTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n    ) L\nWHERE EXISTS\n    (\n    SELECT *\n    FROM\n        (\n        SELECT * FROM TABLE(TUMBLE(TABLE RightTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n        ) R\n    WHERE L.num = R.num AND L.window_start = R.window_start AND L.window_end = R.window_end\n    );\n+------------------+-----+----+------------------+------------------+-------------------------+\n|         row_time | num | id |     window_start |       window_end |            window_time  |\n+------------------+-----+----+------------------+------------------+-------------------------+\n| 2020-04-15 12:03 |   3 | L3 | 2020-04-15 12:00 | 2020-04-15 12:05 | 2020-04-15 12:04:59.999 |\n+------------------+-----+----+------------------+------------------+-------------------------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\u7a97\u53e3 join \u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5355\u5c55\u793a\u4e86\u65f6\u95f4\u6233\u503c\uff0c\u5e76\u6ca1\u6709\u5c55\u793a\u540e\u9762\u76840\u3002\n\u6bd4\u5982\uff0cTIMESTAMP(3) \u7c7b\u578b\u7684\u6570\u636e\uff0c\u5728 FLINK CLI \u4e2d\uff0c2020-04-15 08:05 \u5e94\u8be5\u88ab\u5c55\u793a\u4e3a 2020-04-15 08:05:00.000 \u3002"),(0,i.kt)("h3",{id:"anti"},"ANTI"),(0,i.kt)("p",null,"anti window join \u4f1a\u8fd4\u56de\u540c\u4e00\u4e2a\u7a97\u53e3\u4e2d\u6240\u6709\u6ca1\u6709 join \u5230\u4e00\u8d77\u7684\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"\nSELECT *\nFROM\n    (\n    SELECT * FROM TABLE(TUMBLE(TABLE LeftTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n    ) L\nWHERE L.num NOT IN\n    (\n    SELECT num\n    FROM\n        (   \n        SELECT * FROM TABLE(TUMBLE(TABLE RightTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n        ) R\n    WHERE L.window_start = R.window_start AND L.window_end = R.window_end\n    );\n+------------------+-----+----+------------------+------------------+-------------------------+\n|         row_time | num | id |     window_start |       window_end |            window_time  |\n+------------------+-----+----+------------------+------------------+-------------------------+\n| 2020-04-15 12:02 |   1 | L1 | 2020-04-15 12:00 | 2020-04-15 12:05 | 2020-04-15 12:04:59.999 |\n| 2020-04-15 12:06 |   2 | L2 | 2020-04-15 12:05 | 2020-04-15 12:10 | 2020-04-15 12:09:59.999 |\n+------------------+-----+----+------------------+------------------+-------------------------+\n\nSELECT *\nFROM\n    (\n    SELECT * FROM TABLE(TUMBLE(TABLE LeftTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n    ) L\nWHERE NOT EXISTS\n    (\n    SELECT *\n    FROM\n        (\n        SELECT * FROM TABLE(TUMBLE(TABLE RightTable, DESCRIPTOR(row_time), INTERVAL '5' MINUTES))\n        ) R\n    WHERE L.num = R.num AND L.window_start = R.window_start AND L.window_end = R.window_end\n    );\n+------------------+-----+----+------------------+------------------+-------------------------+\n|         row_time | num | id |     window_start |       window_end |            window_time  |\n+------------------+-----+----+------------------+------------------+-------------------------+\n| 2020-04-15 12:02 |   1 | L1 | 2020-04-15 12:00 | 2020-04-15 12:05 | 2020-04-15 12:04:59.999 |\n| 2020-04-15 12:06 |   2 | L2 | 2020-04-15 12:05 | 2020-04-15 12:10 | 2020-04-15 12:09:59.999 |\n+------------------+-----+----+------------------+------------------+-------------------------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\u7a97\u53e3 join \u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5355\u5c55\u793a\u4e86\u65f6\u95f4\u6233\u503c\uff0c\u5e76\u6ca1\u6709\u5c55\u793a\u540e\u9762\u76840\u3002\n\u6bd4\u5982\uff0cTIMESTAMP(3) \u7c7b\u578b\u7684\u6570\u636e\uff0c\u5728 FLINK CLI \u4e2d\uff0c2020-04-15 08:05 \u5e94\u8be5\u88ab\u5c55\u793a\u4e3a 2020-04-15 08:05:00.000 \u3002"),(0,i.kt)("h3",{id:"\u9650\u5236"},"\u9650\u5236"),(0,i.kt)("h4",{id:"join\u6761\u4ef6\u7684\u9650\u5236"},"join\u6761\u4ef6\u7684\u9650\u5236"),(0,i.kt)("p",null,"\u76ee\u524d\uff0cwindow join \u8981\u6c42\u4e24\u5f20\u8868\u62e5\u6709\u76f8\u540c\u7684\u7a97\u53e3\u5f00\u59cb\u548c\u7a97\u53e3\u7ed3\u675f\u3002\u672a\u6765\uff0c\u6211\u4eec\u7b80\u5316 join on \u6761\u4ef6\uff0c\u5982\u679c\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e3a\u6eda\u52a8\u6216\u8005\u6ed1\u52a8\uff0c\u5219\u53ea\u9700\u8981\u4e24\u5f20\u8868\u6709\u76f8\u540c\u7684\u7a97\u53e3\u5f00\u59cb\u5373\u53ef\u3002"),(0,i.kt)("h4",{id:"\u5728\u8f93\u5165\u8868\u4e0a\u4f7f\u7528\u7a97\u53e3tvf\u7684\u9650\u5236"},"\u5728\u8f93\u5165\u8868\u4e0a\u4f7f\u7528\u7a97\u53e3TVF\u7684\u9650\u5236"),(0,i.kt)("p",null,"\u76ee\u524d\uff0c\u5de6\u8868\u548c\u53f3\u8868\u5fc5\u987b\u6709\u76f8\u540c\u7684\u7a97\u53e3\u8868\u503c\u51fd\u6570\u3002\u5c06\u6765\u6211\u4eec\u4f1a\u6269\u5c55\u8be5\u529f\u80fd\uff0c\u6bd4\u5982\uff0c\u6709\u7528\u76f8\u540c\u7a97\u53e3\u5927\u5c0f\u7684\u6eda\u52a8\u7a97\u53e3 join \u6ed1\u52a8\u7a97\u53e3\u3002"),(0,i.kt)("h4",{id:"\u76f4\u63a5\u5728\u7a97\u53e3tvf\u540e\u4f7f\u7528window-join\u7684\u9650\u5236"},"\u76f4\u63a5\u5728\u7a97\u53e3TVF\u540e\u4f7f\u7528window join\u7684\u9650\u5236"),(0,i.kt)("p",null,"\u76ee\u524d\uff0c\u5982\u679c\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e4b\u540e\u4f7f\u7528 window join \uff0c\u7a97\u53e3\u51fd\u6570\u53ea\u80fd\u662f\u6eda\u52a8\u7a97\u53e3\u3001\u6ed1\u52a8\u7a97\u53e3\u6216\u8005\u662f\u7d2f\u8ba1\u7a97\u53e3\uff0c\u800c\u4e0d\u80fd\u662f\u4f1a\u8bdd\u7a97\u53e3\u3002"),(0,i.kt)("h2",{id:"\u96c6\u5408\u64cd\u4f5c"},"\u96c6\u5408\u64cd\u4f5c"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("h3",{id:"union"},"UNION"),(0,i.kt)("p",null,"UNION\u548cUNION ALL\u4f1a\u8fd4\u56de\u4e24\u5f20\u8868\u7684\u6240\u6709\u884c\u3002UNION\u4f1a\u5bf9\u7ed3\u679c\u53bb\u91cd\uff0c\u800cUNION ALL\u4e0d\u4f1a\u5bf9\u7ed3\u679c\u884c\u53bb\u91cd\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"Flink SQL> create view t1(s) as values ('c'), ('a'), ('b'), ('b'), ('c');\nFlink SQL> create view t2(s) as values ('d'), ('e'), ('a'), ('b'), ('b');\nFlink SQL> (SELECT s FROM t1) UNION (SELECT s FROM t2);\n+---+\n| s|\n+---+\n| c|\n| a|\n| b|\n| d|\n| e|\n+---+\nFlink SQL> (SELECT s FROM t1) UNION ALL (SELECT s FROM t2);\n+---+\n| s|\n+---+\n| c|\n| a|\n| b|\n| b|\n| c|\n| d|\n| e|\n| a|\n| b|\n| b|\n+---+\n")),(0,i.kt)("h3",{id:"intersect"},"INTERSECT"),(0,i.kt)("p",null,"\u4ea4\u96c6"),(0,i.kt)("p",null,"INTERSECT\u548cINTERSECT ALL\u8fd4\u56de\u5728\u4e24\u4e2a\u8868\u4e2d\u90fd\u5b58\u5728\u7684\u884c\u3002INTERSECT\u4f1a\u5bf9\u7ed3\u679c\u884c\u53bb\u91cd\uff0c\u800cINTERSECT ALL\u4e0d\u4f1a\u53bb\u91cd\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"Flink SQL> (SELECT s FROM t1) INTERSECT (SELECT s FROM t2);\n+---+\n| s|\n+---+\n| a|\n| b|\n+---+\nFlink SQL> (SELECT s FROM t1) INTERSECT ALL (SELECT s FROM t2);\n+---+\n| s|\n+---+\n| a|\n| b|\n| b|\n+---+\n")),(0,i.kt)("h3",{id:"except"},"EXCEPT"),(0,i.kt)("p",null,"\u5dee\u96c6"),(0,i.kt)("p",null,"EXCEPT\u548cEXCEPT ALL\u8fd4\u56de\u5728\u4e00\u4e2a\u8868\u4e2d\u627e\u5230\uff0c\u4f46\u5728\u53e6\u4e00\u4e2a\u8868\u4e2d\u6ca1\u6709\u627e\u5230\u7684\u884c\u3002EXCEPT\u4f1a\u5bf9\u7ed3\u679c\u53bb\u91cd\uff0c\u800cEXCEPT ALL\u4e0d\u4f1a\u5bf9\u7ed3\u679c\u53bb\u91cd\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"Flink SQL> (SELECT s FROM t1) EXCEPT (SELECT s FROM t2);\n+---+\n| s |\n+---+\n| c |\n+---+\nFlink SQL> (SELECT s FROM t1) EXCEPT ALL (SELECT s FROM t2);\n+---+\n| s |\n+---+\n| c |\n| c |\n+---+\n")),(0,i.kt)("h3",{id:"in"},"IN"),(0,i.kt)("p",null,"\u5982\u679c\u5916\u8868\u5b57\u6bb5\u503c\u5b58\u5728\u4e8e\u7ed9\u5b9a\u7684\u5b50\u67e5\u8be2\u7ed3\u679c\u8868\u6570\u636e\uff0c\u5219\u8fd4\u56detrue\u3002\u5b50\u67e5\u8be2\u7ed3\u679c\u8868\u5fc5\u987b\u7531\u4e00\u5217\u7ec4\u6210\u3002\u6b64\u5217\u5fc5\u987b\u5177\u6709\u4e0e\u8868\u8fbe\u5f0f\u76f8\u540c\u7684\u6570\u636e\u7c7b\u578b\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT user, amount\nFROM Orders\nWHERE product IN\n    (\n    SELECT product\n    FROM NewProducts\n    )\n;\n")),(0,i.kt)("p",null,"\u4f18\u5316\u5668\u5c06IN\u6761\u4ef6\u91cd\u5199\u4e3ajoin\u548cgroup\u64cd\u4f5c\u3002\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u8fd9\u53d6\u51b3\u4e8e\u4e0d\u540c\u7684\u8f93\u5165\u884c\u6570\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u5408\u9002\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("h3",{id:"exists"},"EXISTS"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT user, amount\nFROM Orders\nWHERE product EXISTS\n    (\n    SELECT product\n    FROM NewProducts\n    )\n;\n")),(0,i.kt)("p",null,"\u5982\u679c\u5b50\u67e5\u8be2\u8fd4\u56de\u81f3\u5c11\u4e00\u884c\uff0c\u5219\u8fd4\u56detrue\u3002\u53ea\u6709\u5f53\u64cd\u4f5c\u53ef\u4ee5\u5728join\u548cgroup\u64cd\u4f5c\u4e2d\u91cd\u5199\u65f6\u624d\u652f\u6301\u8be5\u8bed\u6cd5\u3002"),(0,i.kt)("p",null,"\u4f18\u5316\u5668\u5c06EXISTS\u64cd\u4f5c\u91cd\u5199\u4e3ajoin\u548cgroup\u64cd\u4f5c\u3002\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u8ba1\u7b97\u67e5\u8be2\u7ed3\u679c\u6240\u9700\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u65e0\u9650\u589e\u957f\uff0c\u8fd9\u53d6\u51b3\u4e8e\u4e0d\u540c\u7684\u8f93\u5165\u884c\u6570\u3002",(0,i.kt)("br",{parentName:"p"}),"\n","\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u5408\u9002\u7684\u72b6\u6001\u751f\u5b58\u65f6\u95f4(TTL)\uff0c\u4ee5\u9632\u6b62\u72b6\u6001\u5927\u5c0f\u8fc7\u5927\u3002\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u67e5\u8be2\u7ed3\u679c\u7684\u6b63\u786e\u6027\u3002\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u89c1",(0,i.kt)("a",{parentName:"p",href:"../1-1-query-config"},"\u67e5\u8be2\u914d\u7f6e"),"\u3002"),(0,i.kt)("h2",{id:"order-by\u5b50\u53e5"},"ORDER BY\u5b50\u53e5"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"ORDER BY\u5b50\u53e5\u4f1a\u6839\u636e\u6307\u5b9a\u7684\u8868\u8fbe\u5f0f\u5bf9\u7ed3\u679c\u884c\u8fdb\u884c\u6392\u5e8f\u3002\u5982\u679c\u6839\u636e\u6700\u5de6\u8fb9\u7684\u8868\u8fbe\u5f0f\u6bd4\u8f83\uff0c\u4e24\u884c\u76f8\u7b49\uff0c\u5219\u7ee7\u7eed\u6839\u636e\u4e0b\u4e00\u4e2a\u8868\u8fbe\u5f0f\u5bf9\u5b83\u4eec\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u5982\u679c\u6839\u636e\u6240\u6709\u6307\u5b9a\u7684\u8868\u8fbe\u5f0f\u6bd4\u8f83\uff0c\u5b83\u4eec\u90fd\u662f\u76f8\u7b49\u7684\uff0c\u5219\u4ee5\u4f9d\u8d56\u4e8e\u5b9e\u73b0\u7684\u987a\u5e8f\u8fd4\u56de\u5b83\u4eec\u3002"),(0,i.kt)("p",null,"\u5f53\u4ee5\u6d41\u6a21\u5f0f\u8fd0\u884c\u65f6\uff0c\u8868\u7684\u4e3b\u8981\u6392\u5e8f\u987a\u5e8f\u5fc5\u987b\u6839\u636e\u65f6\u95f4\u5c5e\u6027\u8fdb\u884c\u5347\u5e8f\u8fdb\u884c\u6392\u5e8f\u3002\u6240\u6709\u540e\u7eed\u6392\u5e8f\u90fd\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u3002\u4f46\u662f\u5728\u6279\u5904\u7406\u6a21\u5f0f\u4e2d\u6ca1\u6709\u8fd9\u79cd\u9650\u5236\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM Orders\nORDER BY order_time, order_id;\n")),(0,i.kt)("h3",{id:"limit\u5b50\u53e5"},"LIMIT\u5b50\u53e5"),(0,i.kt)("p",null,"\u53ea\u80fd\u5728\u6279\u5904\u7406\u4efb\u52a1\u4e2d\u4f7f\u7528\u3002 LIMIT\u5b50\u53e5\u9650\u5236SELECT\u8bed\u53e5\u8fd4\u56de\u7684\u884c\u6570\u3002LIMIT\u901a\u5e38\u4e0eORDER BY\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u786e\u4fdd\u7ed3\u679c\u7684\u786e\u5b9a\u6027\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u793a\u4f8b\u8fd4\u56deOrders\u8868\u4e2d\u7684\u524d3\u884c\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM Orders\nORDER BY orderTime\nLIMIT 3;\n")),(0,i.kt)("h2",{id:"top-n"},"Top-N"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u4efb\u52a1\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"Top-N\u67e5\u8be2\u8fd4\u56de\u6309\u5217\u6392\u5e8f\u7684N\u4e2a\u6700\u5c0f\u6216\u6700\u5927\u503c\u3002\u6700\u5c0f\u548c\u6700\u5927\u7684\u503c\u96c6\u90fd\u88ab\u8ba4\u4e3a\u662fTop-N\u67e5\u8be2\u3002top-N\u67e5\u8be2\u5728\u9700\u8981\u53ea\u663e\u793a\u6279\u5904\u7406/\u6d41\u8868\u4e2d\u6700\u4e0b\u9762\u7684N\u6761\u6216\u6700\u4e0a\u9762\u7684N\u6761\u8bb0\u5f55\u7684\u60c5\u51b5\u4e0b\u975e\u5e38\u6709\u7528\u3002\u6b64\u7ed3\u679c\u96c6\u53ef\u7528\u4e8e\u8fdb\u4e00\u6b65\u5206\u6790\u3002"),(0,i.kt)("p",null,"Flink\u4f7f\u7528OVER\u7a97\u53e3\u5b50\u53e5\u548c\u7b5b\u9009\u6761\u4ef6\u7684\u7ec4\u5408\u6765\u8868\u793aTop-N\u67e5\u8be2\u3002\u901a\u8fc7OVER\u7a97\u53e3PARTITION BY\u5b50\u53e5\u7684\u529f\u80fd\uff0cFlink\u8fd8\u652f\u6301\u591a\u7ec4Top-N\u3002"),(0,i.kt)("p",null,"\u4f8b\u5982\uff0c\u6bcf\u4e2a\u7c7b\u522b\u4e2d\u5b9e\u65f6\u9500\u552e\u989d\u6700\u9ad8\u7684\u524d\u4e94\u79cd\u4ea7\u54c1\u3002\u5bf9\u4e8e\u6279\u5904\u7406\u8868\u548c\u6d41\u8868\u4e0a\u7684SQL\uff0c\u90fd\u652f\u6301Top-N\u67e5\u8be2\u3002"),(0,i.kt)("p",null,"Top-N\u8bed\u53e5\u7684\u8bed\u6cd5\u5982\u4e0b:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [column_list]\nFROM\n    (\n    SELECT [column_list],\n        ROW_NUMBER() OVER (\n            [PARTITION BY col1[, col2...]]\n            ORDER BY col1 [asc|desc][, col2 [asc|desc]...]\n        ) AS rownum\n    FROM table_name\n    )\nWHERE rownum <= N [AND conditions]\n")),(0,i.kt)("p",null,"\u53c2\u6570\u8bf4\u660e\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ROW_NUMBER()\uff1a\u6839\u636e\u5206\u533a\u4e2d\u7684\u6570\u636e\u884c\u987a\u5e8f\uff0c\u4ece1\u5f00\u59cb\u4e3a\u6bcf\u4e00\u884c\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u8fde\u7eed\u7f16\u53f7\u3002\u76ee\u524d\uff0c\u6211\u4eec\u53ea\u652f\u6301ROW_NUMBER\u4f5c\u4e3aover window\u51fd\u6570\u3002\u5c06\u6765\uff0c\u6211\u4eec\u4f1a\u652f\u6301RANK()\u548cDENSE_RANK()\u3002"),(0,i.kt)("li",{parentName:"ul"},"PARTITION BY col1","[, col2...]","\uff1a\u5206\u533a\u5217\u3002\u6bcf\u4e2a\u5206\u533a\u90fd\u6709\u4e00\u4e2aTop-N\u7ed3\u679c\u3002"),(0,i.kt)("li",{parentName:"ul"},"ORDER BY col1 ","[asc|desc]",", col2 ","[asc|desc]","...]\uff1a\u6307\u5b9a\u6392\u5e8f\u5217\u3002\u4e0d\u540c\u5217\u7684\u6392\u5e8f\u65b9\u5f0f\u53ef\u80fd\u4e0d\u540c\u3002"),(0,i.kt)("li",{parentName:"ul"},"WHERE rownum <= N\uff1a Flink\u9700\u8981rownum <= N\u6765\u8bc6\u522b\u8fd9\u4e2a\u67e5\u8be2\u662fTop-N\u67e5\u8be2\u3002N\u8868\u793a\u5c06\u4fdd\u7559N\u6761\u6700\u5c0f\u6216\u6700\u5927\u7684\u8bb0\u5f55\u3002"),(0,i.kt)("li",{parentName:"ul"},"[AND conditions]","\uff1a\u5728where\u5b50\u53e5\u4e2d\u53ef\u4ee5\u968f\u610f\u6dfb\u52a0\u5176\u4ed6\u6761\u4ef6\uff0c\u4f46\u5176\u4ed6\u6761\u4ef6\u53ea\u80fd\u4f7f\u7528AND\u5173\u952e\u5b57\u4e0erownum <= N\u7ec4\u5408\u3002")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u5fc5\u987b\u5b8c\u5168\u9075\u5faa\u4e0a\u8ff0\u6a21\u5f0f\uff0c\u5426\u5219\u4f18\u5316\u5668\u5c06\u65e0\u6cd5\u8f6c\u6362\u67e5\u8be2\u3002"),(0,i.kt)("p",null,"TopN\u67e5\u8be2\u7ed3\u679c\u4e3a\u201c\u7ed3\u679c\u66f4\u65b0\u201d\u3002Flink SQL\u5c06\u6839\u636eorder\u952e\u5bf9\u8f93\u5165\u6570\u636e\u6d41\u8fdb\u884c\u6392\u5e8f\uff0c\u56e0\u6b64\u5982\u679c\u524dN\u6761\u8bb0\u5f55\u88ab\u66f4\u6539\uff0c\u5219\u66f4\u6539\u540e\u7684\u8bb0\u5f55\u5c06\u4f5c\u4e3a\u64a4\u9500/\u66f4\u65b0\u8bb0\u5f55\u53d1\u9001\u5230\u4e0b\u6e38\u3002\u5efa\u8bae\u4f7f\u7528\u652f\u6301\u66f4\u65b0\u7684\u5b58\u50a8\u4f5c\u4e3aTop-N\u67e5\u8be2\u7684sink\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u5982\u679ctop N\u8bb0\u5f55\u9700\u8981\u5b58\u50a8\u5728\u5916\u90e8\u5b58\u50a8\u4e2d\uff0c\u7ed3\u679c\u8868\u5e94\u8be5\u5177\u6709\u4e0etop-N\u67e5\u8be2\u76f8\u540c\u7684\u552f\u4e00\u952e\u3002"),(0,i.kt)("p",null,"Top-N\u67e5\u8be2\u7684\u552f\u4e00\u952e\u662fpartition\u5217\u548crownum\u5217\u7684\u7ec4\u5408\u3002\u4ee5\u4e0b\u9762\u7684\u4f5c\u4e1a\u4e3a\u4f8b\uff0c\u5047\u8bbeproduct_id\u662fShopSales\u7684\u552f\u4e00\u952e\uff0c\u90a3\u4e48Top-N\u67e5\u8be2\u7684\u552f\u4e00\u952e\u662f","[category, rownum]","\u548c","[product_id]","\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u5728\u6d41\u8868\u4e0a\u4f7f\u7528Top-N\u6307\u5b9aSQL\u67e5\u8be2\u3002\u8fd9\u662f\u4e00\u4e2a\u83b7\u5f97\u201c\u6bcf\u4e2a\u7c7b\u522b\u4e2d\u5b9e\u65f6\u9500\u552e\u989d\u6700\u9ad8\u7684\u524d\u4e94\u79cd\u4ea7\u54c1\u201d\u7684\u4f8b\u5b50\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE ShopSales (\n    product_id STRING,\n    category STRING,\n    product_name STRING,\n    sales BIGINT\n) WITH (...);\n\nSELECT product_id, category, product_name, sales, row_num\nFROM\n    (\n    SELECT product_id, category, product_name, sales,\n        ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) AS row_num\n    FROM ShopSales\n    )\nWHERE row_num <= 5;\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u65e0\u7b49\u7ea7\u5b57\u6bb5\u8f93\u51fa\u4f18\u5316")),(0,i.kt)("p",null,"\u5982\u524d\u6240\u8ff0\uff0crownum\u5b57\u6bb5\u5c06\u4f5c\u4e3a\u552f\u4e00\u952e\u7684\u4e00\u4e2a\u5b57\u6bb5\u5199\u5165\u7ed3\u679c\u8868\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bb0\u5f55\u88ab\u5199\u5165\u7ed3\u679c\u8868\u3002\u4f8b\u5982\uff0c\u5f53\u6392\u540d9\u7684\u8bb0\u5f55(\u6bd4\u5982product-1001)\u88ab\u66f4\u65b0\u5e76\u5c06\u5176\u6392\u540d\u5347\u7ea7\u4e3a1\u65f6\uff0c\u6392\u540d1 ~9\u7684\u6240\u6709\u8bb0\u5f55\u5c06\u4f5c\u4e3a\u66f4\u65b0\u6d88\u606f\u8f93\u51fa\u5230\u7ed3\u679c\u8868\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u7ed3\u679c\u8868\u63a5\u6536\u7684\u6570\u636e\u8fc7\u591a\uff0c\u5c06\u6210\u4e3aSQL\u4f5c\u4e1a\u7684\u74f6\u9888\u3002\u4f18\u5316\u65b9\u6cd5\u662f\u5728Top-N\u67e5\u8be2\u7684\u5916\u90e8SELECT\u5b50\u53e5\u4e2d\u7701\u7565rownum\u5b57\u6bb5\u3002\u8fd9\u662f\u5408\u7406\u7684\uff0c\u56e0\u4e3a\u524dN\u4e2a\u8bb0\u5f55\u7684\u6570\u91cf\u901a\u5e38\u4e0d\u5927\uff0c\u56e0\u6b64\u6d88\u8d39\u8005\u53ef\u4ee5\u81ea\u5df1\u5feb\u901f\u5730\u5bf9\u7ed3\u679c\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002"),(0,i.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u6ca1\u6709rownum\u5b57\u6bb5\uff0c\u53ea\u9700\u8981\u5c06\u66f4\u6539\u540e\u7684\u8bb0\u5f55(product-1001)\u53d1\u9001\u5230\u4e0b\u6e38\uff0c\u8fd9\u53ef\u4ee5\u51cf\u5c11\u5bf9\u7ed3\u679c\u8868\u7684\u5927\u91cfIO\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u5982\u4f55\u7528\u8fd9\u79cd\u65b9\u5f0f\u4f18\u5316\u4e0a\u9762\u7684Top-N\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE ShopSales (\n    product_id STRING,\n    category STRING,\n    product_name STRING,\n    sales BIGINT\n) WITH (...);\n\n-- \u8f93\u51fa\u65f6\u7701\u7565row_num\u5b57\u6bb5\nSELECT product_id, category, product_name, sales\nFROM\n    (\n    SELECT product_id, category, product_name, sales,\n        ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) AS row_num\n    FROM ShopSales\n    )\nWHERE row_num <= 5;\n")),(0,i.kt)("p",null,"\u6ce8\u610f\u5728\u6d41\u6a21\u5f0f\u4e0b\uff0c\u4e3a\u4e86\u5c06\u4e0a\u8ff0\u67e5\u8be2\u8f93\u51fa\u5230\u5916\u90e8\u5b58\u50a8\u5e76\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u5916\u90e8\u5b58\u50a8\u5fc5\u987b\u4e0eTop-N\u67e5\u8be2\u5177\u6709\u76f8\u540c\u7684\u552f\u4e00\u952e\u3002\u5728\u4e0a\u9762\u7684\u67e5\u8be2\u793a\u4f8b\u4e2d\uff0c\u5982\u679cproduct_id\u662f\u67e5\u8be2\u7684\u552f\u4e00\u952e\uff0c\u90a3\u4e48\u5916\u90e8\u8868\u4e5f\u5e94\u8be5\u5c06product_id\u4f5c\u4e3a\u552f\u4e00\u952e\u3002"),(0,i.kt)("h2",{id:"window-top-n"},"Window Top-N"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"flink-1.13.x"),"\uff1a\u53ea\u80fd\u5728\u6d41\u6a21\u5f0f\u4efb\u52a1\u4e2d\u4f7f\u7528\u3002",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"flink-1.15.x"),"\uff1a\u53ef\u4ee5\u5728\u6d41\u6279\u6a21\u5f0f\u4e2d\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"Window Top-N\u662f\u4e00\u4e2a\u7279\u6b8a\u7684Top-N\uff0c\u5b83\u8fd4\u56de\u6bcf\u4e2a\u7a97\u53e3\u4ee5\u53ca\u5176\u4ed6\u5206\u533a\u952e\u7684N\u4e2a\u6700\u5c0f\u6216\u6700\u5927\u503c\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u67e5\u8be2\uff0c\u4e0e\u8fde\u7eed\u8868\u4e0a\u7684\u5e38\u89c4top-N\u4e0d\u540c\uff0c\u7a97\u53e3top-N\u4e0d\u4f1a\u53d1\u51fa\u4e2d\u95f4\u7ed3\u679c\uff0c\u800c\u53ea\u53d1\u51fa\u6700\u7ec8\u7ed3\u679c\uff0c\u5373\u7a97\u53e3\u672b\u7aef\u7684top-N\u6240\u6709\u8bb0\u5f55\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u5f53\u4e0d\u518d\u9700\u8981\u65f6\uff0c\u7a97\u53e3Top-N\u4f1a\u6e05\u9664\u6240\u6709\u4e2d\u95f4\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u5982\u679c\u7528\u6237\u4e0d\u9700\u8981\u5bf9\u6bcf\u6761\u8bb0\u5f55\u66f4\u65b0\u7ed3\u679c\uff0c\u90a3\u4e48\u7a97\u53e3Top-N\u67e5\u8be2\u4f1a\u5177\u6709\u66f4\u597d\u7684\u6027\u80fd\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"flink-1.13.x"),"\uff1a\u901a\u5e38\uff0c\u7a97\u53e3top-N\u4e0e\u7a97\u53e3\u805a\u5408\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\u3002",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"flink-1.14.x"),"\uff1a\u901a\u5e38\uff0c\u7a97\u53e3 top-N \u53ef\u4ee5\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e0a\u76f4\u63a5\u4f7f\u7528\uff0c\u56e0\u6b64\uff0c\u7a97\u53e3 top-N \u53ef\u4ee5\u57fa\u4e8e\u7a97\u53e3\u8868\u503c\u51fd\u6570\u548c\u5176\u4ed6\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u6bd4\u5982\uff1a\u7a97\u53e3\u805a\u5408\u3001\u7a97\u53e3 topN \u548c\u7a97\u53e3 join\u3002"),(0,i.kt)("p",null,"Window Top-N\u53ef\u4ee5\u7528\u4e0e\u5e38\u89c4Top-N\u76f8\u540c\u7684\u8bed\u6cd5\u5b9a\u4e49\uff0c\u6b64\u5916\uff0cWindow Top-N\u8981\u6c42PARTITION BY\u5b50\u53e5\u5305\u542bwindow_start\u548cwindow_end\u5217\uff0c\u901a\u8fc7Windowing TVF\u6216\u7a97\u53e3\u805a\u5408\u4ea7\u751f\u3002"),(0,i.kt)("p",null,"\u5426\u5219\uff0c\u4f18\u5316\u5668\u5c06\u65e0\u6cd5\u7ffb\u8bd1\u5bf9\u5e94\u7684sql\u67e5\u8be2\u3002"),(0,i.kt)("p",null,"Window Top-N\u8bed\u53e5\u7684\u8bed\u6cd5\u5982\u4e0b\u6240\u793a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [column_list]\nFROM\n    (\n    SELECT [column_list],\n        ROW_NUMBER() OVER (\n            PARTITION BY window_start, window_end [, col_key1...]\n            ORDER BY col1 [asc|desc][, col2 [asc|desc]...]\n        ) AS rownum\n    FROM table_name\n    ) -- \u901a\u8fc7windowing TVF\u4ea7\u751f\u8868\nWHERE rownum <= N [AND conditions]\n")),(0,i.kt)("h3",{id:"\u5728\u7a97\u53e3\u805a\u5408\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-n"},"\u5728\u7a97\u53e3\u805a\u5408\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-N"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u5982\u4f55\u8ba1\u7b97\u6bcf10\u5206\u949f\u6eda\u52a8\u7a97\u53e3\u4e2d\u9500\u552e\u989d\u6700\u9ad8\u7684\u524d3\u4e2a\u4f9b\u5e94\u5546\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8868\u5fc5\u987b\u6709\u65f6\u95f4\u5c5e\u6027\uff0c\u6bd4\u5982\u4e0b\u8868\u4e2d\u7684bidtime\u5217\nFlink SQL> desc Bid;\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|        name |                   type | null | key | extras |                       watermark |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|     bidtime | TIMESTAMP(3) *ROWTIME* | true |     |        | `bidtime` - INTERVAL '1' SECOND |\n|       price |         DECIMAL(10, 2) | true |     |        |                                 |\n|        item |                 STRING | true |     |        |                                 |\n| supplier_id |                 STRING | true |     |        |                                 |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n\nFlink SQL> SELECT * FROM Bid;\n+------------------+-------+------+-------------+\n| bidtime | price | item | supplier_id |\n+------------------+-------+------+-------------+\n| 2020-04-15 08:05 | 4.00 | A | supplier1 |\n| 2020-04-15 08:06 | 4.00 | C | supplier2 |\n| 2020-04-15 08:07 | 2.00 | G | supplier1 |\n| 2020-04-15 08:08 | 2.00 | B | supplier3 |\n| 2020-04-15 08:09 | 5.00 | D | supplier4 |\n| 2020-04-15 08:11 | 2.00 | B | supplier3 |\n| 2020-04-15 08:13 | 1.00 | E | supplier1 |\n| 2020-04-15 08:15 | 3.00 | H | supplier2 |\n| 2020-04-15 08:17 | 6.00 | F | supplier5 |\n+------------------+-------+------+-------------+\n\nFlink SQL> SELECT *\nFROM\n    (\n    SELECT *, ROW_NUMBER() OVER (PARTITION BY window_start, window_end ORDER BY price DESC) as rownum\n    FROM\n        (\n        SELECT window_start, window_end, supplier_id, SUM(price) as price, COUNT(*) as cnt\n        FROM TABLE (TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES))\n        GROUP BY window_start, window_end, supplier_id\n        )\n    )\nWHERE rownum <= 3;\n+------------------+------------------+-------------+-------+-----+--------+\n| window_start | window_end | supplier_id | price | cnt | rownum |\n+------------------+------------------+-------------+-------+-----+--------+\n| 2020-04-15 08:00 | 2020-04-15 08:10 | supplier1 | 6.00 | 2 | 1 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 | supplier4 | 5.00 | 1 | 2 |\n| 2020-04-15 08:00 | 2020-04-15 08:10 | supplier2 | 4.00 | 1 | 3 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | supplier5 | 6.00 | 1 | 1 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | supplier2 | 3.00 | 1 | 2 |\n| 2020-04-15 08:10 | 2020-04-15 08:20 | supplier3 | 2.00 | 1 | 3 |\n+------------------+------------------+-------------+-------+-----+--------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f:\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5316\u4e86\u65f6\u95f4\u6233\u503c\u7684\u663e\u793a\uff0c\u4e0d\u663e\u793a\u79d2\u5c0f\u6570\u70b9\u540e\u7684\u96f6\u3002\n\u4f8b\u5982\uff0c\u5982\u679c\u7c7b\u578b\u662ftimestamp(3)\uff0c\u5728Flink SQL Client\u4e2d\uff0c2020-04-15 08:05\u5e94\u8be5\u663e\u793a\u4e3a2020-04-15 08:05:00.000\u3002"),(0,i.kt)("h3",{id:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-n"},"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u4f7f\u7528\u7a97\u53e3top-N"),(0,i.kt)("p",null,"flink-1.14.x\u5f00\u59cb\u652f\u6301\u3002"),(0,i.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u600e\u4e48\u6bcf\u4e2a\u6eda\u52a8\u7a97\u53e3\u5185 Top 3 \u7684\u6700\u9ad8\u4ef7\u683c\u7684 item\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM\n    (\n    SELECT bidtime, price, item, supplier_id, window_start, window_end, ROW_NUMBER() OVER (PARTITION BY window_start, window_end ORDER BY price DESC) as rownum\n    FROM TABLE\n        (\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES)\n        )\n    )\nWHERE rownum <= 3;\n+------------------+-------+------+-------------+------------------+------------------+--------+\n|          bidtime | price | item | supplier_id |     window_start |       window_end | rownum |\n+------------------+-------+------+-------------+------------------+------------------+--------+\n| 2020-04-15 08:05 |  4.00 |    A |   supplier1 | 2020-04-15 08:00 | 2020-04-15 08:10 |      2 |\n| 2020-04-15 08:06 |  4.00 |    C |   supplier2 | 2020-04-15 08:00 | 2020-04-15 08:10 |      3 |\n| 2020-04-15 08:09 |  5.00 |    D |   supplier4 | 2020-04-15 08:00 | 2020-04-15 08:10 |      1 |\n| 2020-04-15 08:11 |  2.00 |    B |   supplier3 | 2020-04-15 08:10 | 2020-04-15 08:20 |      3 |\n| 2020-04-15 08:15 |  3.00 |    H |   supplier2 | 2020-04-15 08:10 | 2020-04-15 08:20 |      2 |\n| 2020-04-15 08:17 |  6.00 |    F |   supplier5 | 2020-04-15 08:10 | 2020-04-15 08:20 |      1 |\n+------------------+-------+------+-------------+------------------+------------------+--------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f:\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5316\u4e86\u65f6\u95f4\u6233\u503c\u7684\u663e\u793a\uff0c\u4e0d\u663e\u793a\u79d2\u5c0f\u6570\u70b9\u540e\u7684\u96f6\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u7c7b\u578b\u662ftimestamp(3)\uff0c\u5728Flink SQL Client\u4e2d\uff0c2020-04-15 08:05\u5e94\u8be5\u663e\u793a\u4e3a2020-04-15 08:05:\n00.000\u3002"),(0,i.kt)("h3",{id:"\u9650\u5236-1"},"\u9650\u5236"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"flink-1.13.x"),"\uff1a\u76ee\u524d\uff0cFlink\u53ea\u652f\u6301Window Top-N\u7d27\u968fWindow Aggregation\u4ea7\u751f\u7684\u8868\u3002\u5728\u4e0d\u4e45\u7684\u5c06\u6765\uff0c\u5c06\u652f\u6301Window TVF\u4e4b\u540e\u7684Window Top-N\u3002",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"flink-1.14.x\u3001flink-1.15.x"),"\uff1a\u76ee\u524d\uff0cflink\u53ea\u652f\u6301\u5728\u6eda\u52a8\u7a97\u53e3\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u7d2f\u52a0\u7a97\u53e3\u8fd9\u4e09\u4e2a\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e4b\u540e\u76f4\u63a5\u4f7f\u7528 window Top-N\u3002\n\u5728\u4e0d\u4e45\u7684\u5c06\u6765\uff0c\u5c06\u652f\u6301\u5728\u4f1a\u8bdd\u7a97\u53e3\u7684\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e4b\u540e\u76f4\u63a5\u4f7f\u7528 window Top-N \u3002"),(0,i.kt)("h2",{id:"\u53bb\u91cd"},"\u53bb\u91cd"),(0,i.kt)("p",null,"\u5728\u6d41\u6279\u6a21\u5f0f\u4e2d\u5747\u53ef\u4f7f\u7528\u3002"),(0,i.kt)("p",null,"\u53bb\u91cd\u4f1a\u5220\u9664\u5728\u4e00\u7ec4\u5217\u4e0a\u91cd\u590d\u7684\u884c\uff0c\u53ea\u4fdd\u7559\u7b2c\u4e00\u884c\u6216\u6700\u540e\u4e00\u884c\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e0a\u6e38ETL\u4f5c\u4e1a\u5e76\u4e0d\u662f\u7aef\u5230\u7aef\u7cbe\u786e\u4e00\u6b21\u7684\uff1b\u5f53\u53d1\u751f\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u63a5\u6536\u5668\u4e2d\u51fa\u73b0\u91cd\u590d\u8bb0\u5f55\u3002"),(0,i.kt)("p",null,"\u91cd\u590d\u8bb0\u5f55\u4f1a\u5f71\u54cd\u4e0b\u6e38\u5206\u6790\u4f5c\u4e1a(\u5982SUM\u3001COUNT)\u7684\u6b63\u786e\u6027\uff0c\u56e0\u6b64\u9700\u8981\u5728\u8fdb\u4e00\u6b65\u5206\u6790\u4e4b\u524d\u8fdb\u884c\u91cd\u590d\u6570\u636e\u5220\u9664\u3002"),(0,i.kt)("p",null,"Flink\u4f7f\u7528ROW_NUMBER()\u6765\u5220\u9664\u91cd\u590d\u6570\u636e\uff0c\u5c31\u50cfTop-N\u67e5\u8be2\u4e00\u6837\u3002\u7406\u8bba\u4e0a\uff0c\u91cd\u590d\u6570\u636e\u5220\u9664\u662fTop-N\u7684\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c\u5176\u4e2dN\u4e3a1\uff0c\u6309\u5904\u7406\u65f6\u95f4\u6216\u4e8b\u4ef6\u65f6\u95f4\u6392\u5e8f\u3002"),(0,i.kt)("p",null,"\u91cd\u590d\u6570\u636e\u5220\u9664\u8bed\u53e5\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [column_list]\nFROM\n    (\n    SELECT [column_list],\n        ROW_NUMBER() OVER (\n            [PARTITION BY col1[, col2...]]\n            ORDER BY time_attr [asc|desc]\n        ) AS rownum\n    FROM table_name\n    )\nWHERE rownum = 1\n")),(0,i.kt)("p",null,"\u53c2\u6570\u8bf4\u660e\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ROW_NUMBER()\uff1a\u4e3a\u6bcf\u4e00\u884c\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u8fde\u7eed\u7f16\u53f7\uff0c\u4ece1\u5f00\u59cb\u3002"),(0,i.kt)("li",{parentName:"ul"},"PARTITION BY col1","[, col2...]","\uff1a\u6307\u5b9a\u5206\u533a\u5217\uff0c\u5373\u91cd\u590d\u6570\u636e\u5220\u9664\u952e\u3002"),(0,i.kt)("li",{parentName:"ul"},"ORDER BY time_attr ","[asc|desc]","\uff1a\u6392\u5e8f\u5217\uff0c\u5fc5\u987b\u662f\u65f6\u95f4\u5c5e\u6027\u3002\u76ee\u524dFlink\u652f\u6301\u5904\u7406\u65f6\u95f4\u5c5e\u6027\u548c\u4e8b\u4ef6\u65f6\u95f4\u5c5e\u6027\u3002\u6309ASC\u6392\u5e8f\u610f\u5473\u7740\u4fdd\u7559\u7b2c\u4e00\u884c\uff0c\u6309DESC\u6392\u5e8f\u610f\u5473\u7740\u4fdd\u7559\u6700\u540e\u4e00\u884c\u3002"),(0,i.kt)("li",{parentName:"ul"},"WHERE rownum = 1\uff1aFlink\u9700\u8981rownum = 1\u6765\u8bc6\u522b\u8fd9\u4e2a\u67e5\u8be2\u662f\u91cd\u590d\u6570\u636e\u5220\u9664\u3002")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1a\u5fc5\u987b\u5b8c\u5168\u9075\u5faa\u4e0a\u8ff0\u6a21\u5f0f\uff0c\u5426\u5219\u4f18\u5316\u5668\u5c06\u65e0\u6cd5\u8f6c\u6362\u67e5\u8be2\u3002"),(0,i.kt)("p",null,"\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u5728\u6d41\u8868\u4e0a\u4f7f\u7528\u91cd\u590d\u6570\u636e\u5220\u9664\u7684SQL\u8bed\u53e5\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE Orders (\n    order_time STRING,\n    user STRING,\n    product STRING,\n    num BIGINT,\n    proctime AS PROCTIME()\n) WITH (...);\n-- \u79fb\u9664\u91cd\u590d\u7684order_id\u884c\u6570\u636e\uff0c\u53ea\u4fdd\u7559\u7b2c\u4e00\u4e2a\u63a5\u6536\u5230\u7684\u884c\u6570\u636e\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2aorder_id\u4e0d\u5e94\u8be5\u51fa\u73b0\u4e24\u4e2a\u8ba2\u5355\nSELECT order_id, user, product, num\nFROM\n    (\n    SELECT *,\n        ROW_NUMBER() OVER (PARTITION BY order_id ORDER BY proctime ASC) AS row_num\n    FROM Orders\n    )\nWHERE row_num = 1;\n")),(0,i.kt)("h2",{id:"\u7a97\u53e3\u53bb\u91cd"},"\u7a97\u53e3\u53bb\u91cd"),(0,i.kt)("p",null,"flink-1.15.x\u5f00\u59cb\u652f\u6301\u3002"),(0,i.kt)("p",null,"\u7a97\u53e3\u53bb\u91cd\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u53bb\u91cd\uff0c\u5b83\u4f1a\u5220\u9664\u6570\u636e\u96c6\u4e2d\u91cd\u590d\u7684\u884c\uff0c\u4fdd\u7559\u6bcf\u4e2a\u7a97\u53e3\u548c\u5206\u533a\u4e2d key \u5bf9\u5e94\u7684\u7b2c\u4e00\u884c\u6216\u8005\u662f\u6700\u540e\u4e00\u884c\u3002"),(0,i.kt)("p",null,"\u5bf9\u4e8e\u6d41\u5f0f\u67e5\u8be2\uff0c\u548c\u5e38\u89c4\u7684\u6d41\u8868\u53bb\u91cd\u4e0d\u540c\uff0c\u7a97\u53e3\u53bb\u91cd\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u53d1\u5c04\u7ed3\u679c\u6570\u636e\uff0c\u800c\u662f\u5728\u7a97\u53e3\u7ed3\u675f\u65f6\u53d1\u5c04\u6700\u7ec8\u7684\u7ed3\u679c\u3002\u53e6\u5916\uff0c\u7a97\u53e3\u53bb\u91cd\u4f1a\u5728\u4e0d\u9700\u8981\u65f6\u5220\u9664\u6240\u6709\u7684\u4e2d\u95f4\u72b6\u6001\u6570\u636e\u3002\n\u56e0\u6b64\uff0c\u5982\u679c\u7528\u6237\u4e0d\u9700\u8981\u5b9e\u65f6\u4f7f\u7528\u7ed3\u679c\u6570\u636e\u66f4\u65b0\u6bcf\u4e00\u6761\u8bb0\u5f55\uff0c\u7a97\u53e3\u53bb\u91cd\u4f1a\u6709\u66f4\u597d\u7684\u6027\u80fd\u3002\n\u901a\u5e38\uff0c\u7a97\u53e3\u53bb\u91cd\u4f1a\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u4e0a\u76f4\u63a5\u4f7f\u7528\u3002\u56e0\u6b64\uff0c\u7a97\u53e3\u53bb\u91cd\u5e94\u8be5\u57fa\u4e8e\u7a97\u53e3\u8868\u503c\u51fd\u6570\u5e76\u4e14\u548c\u5176\u4ed6\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u6bd4\u5982\uff1a\u7a97\u53e3\u805a\u5408\u51fd\u6570\u3001\u7a97\u53e3 TopN\u3001\u7a97\u53e3 join\u3002"),(0,i.kt)("p",null,"\u7a97\u53e3\u53bb\u91cd\u5b9a\u4e49\u548c\u5e38\u89c4\u53bb\u91cd\u5b9a\u4e49\u8bed\u6cd5\u4e00\u6837\uff0c\u5177\u4f53\u53ef\u67e5\u770b\u53bb\u91cd\u6587\u6863\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u7a97\u53e3\u53bb\u91cd\u8981\u6c42 PARTITION BY \u8bed\u53e5\u5305\u542b window_start \u548c window_end \u5b57\u6bb5\u3002\u5426\u5219\uff0c\u4f18\u5316\u5668\u65e0\u6cd5\u7ffb\u8bd1\u8be5\u67e5\u8be2\u3002"),(0,i.kt)("p",null,"flink \u4f7f\u7528 ROW_NUMBER() \u6765\u53bb\u6389\u91cd\u590d\u6570\u636e\uff0c\u548c\u7a97\u53e3 Top-N \u65b9\u5f0f\u4e00\u6837\u3002\u4ece\u7406\u8bba\u4e0a\u6765\u8bf4\uff0c\u7a97\u53e3\u53bb\u91cd\u662f\u7a97\u53e3 Top-N \u7684\u4e00\u79cd\u7279\u6b8a\u7528\u4f8b\uff0c\u8981\u6c42 N \u4e3a1\uff0c\u5e76\u4e14\u6309\u7167\u5904\u7406\u65f6\u95f4\u6216\u8005\u4e8b\u4ef6\u65f6\u95f4\u6392\u5e8f\u3002"),(0,i.kt)("p",null,"\u4e0b\u4f8b\u5c55\u793a\u7a97\u53e3\u53bb\u91cd\u8bed\u53e5\u7684\u8bed\u6cd5\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT [column_list]\nFROM\n(\nSELECT [column_list],\nROW_NUMBER() OVER (\nPARTITION BY window_start, window_end [, col_key1...]\nORDER BY time_attr [asc|desc]\n) AS rownum\nFROM table_name\n) -- \u8be5\u5173\u7cfb\u63a5\u6536\u7a97\u53e3\u8868\u503c\u51fd\u6570\nWHERE (rownum = 1 | rownum <=1 | rownum < 2) [AND conditions]\n")),(0,i.kt)("p",null,"\u53c2\u6570\u8bf4\u660e\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ROW_NUMBER()\uff1a\u7ed9\u6bcf\u4e00\u884c\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u3001\u7279\u6b8a\u7684\u6570\u5b57\uff0c\u4ece1\u5f00\u59cb\u3002"),(0,i.kt)("li",{parentName:"ul"},"PARTITION BY window_start, window_end ","[, col_key1...]","\uff1a\u6307\u5b9a\u5206\u533a\u5b57\u6bb5\uff0c\u5305\u542b\uff1awindow_start\u3001window_end \u548c\u5176\u4ed6\u5206\u533a key\u3002"),(0,i.kt)("li",{parentName:"ul"},"ORDER BY time_attr ","[asc|desc]","\uff1a\u6307\u5b9a\u6392\u5e8f\u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u5fc5\u987b\u662f\u65f6\u95f4\u7c7b\u578b\u3002\u76ee\u524d flink \u652f\u6301\u5904\u7406\u65f6\u95f4\u548c\u4e8b\u4ef6\u65f6\u95f4\u3002 Ordering by ASC \u8868\u793a\u4fdd\u7559\u7b2c\u4e00\u884c\uff0cordering by DESC\n\u8868\u793a\u4fdd\u7559\u6700\u540e\u4e00\u884c\u3002"),(0,i.kt)("li",{parentName:"ul"},"WHERE (rownum = 1 | rownum <=1 | rownum < 2)\uff1a\u5fc5\u987b\u6709 rownum = 1 | rownum <=1 | rownum < 2 \uff0c\u8fd9\u662f\u4e3a\u4e86\u8ba9\u4f18\u5316\u5668\u53d6\u5931\u8d25\u8be5\u67e5\u8be2\uff0c\u5e76\u4e14\u5c06\u5176\u7ffb\u8bd1\u4e3a\u7a97\u53e3\u53bb\u91cd\u3002")),(0,i.kt)("p",null,"\u6ce8\u610f\uff1asql \u8bed\u53e5\u5fc5\u987b\u5b8c\u5168\u5339\u914d\u4e0a\u8ff0\u6a21\u5f0f\uff0c\u5426\u5219\u4f18\u5316\u5668\u65e0\u6cd5\u5c06\u67e5\u8be2\u7ffb\u8bd1\u4e3a\u7a97\u53e3\u53bb\u91cd\u3002"),(0,i.kt)("h3",{id:"\u6848\u4f8b-1"},"\u6848\u4f8b"),(0,i.kt)("p",null,"\u4e0b\u4f8b\u5c55\u793a\u600e\u4e48\u53bb\u4fdd\u755910\u5206\u949f\u7684\u6eda\u52a8\u7a97\u53e3\u7684\u6700\u540e\u4e00\u884c\u6570\u636e\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8868\u5fc5\u987b\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u6bd4\u5982\u8be5\u8868\u4e2d\u7684`bidtime`\u5b57\u6bb5\u3002\nFlink SQL> DESC Bid;\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|        name |                   type | null | key | extras |                       watermark |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n|     bidtime | TIMESTAMP(3) *ROWTIME* | true |     |        | `bidtime` - INTERVAL '1' SECOND |\n|       price |         DECIMAL(10, 2) | true |     |        |                                 |\n|        item |                 STRING | true |     |        |                                 |\n+-------------+------------------------+------+-----+--------+---------------------------------+\n\nFlink SQL> SELECT * FROM Bid;\n+------------------+-------+------+\n|          bidtime | price | item |\n+------------------+-------+------+\n| 2020-04-15 08:05 |  4.00 | C    |\n| 2020-04-15 08:07 |  2.00 | A    |\n| 2020-04-15 08:09 |  5.00 | D    |\n| 2020-04-15 08:11 |  3.00 | B    |\n| 2020-04-15 08:13 |  1.00 | E    |\n| 2020-04-15 08:17 |  6.00 | F    |\n+------------------+-------+------+\n\nSELECT *\nFROM (\n    SELECT bidtime, price, item, supplier_id, window_start, window_end,\n        ROW_NUMBER() OVER (\n            PARTITION BY window_start, window_end\n            ORDER BY bidtime DESC\n        ) AS rownum\n    FROM TABLE(\n        TUMBLE(TABLE Bid, DESCRIPTOR(bidtime), INTERVAL '10' MINUTES))\n    )\nWHERE rownum <= 1;\n+------------------+-------+------+-------------+------------------+------------------+--------+\n|          bidtime | price | item | supplier_id |     window_start |       window_end | rownum |\n+------------------+-------+------+-------------+------------------+------------------+--------+\n| 2020-04-15 08:09 |  5.00 |    D |   supplier4 | 2020-04-15 08:00 | 2020-04-15 08:10 |      1 |\n| 2020-04-15 08:17 |  6.00 |    F |   supplier5 | 2020-04-15 08:10 | 2020-04-15 08:20 |      1 |\n+------------------+-------+------+-------------+------------------+------------------+--------+\n")),(0,i.kt)("p",null,"\u6ce8\u610f:\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3\u7a97\u53e3\u7684\u884c\u4e3a\uff0c\u6211\u4eec\u7b80\u5316\u4e86\u65f6\u95f4\u6233\u503c\u7684\u663e\u793a\uff0c\u4e0d\u663e\u793a\u79d2\u5c0f\u6570\u70b9\u540e\u7684\u96f6\uff0c\n\u4f8b\u5982\uff0c\u5982\u679c\u7c7b\u578b\u662ftimestamp(3)\uff0c\u5728Flink SQL Client\u4e2d\uff0c2020-04-15 08:05\u5e94\u8be5\u663e\u793a\u4e3a2020-04-15 08:05:00.000\u3002"),(0,i.kt)("h3",{id:"\u9650\u5236-2"},"\u9650\u5236"),(0,i.kt)("h4",{id:"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u53bb\u91cd\u7684\u9650\u5236"},"\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u53bb\u91cd\u7684\u9650\u5236"),(0,i.kt)("p",null,"\u76ee\u524d\uff0c\u5982\u679c\u5728\u7a97\u53e3\u8868\u503c\u51fd\u6570\u540e\u76f4\u63a5\u4f7f\u7528\u7a97\u53e3\u53bb\u91cd\uff0c\u7a97\u53e3\u8868\u503c\u51fd\u6570\u5fc5\u987b\u662f\u6eda\u52a8\u7a97\u53e3\u3001\u6ed1\u52a8\u7a97\u53e3\u6216\u8005\u662f\u7d2f\u8ba1\u7a97\u53e3\uff0c\u800c\u4e0d\u80fd\u662f\u4f1a\u8bdd\u7a97\u53e3\u3002\u4f1a\u8bdd\u7a97\u53e3\u5c06\u5728\u4e0d\u4e45\u7684\u5c06\u6765\u652f\u6301\u3002"),(0,i.kt)("h4",{id:"\u65f6\u95f4\u5b57\u6bb5\u6392\u5e8f\u952e\u9650\u5236"},"\u65f6\u95f4\u5b57\u6bb5\u6392\u5e8f\u952e\u9650\u5236"),(0,i.kt)("p",null,"\u76ee\u524d\uff0c\u7a97\u53e3\u53bb\u91cd\u8981\u6c42\u6392\u5e8f\u952e\u5fc5\u987b\u662f\u4e8b\u4ef6\u65f6\u95f4\uff0c\u800c\u4e0d\u80fd\u662f\u5904\u7406\u65f6\u95f4\u3002\u4f7f\u7528\u5904\u7406\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\uff0c\u5c06\u5728\u4e0d\u4e45\u7684\u5c06\u6765\u652f\u6301\u3002"),(0,i.kt)("h2",{id:"pattern-recognition\u6a21\u5f0f\u8bc6\u522b"},"Pattern Recognition\uff08\u6a21\u5f0f\u8bc6\u522b\uff09"),(0,i.kt)("p",null,"\u5bf9\u5e94\u4e8e streaming api \u4e2d\u7684CEP\uff0c\u590d\u6742\u4e8b\u4ef6\u5904\u7406\u3002"),(0,i.kt)("p",null,"\u7531\u4e8e\u4f7f\u7528\u8f83\u5c11\uff0c\u6682\u65f6\u4e0d\u505a\u6574\u7406\u3002\u5982\u679c\u6709\u4f7f\u7528\u7684\u9700\u8981\uff0c\u53ef\u5230\u793e\u533a\u53cd\u5e94\uff0c\u540e\u7eed\u7531\u793e\u533a\u8865\u5145\u3002"))}E.isMDXComponent=!0},1292:(n,e,t)=>{t.d(e,{Z:()=>l});const l=t.p+"assets/images/cumulative-window-diagram-7ff5a2bc762e957e21f3c929ae14b9b8.png"},899:(n,e,t)=>{t.d(e,{Z:()=>l});const l=t.p+"assets/images/hop-window-63f249e64fbd39cbd1faef6cf4a92216.png"},9602:(n,e,t)=>{t.d(e,{Z:()=>l});const l=t.p+"assets/images/tumble-window-5ffe1a73541f9d17c14d48dd275763c1.png"}}]);