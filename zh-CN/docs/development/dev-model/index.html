<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">编程模型 | StreamX</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://streamxhub.com/zh-CN/docs/development/dev-model"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-CN"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="编程模型 | StreamX"><meta data-react-helmet="true" name="description" content="任何框架都有一些要遵循的规则和约定, 我们只有遵循并掌握了这些规则, 才能更加游刃有余的使用, 使其发挥事半功倍的效果, 我们开发 Flink 作业,其实就是利用 Flink 提供的 API , 按照 Flink 要求的开发方式, 写一个可以执行的(必须有main()函数)的程序, 在程序里接入各种Connector经过一系列的算子操作, 最终将数据通过Connector sink 到目标存储,"><meta data-react-helmet="true" property="og:description" content="任何框架都有一些要遵循的规则和约定, 我们只有遵循并掌握了这些规则, 才能更加游刃有余的使用, 使其发挥事半功倍的效果, 我们开发 Flink 作业,其实就是利用 Flink 提供的 API , 按照 Flink 要求的开发方式, 写一个可以执行的(必须有main()函数)的程序, 在程序里接入各种Connector经过一系列的算子操作, 最终将数据通过Connector sink 到目标存储,"><link data-react-helmet="true" rel="icon" href="/zh-CN/image/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://streamxhub.com/zh-CN/docs/development/dev-model"><link data-react-helmet="true" rel="alternate" href="https://streamxhub.com/docs/development/dev-model" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://streamxhub.com/zh-CN/docs/development/dev-model" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://streamxhub.com/docs/development/dev-model" hreflang="x-default"><link rel="stylesheet" href="/zh-CN/assets/css/styles.5bb3bb95.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.e8bca5c3.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.d331cf26.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/image/logo.svg" alt="StreamX Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-CN/image/logo.svg" alt="StreamX Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">StreamX</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-CN/">首页</a><a href="https://github.com/streamxhub/streamx/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">下载</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/intro">文档</a><a class="navbar__item navbar__link" href="/zh-CN/team">团队</a><a class="navbar__item navbar__link" href="/zh-CN/user">用户</a><a href="https://github.com/streamxhub/streamx/issues/507" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">FAQ</a><a href="https://github.com/streamxhub/streamx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/development/dev-model" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/docs/development/dev-model" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/intro">框架介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/user-guide/deployment">用户手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/user-guide/deployment">平台部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/user-guide/quick-start">快速开始</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/user-guide/development">开发环境</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/zh-CN/docs/development/dev-model">极速开发</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/development/dev-model">编程模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/development/config">项目配置</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/connector/Kafka-Connector">DataStream Connector</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Kafka-Connector">Apache Kafka Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Jdbc-Connector">Jdbc Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Clickhouse-Connector">Clickhouse-Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Elasticsearch-Connector">Elasticsearch Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Http-Connector">Http Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/MongoDb-Connector">MongoDb Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/connector/Redis-Connector">Redis Connector</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/flink-k8s/k8s-dev">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/flink-k8s/k8s-dev">Flink K8s 集成支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/flink-k8s/k8s-pvc-integration">K8s PVC 资源使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/flink-k8s/hadoop-resource-integration">Hadoop 资源集成</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>编程模型</h1></header><p>任何框架都有一些要遵循的规则和约定, 我们只有遵循并掌握了这些规则, 才能更加游刃有余的使用, 使其发挥事半功倍的效果, 我们开发 Flink 作业,其实就是利用 Flink 提供的 API , 按照 Flink 要求的开发方式, 写一个可以执行的(必须有<code>main()</code>函数)的程序, 在程序里接入各种<code>Connector</code>经过一系列的<code>算子</code>操作, 最终将数据通过<code>Connector</code> sink 到目标存储,
我们把这种按照某种约定的规则去逐步编程的方式称之为<code>编程模型</code>, 这一章节我们就来聊聊 StreamX 的<code>编程模型</code>以及开发注意事项</p><p>我们从这几个方面开始入手</p><ul><li>架构</li><li>编程模型</li><li>RunTime Context</li><li>生命周期</li><li>目录结构</li><li>打包部署</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="架构">架构<a class="hash-link" href="#架构" title="Direct link to heading">​</a></h2><p><a href="/zh-CN/docs/development/&quot;/doc/image/streamx_archite.png&quot;"></a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="编程模型">编程模型<a class="hash-link" href="#编程模型" title="Direct link to heading">​</a></h2><p><code>streamx-core</code> 定位是编程时框架,快速开发脚手架,专门为简化 Flink 开发而生,开发者在开发阶段会使用到该模块,下面我们来看看 <code>DataStrema</code> 和 <code>Flink Sql</code> 用 StreamX 来开发编程模型是什么样的,有什么规范和要求</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="datastream">DataStream<a class="hash-link" href="#datastream" title="Direct link to heading">​</a></h3><p> StreamX 提供了<code>scala</code>和<code>Java</code>两种 API 来开发 <code>DataStream</code> 程序,具体代码开发如下</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_vU9c tabs__item--active">Scala</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.FlinkStreaming</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">import org.apache.flink.api.scala._</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">object MyFlinkApp extends FlinkStreaming {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    override def handle(): Unit = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">public class MyFlinkJavaApp {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        StreamEnvConfig JavaConfig = new StreamEnvConfig(args, (environment, parameterTool) -&gt; {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            //用户可以给environment设置参数...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            System.out.println(&quot;environment argument set...&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        StreamingContext context = new StreamingContext(JavaConfig);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ....    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        context.start();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div></div><p>用 <code>scala</code> API 开发,程序必须要继承 <code>FlinkStreaming</code> ,继承之后,会强制让开发者实现 <code>handle()</code> 方法,该方法就是用户写代码的入口, 同时 <code>streamingContext</code> 供开发者使用</p><p>用 <code>Java</code> API 开发由于语言本身的限制没法省掉 <code>main()</code> 方法,所以会是一个标准的 <code>main()</code> 函数, 需要用户手动创建 <code>StreamingContext</code>,<code>StreamingContext</code> 是非常重要的一个类,稍后会介绍</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</h5></div><div class="admonition-content"><p>以上几行 <code>scala</code> 和 <code>Java</code> 代码就是用 StreamX 开发 <code>DataStream</code> 必不可少的最基本的骨架代码,用 StreamX 开发 <code>DataStream</code> 程序,从这几行代码开始, Java API 开发需要开发者手动启动任务 <code>start</code></p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="flink-sql">Flink Sql<a class="hash-link" href="#flink-sql" title="Direct link to heading">​</a></h3><p>TableEnvironment 是用来创建 Table &amp; SQL 程序的上下文执行环境,也是 Table &amp; SQL 程序的入口,Table &amp; SQL 程序的所有功能都是围绕 TableEnvironment 这个核心类展开的。TableEnvironment 的主要职能包括：对接外部系统，表及元数据的注册和检索，执行 SQL 语句，提供更详细的配置选项。</p><p>Flink 社区一直在推进 DataStream 的批处理能力,统一流批一体,在 Flink 1.12 中流批一体真正统一运行,诸多历史 API 如: DataSet API, BatchTableEnvironment API 等被废弃,退出历史舞台,官方推荐使用 <strong>TableEnvironment</strong> 和 <strong>StreamTableEnvironment</strong></p><p> StreamX 针对 <strong>TableEnvironment</strong> 和 <strong>StreamTableEnvironment</strong> 这两种环境的开发,提供了对应的更方便快捷的 API</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="tableenvironment">TableEnvironment<a class="hash-link" href="#tableenvironment" title="Direct link to heading">​</a></h4><p>开发Table &amp; SQL 作业, TableEnvironment 会是 Flink 推荐使用的入口类, 同时能支持 Java API 和 Scala API,下面的代码演示了在 StreamX 如何开发一个 TableEnvironment 类型的作业</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_vU9c tabs__item--active">Scala</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.FlinkTable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">object TableApp extends FlinkTable {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    override def handle(): Unit = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.TableContext;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.util.TableEnvConfig;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">public class JavaTableApp {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        TableEnvConfig tableEnvConfig = new TableEnvConfig(args, null);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        TableContext context = new TableContext(tableEnvConfig);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        context.start(&quot;Flink SQl Job&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</h5></div><div class="admonition-content"><p>以上几行 Scala 和 Java 代码就是用 StreamX 开发 TableEnvironment 必不可少的最基本的骨架代码,用 StreamX 开发 TableEnvironment 程序,从这几行代码开始,
Scala API 必须继承 FlinkTable, Java API 开发需要手动构造 TableContext ,需要开发者手动启动任务 <code>start</code></p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="streamtableenvironment">StreamTableEnvironment<a class="hash-link" href="#streamtableenvironment" title="Direct link to heading">​</a></h4><p><code>StreamTableEnvironment</code> 用于流计算场景,流计算的对象是 <code>DataStream</code>。相比 <code>TableEnvironment</code>, <code>StreamTableEnvironment</code> 提供了 <code>DataStream</code> 和 <code>Table</code> 之间相互转换的接口,如果用户的程序除了使用 <code>Table API</code> &amp; <code>SQL</code> 编写外,还需要使用到 <code>DataStream API</code>,则需要使用 <code>StreamTableEnvironment</code>。
下面的代码演示了在 StreamX 如何开发一个 <code>StreamTableEnvironment</code> 类型的作业</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_vU9c tabs__item--active">Scala</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">package com.streamxhub.streamx.test.tablesql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.FlinkStreamTable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">object StreamTableApp extends FlinkStreamTable {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  override def handle(): Unit = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.StreamTableContext;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">import com.streamxhub.streamx.flink.core.scala.util.StreamTableEnvConfig;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">public class JavaStreamTableApp {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        StreamTableEnvConfig JavaConfig = new StreamTableEnvConfig(args, null, null);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        StreamTableContext context = new StreamTableContext(JavaConfig);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        context.start(&quot;Flink SQl Job&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>特别注意</h5></div><div class="admonition-content"><p>以上几行 scala 和 Java 代码就是用 StreamX 开发 <code>StreamTableEnvironment</code> 必不可少的最基本的骨架代码,用 StreamX 开发 <code>StreamTableEnvironment</code> 程序,从这几行代码开始,Java 代码需要手动构造 <code>StreamTableContext</code>,<code>Java API</code>开发需要开发者手动启动任务<code>start</code></p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="runtime-context">RunTime Context<a class="hash-link" href="#runtime-context" title="Direct link to heading">​</a></h2><p><strong>RunTime Context</strong> — <strong>StreamingContext</strong> , <strong>TableContext</strong> , <strong>StreamTableContext</strong> 是 StreamX 中几个非常重要三个对象,接下来我们具体看看这三个 <strong>Context</strong> 的定义和作用</p><center><img src="/doc/image/streamx_coreapi.png" width="60%"></center><h3 class="anchor anchorWithStickyNavbar_y2LR" id="streamingcontext">StreamingContext<a class="hash-link" href="#streamingcontext" title="Direct link to heading">​</a></h3><p><code>StreamingContext</code> 继承自 <code>StreamExecutionEnvironment</code>, 在 <code>StreamExecutionEnvironment</code> 的基础之上增加了 <code>ParameterTool</code> ,简单可以理解为:</p><p><strong>StreamingContext</strong> = <strong>ParameterTool</strong> + <strong>StreamExecutionEnvironment</strong></p><p>具体定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">class StreamingContext(val parameter: ParameterTool, private val environment: StreamExecutionEnvironment) </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    extends StreamExecutionEnvironment(environment.getJavaEnv) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for scala</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: (ParameterTool, StreamExecutionEnvironment)) = this(args._1, args._2)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: StreamEnvConfig) = this(FlinkStreamingInitializer.initJavaStream(args))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ...  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}  </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>特别注意</h5></div><div class="admonition-content"><p>这个对象非常重要,在 <code>DataStream</code> 作业中会贯穿整个任务的生命周期, <code>StreamingContext</code> 本身继承自 <code>StreamExecutionEnvironment</code> ,配置文件会完全融合到 <code>StreamingContext</code> 中,这样就可以非常方便的从 <code>StreamingContext</code> 中获取各种参数</p></div></div><p>在 StreamX 中, <code>StreamingContext</code> 也是 Java API 编写 <code>DataStream</code> 作业的入口类, <code>StreamingContext</code> 的构造方法中有一个是专门为 Java API 打造的,该构造函数定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> * for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">def this(args: StreamEnvConfig) = this(FlinkStreamingInitializer.initJavaStream(args))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>由上面的构造方法可以看到创建 <code>StreamingContext</code>,需要传入一个 <code>StreamEnvConfig</code> 对象, <code>StreamEnvConfig</code> 定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">class StreamEnvConfig(val args: Array[String], val conf: StreamEnvConfigFunction)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>StreamEnvConfig的构造方法中,其中</p><ul><li><code>args</code> 为启动参数,必须为 <code>main</code> 方法里的 <code>args</code></li><li><code>conf</code> 为 <code>StreamEnvConfigFunction</code> 类型的 <code>Function</code></li></ul><p><code>StreamEnvConfigFunction</code> 定义如下</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">@FunctionalInterface</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">public interface StreamEnvConfigFunction {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * 用于初始化StreamExecutionEnvironment的时候,用于可以实现该函数,自定义要设置的参数...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @param environment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @param parameterTool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    void configuration(StreamExecutionEnvironment environment, ParameterTool parameterTool);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>该<code>Function</code>的作用是让开发者可以通过钩子的方式设置更多的参数,会将 <code>parameter</code> (解析配置文件里所有的参数)和初始化好的 <code>StreamExecutionEnvironment</code> 对象传给开发者去完成更多的参数设置,如:</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">StreamEnvConfig JavaConfig = new StreamEnvConfig(args, (environment, parameterTool) -&gt; {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    System.out.println(&quot;environment argument set...&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    environment.getConfig().enableForceAvro();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">});</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">StreamingContext context = new StreamingContext(JavaConfig);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="tablecontext">TableContext<a class="hash-link" href="#tablecontext" title="Direct link to heading">​</a></h3><p><code>TableContext</code> 继承自<code> TableEnvironment</code> ,在 <code>TableEnvironment</code> 的基础之上增加了 <code>ParameterTool</code> ,用来创建 <code>Table</code> &amp; <code>SQL</code> 程序的上下文执行环境,简单可以理解为:</p><p><strong>TableContext</strong> = <strong>ParameterTool</strong> + <strong>TableEnvironment</strong></p><p>具体定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">class TableContext(val parameter: ParameterTool,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                   private val tableEnv: TableEnvironment) </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                   extends TableEnvironment </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                   with FlinkTableTrait {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for scala</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: (ParameterTool, TableEnvironment)) = this(args._1, args._2)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: TableEnvConfig) = this(FlinkTableInitializer.initJavaTable(args))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}  </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在 StreamX 中,<code>TableContext</code> 也是 Java API 编写 <code>TableEnvironment</code> 类型的 <code>Table Sql</code> 作业的入口类,<code>TableContext</code> 的构造方法中有一个是专门为 <code>Java API</code> 打造的,该构造函数定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">def this(args: TableEnvConfig) = this(FlinkTableInitializer.initJavaTable(args))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>由上面的构造方法可以看到创建 <code>TableContext</code>,需要传入一个 <code>TableEnvConfig</code> 对象, <code>TableEnvConfig</code> 定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">class TableEnvConfig(val args: Array[String], val conf: TableEnvConfigFunction)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>TableEnvConfig的构造方法中,其中</p><ul><li><code>args</code> 为启动参数,必须为 <code>main</code> 方法里的 <code>args</code></li><li><code>conf</code> 为 <code>TableEnvConfigFunction</code> 类型的 <code>Function</code></li></ul><p><code>TableEnvConfigFunction</code> 定义如下</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">@FunctionalInterface</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">public interface TableEnvConfigFunction {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * 用于初始化TableEnvironment的时候,用于可以实现该函数,自定义要设置的参数...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @param tableConfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @param parameterTool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    void configuration(TableConfig tableConfig, ParameterTool parameterTool);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>该 <code>Function</code> 的作用是让开发者可以通过钩子的方式设置更多的参数,会将 <code>parameter</code>(解析配置文件里所有的参数)和初始化好的 <code>TableEnvironment</code> 中的 <code>TableConfig</code> 对象传给开发者去完成更多的参数设置,如:</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">TableEnvConfig config = new TableEnvConfig(args,(tableConfig,parameterTool)-&gt;{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    tableConfig.setLocalTimeZone(ZoneId.of(&quot;Asia/Shanghai&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">});</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TableContext context = new TableContext(config);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="streamtablecontext">StreamTableContext<a class="hash-link" href="#streamtablecontext" title="Direct link to heading">​</a></h3><p><code>StreamTableContext</code> 继承自 <code>StreamTableEnvironment</code>,用于流计算场景,流计算的对象是 <code>DataStream</code>, 相比 <code>TableEnvironment</code>, <code>StreamTableEnvironment</code> 提供了 <code>DataStream</code> 和 <code>Table</code> 之间相互转换的接口,
<code>StreamTableContext</code> 在 <code>StreamTableEnvironment</code> 的基础之上增加了 <code>ParameterTool</code>,又直接接入了 <code>StreamTableEnvironment</code> 的API,简单可以理解为:</p><p><strong>StreamTableContext</strong> = <strong>ParameterTool</strong> + <strong>StreamTableEnvironment</strong> + <strong>StreamExecutionEnvironment</strong></p><p>具体定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">class StreamTableContext(val parameter: ParameterTool,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                         private val streamEnv: StreamExecutionEnvironment,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                         private val tableEnv: StreamTableEnvironment) </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                         extends StreamTableEnvironment </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                         with FlinkTableTrait {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * 一旦 Table 被转化为 DataStream,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * 必须使用 StreamExecutionEnvironment 的 execute 方法执行该 DataStream 作业。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  private[scala] var isConvertedToDataStream: Boolean = false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for scala</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: (ParameterTool, StreamExecutionEnvironment, StreamTableEnvironment)) = </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  this(args._1, args._2, args._3)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def this(args: StreamTableEnvConfig) = this(FlinkTableInitializer.initJavaStreamTable(args))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ...  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在StreamX中,<code>StreamTableContext</code> 是 Java API 编写 <code>StreamTableEnvironment</code> 类型的 <code>Table Sql</code> 作业的入口类,<code>StreamTableContext</code> 的构造方法中有一个是专门为 Java API 打造的,该构造函数定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * for Java</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * @param args</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">def this(args: StreamTableEnvConfig) = this(FlinkTableInitializer.initJavaStreamTable(args))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>由上面的构造方法可以看到创建 <code>StreamTableContext</code> ,需要传入一个 <code>StreamTableEnvConfig</code> 对象,<code>StreamTableEnvConfig</code> 定义如下:</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">class StreamTableEnvConfig (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    val args: Array[String],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    val streamConfig: StreamEnvConfigFunction, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    val tableConfig: TableEnvConfigFunction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>StreamTableEnvConfig 的构造方法中有三个参数,其中</p><ul><li><code>args</code> 为启动参数,必须为<code>main</code>方法里的<code>args</code></li><li><code>streamConfig</code> 为<code>StreamEnvConfigFunction</code>类型的<code>Function</code></li><li><code>tableConfig</code> 为<code>TableEnvConfigFunction</code>类型的<code>Function</code></li></ul><p><code>StreamEnvConfigFunction</code>和<code>TableEnvConfigFunction</code> 定义上面已经讲过,这里不再赘述</p><p>该<code>Function</code>的作用是让开发者可以通过钩子的方式设置更多的参数,和上面其他参数设置不同的是,该<code>Function</code>提供了同时设置<code>StreamExecutionEnvironment</code>和<code>TableEnvironment</code>的机会 ,会将 <code>parameter</code>和初始化好的<code>StreamExecutionEnvironment</code>和<code>TableEnvironment</code>中的<code>TableConfig</code>对象传给开发者去完成更多的参数设置,如:</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">StreamTableEnvConfig JavaConfig = new StreamTableEnvConfig(args, (environment, parameterTool) -&gt; {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    environment.getConfig().enableForceAvro();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}, (tableConfig, parameterTool) -&gt; {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    tableConfig.setLocalTimeZone(ZoneId.of(&quot;Asia/Shanghai&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">});</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">StreamTableContext context = new StreamTableContext(JavaConfig);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>特别提示</h5></div><div class="admonition-content"><p>在 <code>StreamTableContext</code> 中可以直接使用 <code>StreamExecutionEnvironment</code> 的 <code>API</code>, <strong>以$打头的方法</strong> 都是 <code>StreamExecutionEnvironment</code> 的 API</p><p><img src="/zh-CN/assets/images/streamx_apis-574b985bc649f26aacf875ccd0155793.jpeg"></p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期">生命周期<a class="hash-link" href="#生命周期" title="Direct link to heading">​</a></h2><p>生命周期的概念目前只针对 <code>scala</code> API,该生命周期明确的定义了整个任务运行的全过程 ,但凡继承自 <code>FlinkStreaming</code> 或 <code>FlinkTable</code> 或 <code>StreamingTable</code> 就会按这个生命周期执行,生命周期的核心方法如下</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> final def main(args: Array[String]): Unit = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    init(args)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ready()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    handle()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    jobExecutionResult = context.start()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    destroy()</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  private[this] def init(args: Array[String]): Unit = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    SystemPropertyUtils.setAppHome(KEY_APP_HOME, classOf[FlinkStreaming])</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    context = new StreamingContext(FlinkStreamingInitializer.initStream(args, config))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   * 用户可覆盖次方法...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def ready(): Unit = {}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def config(env: StreamExecutionEnvironment, parameter: ParameterTool): Unit = {}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def handle(): Unit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  def destroy(): Unit = {}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>生命周期如下</p><ul><li><strong>init</strong>          配置文件初始化阶段</li><li><strong>config</strong>        开发者手动设置参数阶段 </li><li><strong>ready</strong>         启动之前执行自定义动作阶段</li><li><strong>handle</strong>        开发者代码接入阶段</li><li><strong>start</strong>         程序启动阶段</li><li><strong>destroy</strong>       销毁阶段</li></ul><p><img alt="Life Cycle" src="/zh-CN/assets/images/streamx_scala_life_cycle-7bfdf4f1228b36f59fae79943d5c8108.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--init">生命周期之 — init<a class="hash-link" href="#生命周期之--init" title="Direct link to heading">​</a></h3><p><strong>init</strong> 阶段,框架会自动解析传入的配置文件,按照里面的定义的各种参数初始化<code>StreamExecutionEnvironment</code>,这一步是框架自动执行,不需要开发者参与</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--config">生命周期之 — config<a class="hash-link" href="#生命周期之--config" title="Direct link to heading">​</a></h3><p><strong>config</strong> 阶段的目的是让开发者可以通过钩子的方式设置更多的参数(约定的配置文件以外的其他参数),在 <strong>config</strong> 阶段会将 <code>parameter</code>(<em>init</em> 阶段解析的配置文件里所有的参数)和<em>init</em> 阶段初始化好的<code>StreamExecutionEnvironment</code>对象传给开发者,
这样开发者就可以配置更多的参数</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>说明</h5></div><div class="admonition-content"><p><strong>config</strong> 阶段是需要开发者参与的阶段,是可选的阶段</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--ready">生命周期之 — ready<a class="hash-link" href="#生命周期之--ready" title="Direct link to heading">​</a></h3><p><strong>ready</strong> 阶段是在参数都设置完毕了,给开发者提供的一个用于做其他动作的入口, 该阶段是在<strong>初始化完成之后</strong>在<strong>程序启动之前</strong>进行</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>说明</h5></div><div class="admonition-content"><p><strong>ready</strong> 阶段是需要开发者参与的阶段,是可选的阶段</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--handle">生命周期之 — handle<a class="hash-link" href="#生命周期之--handle" title="Direct link to heading">​</a></h3><p><strong>handle</strong> 阶段是接入开发者编写的代码的阶段,是开发者编写代码的入口,也是最重要的一个阶段, 这个<code>handle</code> 方法会强制让开发者去实现</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>说明</h5></div><div class="admonition-content"><p><strong>handle</strong> 阶段是需要开发者参与的阶段,是必须的阶段</p></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--start">生命周期之 — start<a class="hash-link" href="#生命周期之--start" title="Direct link to heading">​</a></h3><p><strong>start</strong> 阶段,顾名思义,这个阶段会启动任务,由框架自动执行</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="生命周期之--destroy">生命周期之 — destroy<a class="hash-link" href="#生命周期之--destroy" title="Direct link to heading">​</a></h3><p><strong>destroy</strong> 阶段,是程序运行完毕了,在jvm退出之前的最后一个阶段,一般用于收尾的工作</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>说明</h5></div><div class="admonition-content"><p><strong>destroy</strong> 阶段是需要开发者参与的阶段,是可选的阶段</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="目录结构">目录结构<a class="hash-link" href="#目录结构" title="Direct link to heading">​</a></h2><p>推荐的项目目录结构如下,具体可以参考<a href="https://github.com/streamxhub/streamx/streamx-flink/streamx-flink-quickstart" target="_blank" rel="noopener noreferrer">Streamx-flink-quickstart</a> 里的目录结构和配置</p><div class="codeBlockContainer_J+bg language-tree theme-code-block"><div class="codeBlockContent_csEI tree"><pre tabindex="0" class="prism-code language-tree codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|── assembly</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    ├── bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    ├── startup.sh                             //启动脚本  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    ├── setclasspath.sh                        //Java环境变量相关的脚本(框架内部使用,开发者无需关注)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    ├── shutdown.sh                            //任务停止脚本(不建议使用)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    └── flink.sh                               //启动时内部使用到的脚本(框架内部使用,开发者无需关注)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │── conf                           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    ├── test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    │    ├── application.yaml                  //测试(test)阶段的配置文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    │    └── sql.yaml                          //flink sql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    │</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    ├── prod                      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    │    ├── application.yaml                  //生产(prod)阶段的配置文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │    │    └── sql.yaml                          //flink sql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    │── logs                                        //logs目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    └── temp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│── src</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│    └── main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│         ├── Java </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│         ├── resources</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│         └── scala </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│── assembly.xml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── pom.xml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>assembly.xml 是assembly打包插件需要用到的配置文件,定义如下:</p><div class="codeBlockContainer_J+bg language-xml theme-code-block"><div class="codeBlockContent_csEI xml"><pre tabindex="0" class="prism-code language-xml codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">assembly</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">id</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">bin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">id</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">formats</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">format</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">tar.gz</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">format</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">formats</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSets</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">assembly/bin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">bin</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0755</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">${project.build.directory}</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">lib</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0755</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">includes</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">include</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">*.jar</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">include</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">includes</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">excludes</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">exclude</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">original-*.jar</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">exclude</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">excludes</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">assembly/conf</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">conf</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0755</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">assembly/logs</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">logs</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0755</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">assembly/temp</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">directory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">temp</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">outputDirectory</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0755</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileMode</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSet</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">fileSets</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">assembly</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="打包部署">打包部署<a class="hash-link" href="#打包部署" title="Direct link to heading">​</a></h2><p>推荐 <a href="https://github.com/streamxhub/streamx/streamx-flink/streamx-flink-quickstart" target="_blank" rel="noopener noreferrer">streamx-flink-quickstart</a> 里的打包模式,直接运行<code>maven package</code>即可生成一个标准的StreamX推荐的项目包,解包后目录结构如下</p><div class="codeBlockContainer_J+bg language-text theme-code-block"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Streamx-flink-quickstart-1.0.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── startup.sh                             //启动脚本  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── setclasspath.sh                        //Java环境变量相关的脚本(内部使用的,用户无需关注)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── shutdown.sh                            //任务停止脚本(不建议使用)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── flink.sh                               //启动时内部使用到的脚本(内部使用的,用户无需关注)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── conf                           </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── application.yaml                       //项目的配置文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   ├── sql.yaml                               // flink sql文件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">├── lib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">│   └── Streamx-flink-quickstart-1.0.0.jar     //项目的jar包</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">└── temp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="启动命令">启动命令<a class="hash-link" href="#启动命令" title="Direct link to heading">​</a></h2><p>启动之前确定application.yaml和 sql.yaml 配置文件,如果要启动的任务是<code>DataStream</code>任务,直接在startup.sh后跟上配置文件即可</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">bin/startup.sh --conf conf/application.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>如果要启动的任务是<code>Flink Sql</code>任务,则需要跟上配置文件和sql.yaml</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#000000"><span class="token plain">bin/startup.sh --conf conf/application.yaml --sql conf/sql.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/streamxhub/streamx-website/edit/dev/docs/development/model.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-CN/docs/user-guide/development"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">开发环境</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-CN/docs/development/config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">项目配置</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#架构" class="table-of-contents__link toc-highlight">架构</a></li><li><a href="#编程模型" class="table-of-contents__link toc-highlight">编程模型</a><ul><li><a href="#datastream" class="table-of-contents__link toc-highlight">DataStream</a></li><li><a href="#flink-sql" class="table-of-contents__link toc-highlight">Flink Sql</a></li></ul></li><li><a href="#runtime-context" class="table-of-contents__link toc-highlight">RunTime Context</a><ul><li><a href="#streamingcontext" class="table-of-contents__link toc-highlight">StreamingContext</a></li><li><a href="#tablecontext" class="table-of-contents__link toc-highlight">TableContext</a></li><li><a href="#streamtablecontext" class="table-of-contents__link toc-highlight">StreamTableContext</a></li></ul></li><li><a href="#生命周期" class="table-of-contents__link toc-highlight">生命周期</a><ul><li><a href="#生命周期之--init" class="table-of-contents__link toc-highlight">生命周期之 — init</a></li><li><a href="#生命周期之--config" class="table-of-contents__link toc-highlight">生命周期之 — config</a></li><li><a href="#生命周期之--ready" class="table-of-contents__link toc-highlight">生命周期之 — ready</a></li><li><a href="#生命周期之--handle" class="table-of-contents__link toc-highlight">生命周期之 — handle</a></li><li><a href="#生命周期之--start" class="table-of-contents__link toc-highlight">生命周期之 — start</a></li><li><a href="#生命周期之--destroy" class="table-of-contents__link toc-highlight">生命周期之 — destroy</a></li></ul></li><li><a href="#目录结构" class="table-of-contents__link toc-highlight">目录结构</a></li><li><a href="#打包部署" class="table-of-contents__link toc-highlight">打包部署</a></li><li><a href="#启动命令" class="table-of-contents__link toc-highlight">启动命令</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">StreamX</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/intro">文档</a></li><li class="footer__item"><a href="https://github.com/streamxhub/streamx/issues/507" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/streamxhub/streamx/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>版本<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/streamxhub/streamx" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/streamxhub/streamx/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/streamxhub/streamx/pulls" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Pull Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p style="padding: 0 20px 30px;color: #999999; font-weight: 400;">Apache LICENSE 2.0 Licensed, Copyright © 2019-2022 streamxhub All Rights Reserved</p></div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.e8bca5c3.js"></script>
<script src="/zh-CN/assets/js/main.d331cf26.js"></script>
</body>
</html>